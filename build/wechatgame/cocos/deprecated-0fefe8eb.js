System.register(["./fog-c82f3158.js","./index-0a9deebe.js","./screen-b918b2af.js","./renderable-component-542a40ea.js","./texture-buffer-pool-b355307f.js","./json-asset-1decacc3.js","./camera-component-b0aa23d4.js","./sprite-frame-557587a3.js","./sprite-0a30f3f0.js","./renderable-2d-3f4a77a2.js","./graphics-29a7435a.js","./vertex-format-0f4aaeb9.js","./deprecated-a4c570aa.js"],(function(t){"use strict";var e,i,n,s,r,o,a,h,l,c,u,p,f,_,d,y,m,g,b,v,S,C,T,x,A,D,E,O,I,w,R,L,B,F,k,M,P,z,H,W,N,j,U,G,X,V,Y,q,Q,Z,$,J,K,tt,et,it,nt,st,rt,ot,at,ht,lt,ct,ut,pt,ft,_t,dt,yt,mt,gt,bt,vt,St,Ct,Tt,xt,At,Dt,Et;return{setters:[function(t){e=t.d1,i=t.cU,n=t.dx,s=t.eQ,r=t.eY,o=t.eN,a=t.dM,h=t.d8,l=t.cW,c=t.em,u=t.l,p=t.ap,f=t.z,_=t.G,d=t.a2,y=t.eM,m=t.fz,g=t.fR,b=t.fO,v=t.eX,S=t.eT,C=t.fV,T=t.fD,x=t.fS,A=t.fT,D=t.fA,E=t.f3,O=t.d,I=t.dd,w=t.fB,R=t.t,L=t.eS,B=t.ek,F=t.fY,k=t.ed,M=t.eh,P=t.gV,z=t.gA,H=t.aI,W=t.bW,N=t.bT,j=t.ei,U=t.cd,G=t.cc,X=t.bJ,V=t.c7,Y=t.fC,q=t.gW,Q=t.f1},function(t){Z=t.f,$=t.j},function(t){J=t.M,K=t.G},function(t){tt=t.a,et=t.e,it=t.r},function(){},function(t){nt=t.R,st=t.b},function(){},function(t){rt=t.S},function(t){ot=t.c,at=t.H,ht=t.F,lt=t.b,ct=t.S,ut=t.T,pt=t.a,ft=t.f,_t=t.d,dt=t.i,yt=t.e,mt=t.V},function(t){gt=t.a,bt=t.R,vt=t.I,St=t.U},function(t){Ct=t.G},function(t){Tt=t.g,xt=t.a,At=t.b,Dt=t.c},function(t){Et=t.U}],execute:function(){var Ot,It,wt,Rt,Lt,Bt,Ft,kt,Mt,Pt,zt,Ht,Wt,Nt,jt,Ut,Gt,Xt,Vt,Yt,qt,Qt,Zt,$t,Jt;t("e",void 0);var Kt,te=new e,ee=new i,ie=new e,ne=[];!function(t){t[t.RECT=0]="RECT",t[t.ELLIPSE=1]="ELLIPSE",t[t.GRAPHICS_STENCIL=2]="GRAPHICS_STENCIL",t[t.IMAGE_STENCIL=3]="IMAGE_STENCIL"}(Kt||(Kt=t("e",{}))),n(Kt);var se=t("a",(Ot=s("cc.Mask"),It=v(),wt=et(110),Rt=S(),Lt=r(Kt),Bt=C(),Ft=T(),kt=C(),Mt=T(),Pt=x(),zt=r(rt),Ht=x(),Wt=x(),Nt=A(),jt=x(),Ut=x(),Ot(Gt=It(Gt=wt(Gt=Rt((Jt=$t=function(t){function n(){var e;return(e=t.call(this)||this)._clearStencilMtl=null,e._clearModel=null,D(e,"_type",Vt,E(e)),D(e,"_inverted",Yt,E(e)),D(e,"_segments",qt,E(e)),D(e,"_spriteFrame",Qt,E(e)),D(e,"_alphaThreshold",Zt,E(e)),e._graphics=null,e._instanceMaterialType=vt.ADD_COLOR,e}o(n,t);var s=n.prototype;return s.onLoad=function(){this._createClearModel(),this._createGraphics(),this._graphics&&this._graphics.onLoad()},s.onEnable=function(){t.prototype.onEnable.call(this),this._updateGraphics()},s.onRestore=function(){this._createGraphics(),t.prototype.updateMaterial.call(this),this._updateGraphics(),this._renderFlag=this._canRender()},s.onDisable=function(){t.prototype.onDisable.call(this),this._disableGraphics()},s.onDestroy=function(){t.prototype.onDestroy.call(this),this._clearModel&&Z.root.destroyModel(this._clearModel),this._clearStencilMtl&&this._clearStencilMtl.destroy(),this._removeGraphics()},s.isHit=function(t){var n=this.node._uiProps.uiTransformComp,s=n.contentSize,r=s.width,o=s.height,a=ee;this.node.getWorldMatrix(te),e.invert(ie,te),i.transformMat4(a,t,ie);var h=n.anchorPoint;a.x+=h.x*r,a.y+=h.y*o;var l=!1;if(this.type===Kt.RECT||this.type===Kt.GRAPHICS_STENCIL)l=a.x>=0&&a.y>=0&&a.x<=r&&a.y<=o;else if(this.type===Kt.ELLIPSE){var c=r/2,u=o/2,p=a.x-.5*r,f=a.y-.5*o;l=p*p/(c*c)+f*f/(u*u)<1}return this._inverted&&(l=!l),l},s._render=function(t){t.commitComp(this,null,this._assembler,null)},s._postRender=function(t){this._postAssembler&&t.commitComp(this,null,this._postAssembler,null)},s._nodeStateChange=function(e){t.prototype._nodeStateChange.call(this,e),this._updateGraphics()},s._canRender=function(){return!!t.prototype._canRender.call(this)&&null!==this._graphics&&(this._type!==Kt.IMAGE_STENCIL||null!==this._spriteFrame)},s._flushAssembler=function(){var t=n.Assembler.getAssembler(this),e=n.PostAssembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._postAssembler!==e&&(this._postAssembler=e),this._useRenderData()},s._createGraphics=function(){if(!this._graphics){var t=this._graphics=new Ct;t._objFlags|=a.Flags.IsOnLoadCalled,t.node=this.node,t.node.getWorldMatrix(),t.lineWidth=0;var e=h.WHITE.clone();e.a=0,t.fillColor=e}this._updateMaterial()},s._updateGraphics=function(){if(this._graphics&&(this._type===Kt.RECT||this._type===Kt.ELLIPSE)){var t=this.node._uiProps.uiTransformComp,e=this._graphics;e.clear();var i=t.contentSize,n=i.width,s=i.height,r=t.anchorPoint,o=-n*r.x,a=-s*r.y;if(this._type===Kt.RECT)e.rect(o,a,n,s);else if(this._type===Kt.ELLIPSE){for(var h=function(t,e,i){ne.length=0;for(var n=2*Math.PI/i,s=0;s<i;++s)ne.push(new l(e.x*Math.cos(n*s)+t.x,e.y*Math.sin(n*s)+t.y,0));return ne}(new l(o+n/2,a+s/2,0),new l(n/2,s/2,0),this._segments),c=0;c<h.length;++c){var u=h[c];0===c?e.moveTo(u.x,u.y):e.lineTo(u.x,u.y)}e.close()}e.fill()}},s._createClearModel=function(){if(!this._clearModel){var t=c.get("default-clear-stencil");this._clearStencilMtl=new J({parent:t,owner:this,subModelIdx:0}),this._clearModel=Z.root.createModel(tt),this._clearModel.node=this._clearModel.transform=this.node;var e=Tt(xt),i=u.director.root.device,n=i.createBuffer(new p(f.VERTEX|f.TRANSFER_DST,_.DEVICE,4*e,e)),s=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);n.update(s);var r=i.createBuffer(new p(f.INDEX|f.TRANSFER_DST,_.DEVICE,6*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),o=new Uint16Array([0,1,2,2,1,3]);r.update(o);var a=new nt([n],xt,d.TRIANGLE_LIST,r);a.subMeshIdx=0,this._clearModel.initSubModel(0,a,this._clearStencilMtl)}},s._updateMaterial=function(){if(this._graphics){var t,e=this._graphics;e.stencilStage=gt.DISABLED,this._type===Kt.IMAGE_STENCIL?(t=c.get("ui-alpha-test-material"),e.setMaterial(t,0),(t=e.getMaterialInstance(0)).setProperty("alphaThreshold",this._alphaThreshold)):(t=c.get("ui-graphics-material"),e.setMaterial(t,0),e.getMaterialInstance(0))}},s._disableGraphics=function(){this._graphics&&this._graphics.onDisable()},s._removeGraphics=function(){this._graphics&&(this._graphics.destroy(),this._graphics._destroyImmediate(),this._graphics=null)},s._useRenderData=function(){this._type!==Kt.IMAGE_STENCIL||this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this.markForUpdateRenderData())},y(n,[{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this.markForUpdateRenderData(!1),this._updateMaterial(),this._type!==Kt.IMAGE_STENCIL?(this._spriteFrame=null,this._updateGraphics(),this._renderData&&(this.destroyRenderData(),this._renderData=null)):(this._useRenderData(),this._graphics&&this._graphics.clear()))}},{key:"inverted",get:function(){return this._inverted},set:function(t){u.game.renderType!==K.RENDER_TYPE_CANVAS?(this._inverted=t,this.stencilStage=gt.DISABLED,this._graphics&&(this._graphics.stencilStage=gt.DISABLED)):O(4202)}},{key:"segments",get:function(){return this._segments},set:function(t){this._segments!==t&&(this._segments=I(t,3,1e4),this._updateGraphics())}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){if(this._spriteFrame!==t){var e=this._spriteFrame;this._spriteFrame=t,this._type===Kt.IMAGE_STENCIL&&!e&&t&&this.markForUpdateRenderData()}}},{key:"alphaThreshold",get:function(){return this._alphaThreshold},set:function(t){this._alphaThreshold!==t&&(this._alphaThreshold=t,this.type===Kt.IMAGE_STENCIL&&this._graphics&&this._graphics.getMaterialInstance(0).setProperty("alphaThreshold",this._alphaThreshold))}},{key:"graphics",get:function(){return this._graphics}},{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this.markForUpdateRenderData())}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(){}}]),n}(bt),$t.Type=Kt,m((Xt=Jt).prototype,"type",[Lt,Bt,Ft],Object.getOwnPropertyDescriptor(Xt.prototype,"type"),Xt.prototype),m(Xt.prototype,"inverted",[kt,Mt],Object.getOwnPropertyDescriptor(Xt.prototype,"inverted"),Xt.prototype),m(Xt.prototype,"segments",[Pt],Object.getOwnPropertyDescriptor(Xt.prototype,"segments"),Xt.prototype),m(Xt.prototype,"spriteFrame",[zt,Ht],Object.getOwnPropertyDescriptor(Xt.prototype,"spriteFrame"),Xt.prototype),m(Xt.prototype,"alphaThreshold",[Wt,Nt,g],Object.getOwnPropertyDescriptor(Xt.prototype,"alphaThreshold"),Xt.prototype),m(Xt.prototype,"color",[b,jt],Object.getOwnPropertyDescriptor(Xt.prototype,"color"),Xt.prototype),m(Xt.prototype,"customMaterial",[b,Ut],Object.getOwnPropertyDescriptor(Xt.prototype,"customMaterial"),Xt.prototype),Vt=m(Xt.prototype,"_type",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Kt.RECT}}),Yt=m(Xt.prototype,"_inverted",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),qt=m(Xt.prototype,"_segments",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),Qt=m(Xt.prototype,"_spriteFrame",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Zt=m(Xt.prototype,"_alphaThreshold",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),Gt=Xt))||Gt)||Gt)||Gt)||Gt));st._comp=se,u.Mask=se;var re,oe,ae,he,le,ce,ue,pe,fe,_e,de,ye,me,ge,be,ve,Se,Ce,Te,xe,Ae,De,Ee,Oe,Ie,we,Re,Le,Be,Fe,ke,Me,Pe,ze,He,We,Ne,je,Ue,Ge,Xe,Ve,Ye,qe,Qe,Ze,$e,Je=/^(click)(\s)*=|(param)(\s)*=/,Ke=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,ti=t("H",function(){function t(){this._specialSymbolArray=[],this._stack=[],this._resultObjectArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])}var e=t.prototype;return e.parse=function(t){this._resultObjectArray.length=0,this._stack.length=0;for(var e=0,i=t.length;e<i;){var n=t.indexOf(">",e),s=-1;if(n>=0&&(s=t.lastIndexOf("<",n))<e-1&&(s=t.indexOf("<",n+1),n=t.indexOf(">",s+1)),s<0)this._stack.pop(),this._processResult(t.substring(e)),e=i;else{var r=t.substring(e,s),o=t.substring(s+1,n);""===o&&(r=t.substring(e,n+1)),this._processResult(r),-1===n?n=s:"/"===t.charAt(s+1)?this._stack.pop():this._addToStack(o),e=n+1}}return this._resultObjectArray},e._attributeToObject=function(t){t=t.trim();var e={},i=/^(color|size)(\s)*=/.exec(t),n="",s=0,r="";if(i){if(n=i[0],""===(t=t.substring(n.length).trim()))return e;switch(s=t.indexOf(" "),n[0]){case"c":e.color=s>-1?t.substring(0,s).trim():t;break;case"s":e.size=parseInt(t)}return s>-1&&(r=t.substring(s+1).trim(),e.event=this._processEventHandler(r)),e}if((i=/^(br(\s)*\/)/.exec(t))&&i[0].length>0&&(n=i[0].trim()).startsWith("br")&&"/"===n[n.length-1])return e.isNewLine=!0,this._resultObjectArray.push({text:"",style:{isNewLine:!0}}),e;var o="";if((i=/^(img(\s)*src(\s)*=[^>]+\/)/.exec(t))&&i[0].length>0&&(n=i[0].trim()).startsWith("img")&&"/"===n[n.length-1]){var a;i=Ke.exec(t);for(var h=!1;i;){if(n=(t=t.substring(t.indexOf(i[0]))).substr(0,i[0].length),a=(s=(o=t.substring(n.length).trim()).indexOf(" "))>-1?o.substr(0,s):o,n=(n=n.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=o.substring(s).trim(),a.endsWith("/")&&(a=a.slice(0,-1)),"src"===n){switch(a.charCodeAt(0)){case 34:case 39:h=!0,a=a.slice(1,-1)}e.isImage=!0,e.src=a}else if("height"===n)e.imageHeight=parseInt(a);else if("width"===n)e.imageWidth=parseInt(a);else if("align"===n){switch(a.charCodeAt(0)){case 34:case 39:a=a.slice(1,-1)}e.imageAlign=a.toLowerCase()}else"offset"===n?e.imageOffset=a:"click"===n&&(e.event=this._processEventHandler(n+"="+a));e.event&&"param"===n&&(e.event[n]=a.replace(/^"|"$/g,"")),i=Ke.exec(t)}return h&&e.isImage&&this._resultObjectArray.push({text:"",style:e}),{}}if(i=/^(outline(\s)*[^>]*)/.exec(t)){var l={color:"#ffffff",width:1};if(t=i[0].substring("outline".length).trim()){var c,u=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(i=u.exec(t);i;)n=(t=t.substring(t.indexOf(i[0]))).substr(0,i[0].length),c=(s=(o=t.substring(n.length).trim()).indexOf(" "))>-1?o.substr(0,s):o,n=(n=n.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=o.substring(s).trim(),"click"===n?e.event=this._processEventHandler(n+"="+c):"color"===n?l.color=c:"width"===n&&(l.width=parseInt(c)),e.event&&"param"===n&&(e.event[n]=c.replace(/^"|"$/g,"")),i=u.exec(t)}e.outline=l}if((i=/^(on|u|b|i)(\s)*/.exec(t))&&i[0].length>0){switch(n=i[0],t=t.substring(n.length).trim(),n[0]){case"u":e.underline=!0;break;case"i":e.italic=!0;break;case"b":e.bold=!0}if(""===t)return e;e.event=this._processEventHandler(t)}return e},e._processEventHandler=function(t){for(var e={},i=0,n=!1,s=Je.exec(t);s;){var r=s[0],o="";if(n=!1,'"'===(t=t.substring(r.length).trim()).charAt(0))(i=t.indexOf('"',1))>-1&&(o=t.substring(1,i).trim(),n=!0),i++;else if("'"===t.charAt(0))(i=t.indexOf("'",1))>-1&&(o=t.substring(1,i).trim(),n=!0),i++;else{var a=/(\S)+/.exec(t);i=(o=a?a[0]:"").length}n&&(e[r=r.substring(0,r.length-1).trim()]=o),t=t.substring(i).trim(),s=Je.exec(t)}return e},e._addToStack=function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else{if(e.isNewLine||e.isImage)return;var i=this._stack[this._stack.length-1];for(var n in i)e[n]||(e[n]=i[n]);this._stack.push(e)}},e._processResult=function(t){0!==t.length&&(t=this._escapeSpecialSymbol(t),this._stack.length>0?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},e._escapeSpecialSymbol=function(t){for(var e,i=R(this._specialSymbolArray);!(e=i()).done;){var n=e.value,s=n[0],r=n[1];t=t.replace(s,r)}return t},t}()),ei=t("L",(re=s("cc.LabelOutline"),oe=v(),ae=et(110),he=S(),le=it(ot),ce=T(),ue=T(),re(pe=oe(pe=ae(pe=he(pe=le(pe=L((ye=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return e=t.call.apply(t,[this].concat(n))||this,D(e,"_color",_e,E(e)),D(e,"_width",de,E(e)),e}o(e,t);var i=e.prototype;return i.onEnable=function(){this._updateRenderData()},i.onDisable=function(){this._updateRenderData()},i._updateRenderData=function(){var t=this.node.getComponent(ot);t&&t.updateRenderData(!0)},y(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"width",get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._updateRenderData())}}]),e}(B),_e=m((fe=ye).prototype,"_color",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h(0,0,0,255)}}),de=m(fe.prototype,"_width",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),m(fe.prototype,"color",[ce],Object.getOwnPropertyDescriptor(fe.prototype,"color"),fe.prototype),m(fe.prototype,"width",[ue],Object.getOwnPropertyDescriptor(fe.prototype,"width"),fe.prototype),pe=fe))||pe)||pe)||pe)||pe)||pe)||pe)),ii=new ti,ni="RICHTEXT_CHILD",si="RICHTEXT_Image_CHILD",ri=new F((function(t){if(!u.isValid(t.node))return!1;var e=t.node.getComponent(ei);return e&&(e.width=0),!0}),20),oi=new F((function(t){return u.isValid(t.node)}),10);function ai(t){return{node:new M(t),comp:null,lineCount:0,styleIndex:0,imageOffset:"",clickParam:"",clickHandler:"",type:t}}function hi(t,e){var i;t===ni?i=ri._get():t===si&&(i=oi._get());var n=(i=i||ai(t)).node;return n||(n=new M(t)),n.hideFlags|=a.Flags.DontSave|a.Flags.HideInHierarchy,t===si?(i.comp=n.getComponent(pt)||n.addComponent(pt),i.comp.spriteFrame=e,i.comp.type=pt.Type.SLICED,i.comp.sizeMode=pt.SizeMode.CUSTOM):(i.comp=n.getComponent(ot)||n.addComponent(ot),i.comp.string=e,i.comp.horizontalAlign=at.LEFT,i.comp.verticalAlign=mt.TOP),n.setPosition(0,0,0),n._uiProps.uiTransformComp.setAnchorPoint(.5,.5),i.node=n,i.lineCount=0,i.styleIndex=0,i.imageOffset="",i.clickParam="",i.clickHandler="",i}var li,ci=t("R",(me=s("cc.RichText"),ge=v(),be=et(110),ve=S(),Se=T(),Ce=r(at),Te=T(),xe=T(),Ae=T(),De=r(ht),Ee=T(),Oe=T(),Ie=r(lt),we=T(),Re=T(),Le=T(),Be=r(ct),Fe=T(),ke=T(),me(Me=ge(Me=be(Me=ve(Me=L(($e=Ze=function(t){function e(){var e;return e=t.call(this)||this,D(e,"_lineHeight",ze,E(e)),D(e,"_string",He,E(e)),D(e,"_horizontalAlign",We,E(e)),D(e,"_fontSize",Ne,E(e)),D(e,"_maxWidth",je,E(e)),D(e,"_fontFamily",Ue,E(e)),D(e,"_font",Ge,E(e)),D(e,"_isSystemFontUsed",Xe,E(e)),D(e,"_userDefinedFont",Ve,E(e)),D(e,"_cacheMode",Ye,E(e)),D(e,"_imageAtlas",qe,E(e)),D(e,"_handleTouchEvent",Qe,E(e)),e._textArray=[],e._segments=[],e._labelSegmentsCache=[],e._linesWidth=[],e._lineCount=1,e._labelWidth=0,e._labelHeight=0,e._layoutDirty=!0,e._lineOffsetX=0,e._updateRichTextStatus=void 0,e._updateRichTextStatus=e._updateRichText,e}o(e,t);var i=e.prototype;return i.onLoad=function(){this.node.on(k.LAYER_CHANGED,this._applyLayer,this)},i.onEnable=function(){this.handleTouchEvent&&this._addEventListeners(),this._updateRichText(),this._activateChildren(!0)},i.onDisable=function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)},i.start=function(){this._onTTFLoaded(),this.node.on(M.EventType.ANCHOR_CHANGED,this._updateRichTextPosition,this)},i.onRestore=function(){},i.onDestroy=function(){for(var t,e=R(this._segments);!(t=e()).done;){var i=t.value;i.node.removeFromParent(),i.type===ni?ri.put(i):i.type===si&&oi.put(i)}this.node.off(M.EventType.ANCHOR_CHANGED,this._updateRichTextPosition,this),this.node.off(k.LAYER_CHANGED,this._applyLayer,this)},i._addEventListeners=function(){this.node.on(M.EventType.TOUCH_END,this._onTouchEnded,this)},i._removeEventListeners=function(){this.node.off(M.EventType.TOUCH_END,this._onTouchEnded,this)},i._updateLabelSegmentTextAttributes=function(){var t=this;this._segments.forEach((function(e){t._applyTextAttribute(e)}))},i._createFontLabel=function(t){return hi(ni,t)},i._createImage=function(t){return hi(si,t)},i._onTTFLoaded=function(){var t=this;this._font instanceof ut?this._font._nativeAsset?(this._layoutDirty=!0,this._updateRichText()):$.postLoadNative(this._font,(function(){t.isValid&&(t._layoutDirty=!0,t._updateRichText())})):(this._layoutDirty=!0,this._updateRichText())},i._measureText=function(t,e){var i=this,n=function(e){var n;return 0===i._labelSegmentsCache.length?(n=i._createFontLabel(e),i._labelSegmentsCache.push(n)):(n=i._labelSegmentsCache[0]).node.getComponent(ot).string=e,n.styleIndex=t,i._applyTextAttribute(n),n.node._uiProps.uiTransformComp.contentSize.width};return e?n(e):n},i._onTouchEnded=function(t){for(var e,i=this,n=this.node.getComponents(B),s=function(){var s=e.value,r=s.clickHandler,o=s.clickParam;r&&i._containsTouchLocation(s,t.touch.getUILocation())&&(n.forEach((function(e){var i=e[r];e.enabledInHierarchy&&i&&i.call(e,t,o)})),t.propagationStopped=!0)},r=R(this._segments);!(e=r()).done;)s()},i._containsTouchLocation=function(t,e){var i=t.node.getComponent(St);return!!i&&i.getBoundingBoxToWorld().contains(e)},i._resetState=function(){for(var t=this.node.children,e=t.length-1;e>=0;e--){var i=t[e];if(i.name===ni||i.name===si){i.parent===this.node?i.parent=null:t.splice(e,1);var n=ai(i.name);n.node=i,i.name===ni?(n.comp=i.getComponent(ot),ri.put(n)):(n.comp=i.getComponent(pt),oi.put(n))}}t.length=0,this._segments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},i._activateChildren=function(t){for(var e=this.node.children.length-1;e>=0;e--){var i=this.node.children[e];i.name!==ni&&i.name!==si||(i.active=t)}},i._addLabelSegment=function(t,e){var i;if(0===this._labelSegmentsCache.length)i=this._createFontLabel(t);else{var n=(i=this._labelSegmentsCache.pop()).node.getComponent(ot);n&&(n.string=t)}return i.styleIndex=e,i.lineCount=this._lineCount,i.node._uiProps.uiTransformComp.setAnchorPoint(0,0),i.node.layer=this.node.layer,this._applyTextAttribute(i),this.node.addChild(i.node),this._segments.push(i),i},i._updateRichTextWithMaxWidth=function(t,e,i){var n=e;if(this._lineOffsetX>0&&n+this._lineOffsetX>this._maxWidth)for(var s=0;this._lineOffsetX<=this._maxWidth;){var r=this._getFirstWordLen(t,s,t.length),o=t.substr(s,r),a=this._measureText(i,o);if(!(this._lineOffsetX+a<=this._maxWidth)){if(s>0){var h=t.substr(0,s);this._addLabelSegment(h,i),t=t.substr(s,t.length),n=this._measureText(i,t)}this._updateLineInfo();break}this._lineOffsetX+=a,s+=r}if(n>this._maxWidth)for(var l=ft(t,n,this._maxWidth,this._measureText(i)),c=0;c<l.length;++c){var u=l[c],p=this._addLabelSegment(u,i).node._uiProps.uiTransformComp.contentSize;this._lineOffsetX+=p.width,l.length>1&&c<l.length-1&&this._updateLineInfo()}else this._lineOffsetX+=n,this._addLabelSegment(t,i)},i._isLastComponentCR=function(t){return t.length-1===t.lastIndexOf("\n")},i._updateLineInfo=function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},i._needsUpdateTextLayout=function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;e++){var i=this._textArray[e],n=t[e];if(i.text!==n.text)return!0;var s=i.style,r=n.style;if(s){if(r){if(!!r.outline!=!!s.outline)return!0;if(s.size!==r.size||s.italic!==r.italic||s.isImage!==r.isImage)return!0;if(s.src!==r.src||s.imageAlign!==r.imageAlign||s.imageHeight!==r.imageHeight||s.imageWidth!==r.imageWidth||s.imageOffset!==r.imageOffset)return!0}else if(s.size||s.italic||s.isImage||s.outline)return!0}else if(r&&(r.size||r.italic||r.isImage||r.outline))return!0}return!1},i._addRichTextImageElement=function(t){if(t.style){var e=t.style,i=e.src,n=this._imageAtlas&&i&&this._imageAtlas.getSpriteFrame(i);if(n){var s=this._createImage(n);switch(s.comp,e.imageAlign){case"top":s.node._uiProps.uiTransformComp.setAnchorPoint(0,1);break;case"center":s.node._uiProps.uiTransformComp.setAnchorPoint(0,.5);break;default:s.node._uiProps.uiTransformComp.setAnchorPoint(0,0)}s.node.layer=this.node.layer,this.node.addChild(s.node),this._segments.push(s);var r=n.rect.clone(),o=1,a=r.width,h=r.height,l=e.imageWidth||0,c=e.imageHeight||0;c>0?(a*=o=c/h,h*=o):(a*=o=this._lineHeight/h,h*=o),l>0&&(a=l),this._maxWidth>0?(this._lineOffsetX+a>this._maxWidth&&this._updateLineInfo(),this._lineOffsetX+=a):(this._lineOffsetX+=a,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),s.node._uiProps.uiTransformComp.setContentSize(a,h),s.lineCount=this._lineCount,s.clickHandler="",s.clickParam="";var u=e.event;u&&(s.clickHandler=u.click,s.clickParam=u.param)}else O(4400)}},i._updateRichText=function(){if(this.enabledInHierarchy){var t=ii.parse(this._string);if(!this._needsUpdateTextLayout(t))return this._textArray=t.slice(),void this._updateLabelSegmentTextAttributes();this._textArray=t.slice(),this._resetState();for(var e,i=!1,n=0;n<this._textArray.length;++n){var s=this._textArray[n],r=s.text;if(void 0!==r){if(""===r){if(s.style&&s.style.isNewLine){this._updateLineInfo();continue}if(s.style&&s.style.isImage&&this._imageAtlas){this._addRichTextImageElement(s);continue}}for(var o=r.split("\n"),a=0;a<o.length;++a){var h=o[a];if(""!==h)if(i=!1,this._maxWidth>0){var l=this._measureText(n,h);this._updateRichTextWithMaxWidth(h,l,n),o.length>1&&a<o.length-1&&this._updateLineInfo()}else e=this._addLabelSegment(h,n),this._lineOffsetX+=e.node._uiProps.uiTransformComp.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),o.length>1&&a<o.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(r)&&a===o.length-1)continue;this._updateLineInfo(),i=!0}}}}i||this._linesWidth.push(this._lineOffsetX),this._maxWidth>0&&(this._labelWidth=this._maxWidth),this._labelHeight=(this._lineCount+_t)*this._lineHeight,this.node._uiProps.uiTransformComp.setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},i._getFirstWordLen=function(t,e,i){var n=t.charAt(e);if(dt(n)||yt(n))return 1;for(var s=1,r=e+1;r<i&&(n=t.charAt(r),!yt(n)&&!dt(n));++r)s++;return s},i._updateRichTextPosition=function(){for(var t=0,e=1,i=this._lineCount,n=this.node._uiProps.uiTransformComp,s=n.anchorX,r=n.anchorY,o=0;o<this._segments.length;++o){var a=this._segments[o],h=a.lineCount;h>e&&(t=0,e=h);var l=this._labelWidth*(.5*this._horizontalAlign-s);switch(this._horizontalAlign){case at.LEFT:break;case at.CENTER:l-=this._linesWidth[h-1]/2;break;case at.RIGHT:l-=this._linesWidth[h-1]}var c=a.node.position;if(a.node.setPosition(t+l,this._lineHeight*(i-h)-this._labelHeight*r,c.z),h===e&&(t+=a.node._uiProps.uiTransformComp.width),a.node.getComponent(pt)){var u=a.node.position.clone(),p=this._lineHeight,f=this._lineHeight*(1+_t);switch(a.node._uiProps.uiTransformComp.anchorY){case 1:u.y+=p+(f-p)/2;break;case.5:u.y+=f/2;break;default:u.y+=(f-p)/2}if(a.imageOffset){var _=a.imageOffset.split(",");if(1===_.length&&_[0]){var d=parseFloat(_[0]);Number.isInteger(d)&&(u.y+=d)}else if(2===_.length){var y=parseFloat(_[0]),m=parseFloat(_[1]);Number.isInteger(y)&&(u.x+=y),Number.isInteger(m)&&(u.y+=m)}}a.node.position=u}var g=a.node.getComponent(ei);if(g){var b=a.node.position.clone();b.y-=g.width,a.node.position=b}}},i._convertLiteralColorValue=function(t){var e=t.toUpperCase();return h[e]?h[e]:(new h).fromHEX(t)},i._applyTextAttribute=function(t){var e=t.node.getComponent(ot);if(e){var i,n=t.styleIndex;if(this._textArray[n]&&(i=this._textArray[n].style),i){if(e.color=this._convertLiteralColorValue(i.color||"white"),e.isBold=!!i.bold,e.isItalic=!!i.italic,e.isUnderline=!!i.underline,i.outline){var s=t.node.getComponent(ei);s||(s=t.node.addComponent(ei)),s.color=this._convertLiteralColorValue(i.outline.color),s.width=i.outline.width}e.fontSize=i.size||this._fontSize,t.clickHandler="",t.clickParam="";var r=i.event;r&&(t.clickHandler=r.click||"",t.clickParam=r.param||"")}else e.fontSize=this._fontSize;e.cacheMode=this._cacheMode,this._font instanceof ht&&!this._isSystemFontUsed?e.font=this._font:e.fontFamily=this._fontFamily,e.useSystemFont=this._isSystemFontUsed,e.lineHeight=this._lineHeight,e.updateRenderData(!0);var o=e._assembler;o&&o.updateRenderData(e)}},i._applyLayer=function(){for(var t,e=R(this._segments);!(t=e()).done;)t.value.node.layer=this.node.layer},y(e,[{key:"string",get:function(){return this._string},set:function(t){this._string!==t&&(this._string=t,this._updateRichTextStatus())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this.horizontalAlign!==t&&(this._horizontalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._font=t,this._layoutDirty=!0,this._font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this._isSystemFontUsed=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode=t,this._updateRichTextStatus())}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"imageAtlas",get:function(){return this._imageAtlas},set:function(t){this._imageAtlas!==t&&(this._imageAtlas=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"handleTouchEvent",get:function(){return this._handleTouchEvent},set:function(t){this._handleTouchEvent!==t&&(this._handleTouchEvent=t,this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners()))}}]),e}(Et),Ze.HorizontalAlign=at,Ze.VerticalAlign=mt,m((Pe=$e).prototype,"string",[P,Se],Object.getOwnPropertyDescriptor(Pe.prototype,"string"),Pe.prototype),m(Pe.prototype,"horizontalAlign",[Ce,Te],Object.getOwnPropertyDescriptor(Pe.prototype,"horizontalAlign"),Pe.prototype),m(Pe.prototype,"fontSize",[xe],Object.getOwnPropertyDescriptor(Pe.prototype,"fontSize"),Pe.prototype),m(Pe.prototype,"fontFamily",[Ae],Object.getOwnPropertyDescriptor(Pe.prototype,"fontFamily"),Pe.prototype),m(Pe.prototype,"font",[De,Ee],Object.getOwnPropertyDescriptor(Pe.prototype,"font"),Pe.prototype),m(Pe.prototype,"useSystemFont",[Oe],Object.getOwnPropertyDescriptor(Pe.prototype,"useSystemFont"),Pe.prototype),m(Pe.prototype,"cacheMode",[Ie,we],Object.getOwnPropertyDescriptor(Pe.prototype,"cacheMode"),Pe.prototype),m(Pe.prototype,"maxWidth",[Re],Object.getOwnPropertyDescriptor(Pe.prototype,"maxWidth"),Pe.prototype),m(Pe.prototype,"lineHeight",[Le],Object.getOwnPropertyDescriptor(Pe.prototype,"lineHeight"),Pe.prototype),m(Pe.prototype,"imageAtlas",[Be,Fe],Object.getOwnPropertyDescriptor(Pe.prototype,"imageAtlas"),Pe.prototype),m(Pe.prototype,"handleTouchEvent",[ke],Object.getOwnPropertyDescriptor(Pe.prototype,"handleTouchEvent"),Pe.prototype),ze=m(Pe.prototype,"_lineHeight",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),He=m(Pe.prototype,"_string",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"<color=#00ff00>Rich</color><color=#0fffff>Text</color>"}}),We=m(Pe.prototype,"_horizontalAlign",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return at.LEFT}}),Ne=m(Pe.prototype,"_fontSize",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),je=m(Pe.prototype,"_maxWidth",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ue=m(Pe.prototype,"_fontFamily",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Arial"}}),Ge=m(Pe.prototype,"_font",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xe=m(Pe.prototype,"_isSystemFontUsed",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Ve=m(Pe.prototype,"_userDefinedFont",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ye=m(Pe.prototype,"_cacheMode",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return lt.NONE}}),qe=m(Pe.prototype,"_imageAtlas",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qe=m(Pe.prototype,"_handleTouchEvent",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Me=Pe))||Me)||Me)||Me)||Me)||Me)),ui=t("U",s("cc.UIMeshRenderer")(li=v()(li=et(110)(li=S()(li=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this)._models=null,e._modelComponent=null,e}o(e,t);var i=e.prototype;return i.onLoad=function(){this.node._uiProps.uiTransformComp||this.node.addComponent("cc.UITransform"),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent?this._models=this._modelComponent._collectModels():console.warn("node '"+(this.node&&this.node.name)+"' doesn't have any renderable component")},i.onEnable=function(){t.prototype.onEnable.call(this)},i.onDisable=function(){t.prototype.onDisable.call(this)},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent&&(this._modelComponent._sceneGetter=null,this._models=null)},i.updateAssembler=function(t){if(this._models){this._modelComponent._detachFromScene();for(var e,i=R(this._models);!(e=i()).done;){var n=e.value;t.commitModel.call(t,this,n,this._modelComponent.material)}return!0}return!1},i.update=function(){this._fitUIRenderQueue()},i._fitUIRenderQueue=function(){if(this._modelComponent)for(var t=this._modelComponent.sharedMaterials.length,e=0;e<t;e++){var i=this._modelComponent.getMaterialInstance(e);if(null!=i)for(var n=i.passes,s=n.length,r=0;r<s;r++){var o=n[r];o._priority=z.MAX-11,o.blendState.targets[0].blend||i.overridePipelineStates({blendState:{targets:[{blend:!0}]}},r)}}},y(e,[{key:"modelComponent",get:function(){return this._modelComponent}}]),e}(Et))||li)||li)||li)||li),pi=t("M",function(){function t(t){this.vData=null,this.iData=null,this.byteStart=0,this.byteOffset=0,this.indicesStart=0,this.indicesOffset=0,this.vertexStart=0,this.vertexOffset=0,this.lastByteOffset=1,this._attributes=null,this._vertexBuffers=[],this._indexBuffer=null,this._iaInfo=null,this._batcher=void 0,this._dirty=!1,this._vertexFormatBytes=0,this._initVDataCount=0,this._initIDataCount=1536,this._outOfCallback=null,this._hInputAssemblers=[],this._nextFreeIAHandle=0,this._batcher=t}var e=t.prototype;return e.initialize=function(t,e){this._outOfCallback=e;var i=At(t);this._vertexFormatBytes=i*Float32Array.BYTES_PER_ELEMENT,this._initVDataCount=256*this._vertexFormatBytes;var n=Float32Array.BYTES_PER_ELEMENT*i;this.vertexBuffers.length||this.vertexBuffers.push(this._batcher.device.createBuffer(new p(f.VERTEX|f.TRANSFER_DST,_.HOST|_.DEVICE,n,n)));var s=Uint16Array.BYTES_PER_ELEMENT;this.indexBuffer||(this._indexBuffer=this._batcher.device.createBuffer(new p(f.INDEX|f.TRANSFER_DST,_.HOST|_.DEVICE,s,s))),this._attributes=t,this._iaInfo=new H(this.attributes,this.vertexBuffers,this.indexBuffer),this._reallocBuffer()},e.request=function(t,e){void 0===t&&(t=4),void 0===e&&(e=6),this.lastByteOffset=this.byteOffset;var i=this.byteOffset+t*this._vertexFormatBytes,n=this.indicesOffset+e;if(t+this.vertexOffset>65535)return this._outOfCallback&&this._outOfCallback.call(this._batcher,t,e),!1;var s=this.vData.byteLength,r=this.iData.length;if(i>s||n>r){for(;s<i||r<n;)this._initVDataCount*=2,this._initIDataCount*=2,s=4*this._initVDataCount,r=this._initIDataCount;this._reallocBuffer()}return this.vertexOffset+=t,this.indicesOffset+=e,this.byteOffset=i,this._dirty=!0,!0},e.reset=function(){this.byteStart=0,this.byteOffset=0,this.indicesStart=0,this.indicesOffset=0,this.vertexStart=0,this.vertexOffset=0,this.lastByteOffset=0,this._nextFreeIAHandle=0,this._dirty=!1},e.destroy=function(){this._attributes=null,this.vertexBuffers[0].destroy(),this.vertexBuffers.length=0,this.indexBuffer.destroy(),this._indexBuffer=null;for(var t=0;t<this._hInputAssemblers.length;t++)W.free(this._hInputAssemblers[t]);this._hInputAssemblers.length=0},e.recordBatch=function(){var t=this.indicesOffset-this.indicesStart;if(!t)return N;this._hInputAssemblers.length<=this._nextFreeIAHandle&&this._hInputAssemblers.push(W.alloc(this._batcher.device,this._iaInfo));var e=this._hInputAssemblers[this._nextFreeIAHandle++],i=W.get(e);return i.firstIndex=this.indicesStart,i.indexCount=t,e},e.uploadBuffers=function(){if(0!==this.byteOffset&&this._dirty){var t=new Float32Array(this.vData.buffer,0,this.byteOffset>>2),e=new Uint16Array(this.iData.buffer,0,this.indicesOffset);this.byteOffset>this.vertexBuffers[0].size&&this.vertexBuffers[0].resize(this.byteOffset),this.vertexBuffers[0].update(t),2*this.indicesOffset>this.indexBuffer.size&&this.indexBuffer.resize(2*this.indicesOffset),this.indexBuffer.update(e),this._dirty=!1}},e._reallocBuffer=function(){this._reallocVData(!0),this._reallocIData(!0)},e._reallocVData=function(t){var e;if(this.vData&&(e=new Uint8Array(this.vData.buffer)),this.vData=new Float32Array(this._initVDataCount),e&&t)for(var i=new Uint8Array(this.vData.buffer),n=0,s=e.length;n<s;n++)i[n]=e[n]},e._reallocIData=function(t){var e=this.iData;if(this.iData=new Uint16Array(this._initIDataCount),e&&t)for(var i=this.iData,n=0,s=e.length;n<s;n++)i[n]=e[n]},y(t,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}}]),t}());pi.OPACITY_OFFSET=8;var fi,_i,di,yi,mi,gi,bi,vi,Si,Ci,Ti,xi,Ai,Di,Ei,Oi,Ii,wi,Ri,Li,Bi,Fi,ki,Mi,Pi,zi,Hi=j.Enum.NONE|j.Enum.UI_3D,Wi=t("D",function(){function t(){this.bufferBatch=null,this.camera=null,this.renderScene=null,this.model=null,this.texture=null,this.sampler=null,this.useLocalData=null,this.isStatic=!1,this.textureHash=0,this.samplerHash=0,this._handle=N,this._passes=[],this._handle=U.alloc(),U.set(this._handle,G.VIS_FLAGS,Hi),U.set(this._handle,G.INPUT_ASSEMBLER,N),U.set(this._handle,G.DESCRIPTOR_SET,N)}var e=t.prototype;return e.destroy=function(){if(this._handle){for(var t=this.passes.length,e=0;e<t;e++)this.passes[e]._destroyHandle();this._passes=[],U.free(this._handle),this._handle=N}},e.clear=function(){this.bufferBatch=null,this.hInputAssembler=N,this.hDescriptorSet=N,this.camera=null,this.texture=null,this.sampler=null,this.model=null,this.isStatic=!1,this.useLocalData=null,this.visFlags=Hi},e.fillPasses=function(t,e,i,n,s,r){if(t){var o=t.passes;if(!o)return;U.set(this._handle,G.PASS_COUNT,o.length);for(var a=G.PASS_0,h=G.SHADER_0,l=0,c=0;c<o.length;c++,a++,h++){this._passes[c]||(this._passes[c]=new X(u.director.root),this._passes[c]._handle=V.alloc());var p=o[c],f=this._passes[c];e||(e=p.depthStencilState,i=0),n||(n=p.blendState,s=0),-1===s&&(s=0),l=i<<16|s,p.update(),f._initPassFromTarget(p,e,n,l),U.set(this._handle,a,f.handle),U.set(this._handle,h,f.getShaderVariant(r))}}},y(t,[{key:"handle",get:function(){return this._handle}},{key:"hInputAssembler",get:function(){return U.get(this._handle,G.INPUT_ASSEMBLER)},set:function(t){U.set(this._handle,G.INPUT_ASSEMBLER,t)}},{key:"hDescriptorSet",get:function(){return U.get(this._handle,G.DESCRIPTOR_SET)},set:function(t){U.set(this._handle,G.DESCRIPTOR_SET,t)}},{key:"visFlags",get:function(){return U.get(this._handle,G.VIS_FLAGS)},set:function(t){U.set(this._handle,G.VIS_FLAGS,t)}},{key:"passes",get:function(){return this._passes}}]),t}()),Ni=t("b",(fi=s("cc.UIStaticBatch"),_i=v(),di=S(),yi=et(110),mi=x(),fi(gi=_i(gi=di(gi=yi((vi=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this)._init=!1,e._meshBuffer=null,e._dirty=!0,e._lastMeshBuffer=null,e._uiDrawBatchList=[],e}o(e,t);var i=e.prototype;return i.onLoad=function(){var t=this._getBatcher();if(t){var e=Dt,i=new pi(t);i.initialize(e,this._arrivalMaxBuffer.bind(this)),this._meshBuffer=i}},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._clearData(),this._meshBuffer&&(this._meshBuffer.destroy(),this._meshBuffer=null)},i.updateAssembler=function(t){t.currIsStatic=!0,this._dirty&&(t.finishMergeBatches(),this._lastMeshBuffer=t.currBufferBatch,t.currBufferBatch=this._meshBuffer,t.currStaticRoot=this),this._init&&(t.finishMergeBatches(),t.commitStaticBatch(this))},i.postUpdateAssembler=function(t){this._dirty&&(t.finishMergeBatches(),t.currBufferBatch=this._lastMeshBuffer,t.currStaticRoot=null,this._dirty=!1,this._init=!0,this.node._static=!0,this._meshBuffer.uploadBuffers()),t.currIsStatic=!1},i.markAsDirty=function(){this._getBatcher()&&(this.node._static=!1,this._dirty=!0,this._init=!1,this._clearData())},i._requireDrawBatch=function(){var t=new Wi;return t.isStatic=!0,this._uiDrawBatchList.push(t),t},i._clearData=function(){if(this._meshBuffer){this._meshBuffer.reset();for(var t=this._getBatcher(),e=0;e<this._uiDrawBatchList.length;e++)this._uiDrawBatchList[e].destroy(t)}this._uiDrawBatchList.length=0,this._init=!1},i._getBatcher=function(){return Z.root&&Z.root.batcher2D?Z.root.batcher2D:(O(9301),null)},i._arrivalMaxBuffer=function(){var t=this._getBatcher();t&&t.autoMergeBatches(),O(9300)},y(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"drawBatchList",get:function(){return this._uiDrawBatchList}}]),e}(bt),m((bi=vi).prototype,"color",[b,mi],Object.getOwnPropertyDescriptor(bi.prototype,"color"),bi.prototype),gi=bi))||gi)||gi)||gi)||gi)),ji=(t("c",(Si=s("cc.LabelShadow"),Ci=v(),Ti=et(110),xi=S(),Ai=it(ot),Di=T(),Ei=T(),Oi=T(),Si(Ii=Ci(Ii=Ti(Ii=xi(Ii=Ai(Ii=L((Fi=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return e=t.call.apply(t,[this].concat(n))||this,D(e,"_color",Ri,E(e)),D(e,"_offset",Li,E(e)),D(e,"_blur",Bi,E(e)),e}o(e,t);var i=e.prototype;return i.onEnable=function(){this._updateRenderData()},i.onDisable=function(){this._updateRenderData()},i._updateRenderData=function(){var t=this.node.getComponent(ot);t&&t.updateRenderData(!0)},y(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset=t,this._updateRenderData()}},{key:"blur",get:function(){return this._blur},set:function(t){this._blur=t,this._updateRenderData()}}]),e}(B),Ri=m((wi=Fi).prototype,"_color",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h(0,0,0,255)}}),Li=m(wi.prototype,"_offset",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new i(2,2)}}),Bi=m(wi.prototype,"_blur",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),m(wi.prototype,"color",[Di],Object.getOwnPropertyDescriptor(wi.prototype,"color"),wi.prototype),m(wi.prototype,"offset",[Ei],Object.getOwnPropertyDescriptor(wi.prototype,"offset"),wi.prototype),m(wi.prototype,"blur",[Oi],Object.getOwnPropertyDescriptor(wi.prototype,"blur"),wi.prototype),Ii=wi))||Ii)||Ii)||Ii)||Ii)||Ii)||Ii)),t("d",s("cc.UIOpacity")(ki=v()(ki=et(110)(ki=S()(ki=L((zi=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return e=t.call.apply(t,[this].concat(n))||this,D(e,"_opacity",Pi,E(e)),e}o(e,t);var i=e.prototype;return i.onEnable=function(){this.node._uiProps.localOpacity=this._opacity/255},i.onDisable=function(){this.node._uiProps.localOpacity=1},y(e,[{key:"opacity",get:function(){return this._opacity},set:function(t){this._opacity!==t&&(t=q(t,0,255),this._opacity=t,this.node._uiProps.localOpacity=t/255)}}]),e}(B),m((Mi=zi).prototype,"opacity",[Y],Object.getOwnPropertyDescriptor(Mi.prototype,"opacity"),Mi.prototype),Pi=m(Mi.prototype,"_opacity",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),ki=Mi))||ki)||ki)||ki)||ki)||ki));u.MaskComponent=se,Q.setClassAlias(se,"cc.MaskComponent"),u.LabelComponent=ot,Q.setClassAlias(ot,"cc.LabelComponent"),u.LabelOutlineComponent=ei,Q.setClassAlias(ei,"cc.LabelOutlineComponent"),u.RichTextComponent=ci,Q.setClassAlias(ci,"cc.RichTextComponent"),u.SpriteComponent=pt,Q.setClassAlias(pt,"cc.SpriteComponent"),u.UIModelComponent=ui,Q.setClassAlias(ui,"cc.UIModelComponent"),u.GraphicsComponent=Ct,Q.setClassAlias(Ct,"cc.GraphicsComponent"),Q.setClassAlias(Ni,"cc.UIStaticBatchComponent"),Q.setClassAlias(ji,"cc.UIOpacityComponent")}}}));
