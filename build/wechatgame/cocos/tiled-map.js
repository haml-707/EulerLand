System.register(["./fog-c82f3158.js","./index-0a9deebe.js","./screen-b918b2af.js","./renderable-component-542a40ea.js","./transform-utils-a9e236ca.js","./json-asset-1decacc3.js","./camera-component-b0aa23d4.js","./sprite-frame-557587a3.js","./sprite-0a30f3f0.js","./renderable-2d-3f4a77a2.js","./deprecated-a4c570aa.js","./ZipUtils-3ae2be0b.js"],(function(t){"use strict";var e,i,r,s,n,o,a,h,l,u,g,f,d,_,p,c,m,y,v,A,w,b,S,T,x,I,C,D,N,O,P,E,G,z,L,F,R,M,X,U,j,H,B,k,Y,V,Z;return{setters:[function(t){e=t.dx,i=t.cU,r=t.d8,s=t.d4,n=t.d6,o=t.c,a=t.f,h=t.eM,l=t.eQ,u=t.eY,g=t.dQ,f=t.eN,d=t.w,_=t.fz,p=t.eX,c=t.eT,m=t.fA,y=t.f3,v=t.ek,A=t.d1,w=t.cW,b=t.ed,S=t.eh,T=t.dS,x=t.dM,I=t.V,C=t.dT,D=t.dX,N=t.fB,O=t.eS,P=t.t,E=t.ea,G=t.fC,z=t.fV,L=t.fg},function(t){F=t.B,R=t.f},function(){},function(t){M=t.r},function(){},function(t){X=t.T},function(){},function(t){U=t.S},function(t){j=t.c,H=t.a},function(t){B=t.M,k=t.R,Y=t.U},function(){},function(t){V=t.c,Z=t._}],execute:function(){var K,W,q,J,Q,$,tt;!function(t){t[t.ORTHO=0]="ORTHO",t[t.HEX=1]="HEX",t[t.ISO=2]="ISO"}(K||(K={})),e(K),function(t){t[t.NONE=0]="NONE",t[t.MAP=1]="MAP",t[t.LAYER=2]="LAYER",t[t.OBJECTGROUP=3]="OBJECTGROUP",t[t.OBJECT=4]="OBJECT",t[t.TILE=5]="TILE"}(W||(W={})),e(W),function(t){t[t.HORIZONTAL=2147483648]="HORIZONTAL",t[t.VERTICAL=1073741824]="VERTICAL",t[t.DIAGONAL=536870912]="DIAGONAL",t[t.FLIPPED_ALL=4026531840]="FLIPPED_ALL",t[t.FLIPPED_MASK=268435455]="FLIPPED_MASK"}(q||(q={})),e(q),function(t){t[t.STAGGERAXIS_X=0]="STAGGERAXIS_X",t[t.STAGGERAXIS_Y=1]="STAGGERAXIS_Y"}(J||(J={})),e(J),function(t){t[t.STAGGERINDEX_ODD=0]="STAGGERINDEX_ODD",t[t.STAGGERINDEX_EVEN=1]="STAGGERINDEX_EVEN"}(Q||(Q={})),e(Q),function(t){t[t.RightDown=0]="RightDown",t[t.RightUp=1]="RightUp",t[t.LeftDown=2]="LeftDown",t[t.LeftUp=3]="LeftUp"}($||($={})),e($),function(t){t[t.RECT=0]="RECT",t[t.ELLIPSE=1]="ELLIPSE",t[t.POLYGON=2]="POLYGON",t[t.POLYLINE=3]="POLYLINE",t[t.IMAGE=4]="IMAGE",t[t.TEXT=5]="TEXT"}(tt||(tt={})),e(tt);var et=function(){function t(){this.name="",this.firstGid=0,this.spacing=0,this.margin=0,this.sourceImage=void 0,this.imageName=null,this.imageSize=new s(0,0),this.tileOffset=new i(0,0),this._tileSize=new s(0,0),this.collection=!1}return t.prototype.rectForGID=function(t,e){var i=e||new n(0,0,0,0);i.width=this._tileSize.width,i.height=this._tileSize.height;var r=t;r&=q.FLIPPED_MASK,r-=this.firstGid;var s=Math.floor((this.imageSize.width-2*this.margin+this.spacing)/(this._tileSize.width+this.spacing));return i.x=Math.round(r%s*(this._tileSize.width+this.spacing)+this.margin),i.y=Math.round(Math.floor(r/s)*(this._tileSize.height+this.spacing)+this.margin),i},t}(),it=function(){function t(){this.properties={},this.name="",this.objects=[],this.visible=!0,this.opacity=0,this.color=new r(255,255,255,255),this.offset=new i(0,0),this.draworder="topdown",this.tintColor=null}var e=t.prototype;return e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},t}(),rt=function(){function t(){this.properties={},this.name="",this.layerSize=null,this.tiles=[],this.visible=!0,this.opacity=0,this.ownTiles=!0,this.minGID=1e5,this.maxGID=0,this.offset=new i(0,0),this.tintColor=null}var e=t.prototype;return e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},t}();rt.ATTRIB_NONE=1,rt.ATTRIB_BASE64=2,rt.ATTRIB_GZIP=4,rt.ATTRIB_ZLIB=8;var st=function(){this.name="",this.visible=!0,this.width=0,this.height=0,this.offset=new i(0,0),this.opacity=0,this.trans=new r(255,255,255,255),this.sourceImage=void 0,this.tintColor=null};function nt(t){var e=j.HorizontalAlign;switch(t){case"center":return e.CENTER;case"right":return e.RIGHT;default:return e.LEFT}}function ot(t){var e=j.VerticalAlign;switch(t){case"center":return e.CENTER;case"bottom":return e.BOTTOM;default:return e.TOP}}function at(t){if(!t)return new r(0,0,0,255);if(8===(t=-1!==t.indexOf("#")?t.substring(1):t).length){var e=parseInt(t.substr(0,2),16)||255,i=parseInt(t.substr(2,2),16)||0,s=parseInt(t.substr(4,2),16)||0,n=parseInt(t.substr(6,2),16)||0;return new r(i,s,n,e)}var o=parseInt(t.substr(0,2),16)||0,a=parseInt(t.substr(2,2),16)||0,h=parseInt(t.substr(4,2),16)||0;return new r(o,a,h,255)}function ht(t,e){for(var i=[],r=t.getElementsByTagName("properties"),s=0;s<r.length;++s)for(var n=r[s].getElementsByTagName("property"),o=0;o<n.length;++o)i.push(n[o]);e=e||{};for(var a=0;a<i.length;a++){var h=i[a],l=h.getAttribute("name"),u=h.getAttribute("type")||"string",g=h.getAttribute("value");"int"===u?g=parseInt(g):"float"===u?g=parseFloat(g):"bool"===u?g="true"===g:"color"===u&&(g=at(g)),e[l]=g}return e}var lt,ut,gt,ft,dt,_t,pt,ct,mt,yt,vt,At,wt,bt,St,Tt=function(){function t(t,e,i,r,n){this.properties={},this.orientation=null,this.parentElement=null,this.parentGID=0,this.layerAttrs=0,this.storingCharacters=!1,this.currentString=null,this.renderOrder=$.RightDown,this._supportVersion=[1,4,0],this._objectGroups=[],this._allChildren=[],this._mapSize=new s(0,0),this._tileSize=new s(0,0),this._layers=[],this._tilesets=[],this._imageLayers=[],this._tileProperties=new Map,this._tileAnimations={},this._tsxContentMap=null,this._spriteFrameMap=null,this._spfSizeMap={},this._staggerAxis=null,this._staggerIndex=null,this._hexSideLength=0,this._imageLayerSPF=null,this.initWithXML(t,e,i,r,n)}var e=t.prototype;return e.getOrientation=function(){return this.orientation},e.setOrientation=function(t){this.orientation=t},e.getStaggerAxis=function(){return this._staggerAxis},e.setStaggerAxis=function(t){this._staggerAxis=t},e.getStaggerIndex=function(){return this._staggerIndex},e.setStaggerIndex=function(t){this._staggerIndex=t},e.getHexSideLength=function(){return this._hexSideLength},e.setHexSideLength=function(t){this._hexSideLength=t},e.getMapSize=function(){return new s(this._mapSize.width,this._mapSize.height)},e.setMapSize=function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},e.getTileSize=function(){return new s(this._tileSize.width,this._tileSize.height)},e.setTileSize=function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},e.getLayers=function(){return this._layers},e.setLayers=function(t){this._allChildren.push(t),this._layers.push(t)},e.getImageLayers=function(){return this._imageLayers},e.setImageLayers=function(t){this._allChildren.push(t),this._imageLayers.push(t)},e.getTilesets=function(){return this._tilesets},e.setTilesets=function(t){this._tilesets.push(t)},e.getObjectGroups=function(){return this._objectGroups},e.setObjectGroups=function(t){this._allChildren.push(t),this._objectGroups.push(t)},e.getAllChildren=function(){return this._allChildren},e.getParentElement=function(){return this.parentElement},e.setParentElement=function(t){this.parentElement=t},e.getParentGID=function(){return this.parentGID},e.setParentGID=function(t){this.parentGID=t},e.getLayerAttribs=function(){return this.layerAttrs},e.setLayerAttribs=function(t){this.layerAttrs=t},e.getStoringCharacters=function(){return this.storingCharacters},e.setStoringCharacters=function(t){this.storingCharacters=t},e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},e.initWithXML=function(t,e,i,r,s){return this._tilesets.length=0,this._layers.length=0,this._imageLayers.length=0,this._tsxContentMap=e,this._spriteFrameMap=i,this._imageLayerSPF=s,this._spfSizeMap=r,this._objectGroups.length=0,this._allChildren.length=0,this.properties={},this._tileProperties=new Map,this._tileAnimations=new Map,this.currentString="",this.storingCharacters=!1,this.layerAttrs=rt.ATTRIB_NONE,this.parentElement=null,this.parseXMLString(t)},e.parseXMLString=function(e,i){var r,n=(new F).parse(e).documentElement,h=n.getAttribute("orientation"),l=n.getAttribute("staggeraxis"),u=n.getAttribute("staggerindex"),g=n.getAttribute("hexsidelength"),f=n.getAttribute("renderorder"),d=n.getAttribute("version")||"1.0.0";if("map"===n.nodeName){var _=d.split("."),p=this._supportVersion;for(r=0;r<p.length;r++){var c=parseInt(_[r])||0;if(p[r]<c){o(7216,d);break}}"orthogonal"===h?this.orientation=K.ORTHO:"isometric"===h?this.orientation=K.ISO:"hexagonal"===h?this.orientation=K.HEX:null!==h&&o(7217,h),this.renderOrder="right-up"===f?$.RightUp:"left-up"===f?$.LeftUp:"left-down"===f?$.LeftDown:$.RightDown,"x"===l?this.setStaggerAxis(J.STAGGERAXIS_X):"y"===l&&this.setStaggerAxis(J.STAGGERAXIS_Y),"odd"===u?this.setStaggerIndex(Q.STAGGERINDEX_ODD):"even"===u&&this.setStaggerIndex(Q.STAGGERINDEX_EVEN),g&&this.setHexSideLength(parseFloat(g));var m=new s(0,0);m.width=parseFloat(n.getAttribute("width")),m.height=parseFloat(n.getAttribute("height")),this.setMapSize(m),(m=new s(0,0)).width=parseFloat(n.getAttribute("tilewidth")),m.height=parseFloat(n.getAttribute("tileheight")),this.setTileSize(m),this.properties=ht(n)}var y=n.getElementsByTagName("tileset");for("map"!==n.nodeName&&(y=[]).push(n),r=0;r<y.length;r++){var v=y[r],A=v.getAttribute("source");if(A){var w=parseInt(v.getAttribute("firstgid")),b=this._tsxContentMap[A];b&&this.parseXMLString(b,w)}else{var S=v.getElementsByTagName("image"),T=S.length>1,x=S[0],I=x.getAttribute("source");I=I.replace(/\\/g,"/");var C=v.getElementsByTagName("tile"),D=C&&C.length||1,N=null,O=v.getAttribute("name")||"",P=parseInt(v.getAttribute("spacing"))||0,E=parseInt(v.getAttribute("margin"))||0,G=i||parseInt(v.getAttribute("firstgid"))||0,z=new s(0,0);z.width=parseFloat(v.getAttribute("tilewidth")),z.height=parseFloat(v.getAttribute("tileheight"));var L=v.getElementsByTagName("tileoffset")[0],R=0,M=0;L&&(R=parseFloat(L.getAttribute("x"))||0,M=parseFloat(L.getAttribute("y"))||0);for(var X=null,U=0;U<D;U++){if(!X||T){if((X=new et).name=O,X.firstGid=G&q.FLIPPED_MASK,X.tileOffset.x=R,X.tileOffset.y=M,X.collection=T,!T&&(X.imageName=I,X.imageSize.width=parseFloat(x.getAttribute("width"))||0,X.imageSize.height=parseFloat(x.getAttribute("height"))||0,X.sourceImage=this._spriteFrameMap[I],!X.sourceImage)){var j=t.getNameWithPostfix(I);if(X.imageName=j,X.sourceImage=this._spriteFrameMap[j],!X.sourceImage){var H=t.getShortName(I);X.imageName=H,X.sourceImage=this._spriteFrameMap[H],X.sourceImage||(console.error("[error]: "+H+" not find in ["+Object.keys(this._spriteFrameMap).join(", ")+"]"),a(7221,I),console.warn("Please try asset type of "+I+" to 'sprite-frame'"))}}X.spacing=P,X.margin=E,X._tileSize.width=z.width,X._tileSize.height=z.height,this.setTilesets(X)}if(N=C&&C[U]){this.parentGID=G+(parseInt(N.getAttribute("id"))||0);var B=N.getElementsByTagName("image");if(B&&B.length>0){var k=B[0],Y=k.getAttribute("source");if(Y=Y.replace(/\\/g,"/"),X.imageName=Y,X.imageSize.width=parseFloat(k.getAttribute("width"))||0,X.imageSize.height=parseFloat(k.getAttribute("height"))||0,X._tileSize.width=X.imageSize.width,X._tileSize.height=X.imageSize.height,X.sourceImage=this._spriteFrameMap[Y],!X.sourceImage){var V=t.getNameWithPostfix(I);if(X.imageName=V,X.sourceImage=this._spriteFrameMap[V],!X.sourceImage){var Z=t.getShortName(Y);X.imageName=Z,X.sourceImage=this._spriteFrameMap[Z],X.sourceImage||(a(7221,Y),console.warn("Please try asset type of "+Y+" to 'sprite-frame'"))}}X.firstGid=this.parentGID&q.FLIPPED_MASK}var W=(q.FLIPPED_MASK&this.parentGID)>>>0;this._tileProperties.set(W,ht(N));var tt=N.getElementsByTagName("animation");if(tt&&tt.length>0){var it=tt[0].getElementsByTagName("frame"),rt={frames:[],dt:0,frameIdx:0};this._tileAnimations.set(W,rt);for(var st=rt.frames,nt=0;nt<it.length;nt++){var ot=it[nt],at=G+(parseInt(ot.getAttribute("tileid"))||0),lt=parseFloat(ot.getAttribute("duration"))||0;st.push({tileid:at,duration:lt/1e3,grid:null})}}}}}}var ut=n.childNodes;for(r=0;r<ut.length;r++){var gt=ut[r];if(!this._shouldIgnoreNode(gt)){if("imagelayer"===gt.nodeName){var ft=this._parseImageLayer(gt);ft&&this.setImageLayers(ft)}if("layer"===gt.nodeName){var dt=this._parseLayer(gt);this.setLayers(dt)}if("objectgroup"===gt.nodeName){var _t=this._parseObjectGroup(gt);this.setObjectGroups(_t)}}}return n},e._shouldIgnoreNode=function(t){return 3===t.nodeType||8===t.nodeType||4===t.nodeType},e._parseImageLayer=function(t){var e=t.getElementsByTagName("image");if(!e||0===e.length)return null;var i=new st;i.name=t.getAttribute("name"),i.offset.x=parseFloat(t.getAttribute("offsetx"))||0,i.offset.y=parseFloat(t.getAttribute("offsety"))||0;var r=t.getAttribute("visible");i.visible=!("0"===r);var s=t.getAttribute("opacity");i.opacity=s?Math.round(255*parseFloat(s)):255;var n=t.getAttribute("tintcolor");i.tintColor=n?at(n):null;var o=e[0],h=o.getAttribute("source");return i.sourceImage=this._imageLayerSPF[h],i.width=parseInt(o.getAttribute("width"))||0,i.height=parseInt(o.getAttribute("height"))||0,i.trans=at(o.getAttribute("trans")),i.sourceImage?i:(a(7221,h),console.warn("Please try asset type of "+h+" to 'sprite-frame'"),null)},e._parseLayer=function(t){var e=t.getElementsByTagName("data")[0],r=new rt;r.name=t.getAttribute("name");var n=new s(0,0);n.width=parseFloat(t.getAttribute("width")),n.height=parseFloat(t.getAttribute("height")),r.layerSize=n;var a=t.getAttribute("visible");r.visible=!("0"===a);var h=t.getAttribute("opacity");r.opacity=h?Math.round(255*parseFloat(h)):255,r.offset=new i(parseFloat(t.getAttribute("offsetx"))||0,parseFloat(t.getAttribute("offsety"))||0);var l=t.getAttribute("tintcolor");r.tintColor=l?at(l):null;for(var u="",g=0;g<e.childNodes.length;g++)u+=e.childNodes[g].nodeValue;u=u.trim();var f,d=e.getAttribute("compression"),_=e.getAttribute("encoding");if(d&&"gzip"!==d&&"zlib"!==d)return o(7218),null;switch(d){case"gzip":f=V.unzipBase64AsArray(u,4);break;case"zlib":f=function(t){if(t.length%4!=0)return null;for(var e=t.length/4,i=window.Uint32Array?new Uint32Array(e):[],r=0;r<e;r++){var s=4*r;i[r]=t[s]+256*t[s+1]+65536*t[s+2]+t[s+3]*(1<<24)}return i}(new Z.Inflate(V.Base64.decodeAsArray(u,1)).decompress());break;case null:case"":if("base64"===_)f=V.Base64.decodeAsArray(u,4);else if("csv"===_){f=[];for(var p=u.split(","),c=0;c<p.length;c++)f.push(parseInt(p[c]))}else{var m=e.getElementsByTagName("tile");f=[];for(var y=0;y<m.length;y++)f.push(parseInt(m[y].getAttribute("gid")))}break;default:this.layerAttrs===rt.ATTRIB_NONE&&o(7219)}return f&&(r.tiles=new Uint32Array(f)),r.properties=ht(t),r},e._parseObjectGroup=function(t){var e=new it;e.name=t.getAttribute("name")||"",e.offset=new i(parseFloat(t.getAttribute("offsetx")),parseFloat(t.getAttribute("offsety")));var r=t.getAttribute("opacity");e.opacity=r?Math.round(255*parseFloat(r)):255;var s=t.getAttribute("tintcolor");e.tintColor=s?at(s):null;var n=t.getAttribute("visible");n&&0===parseInt(n)&&(e.visible=!1);var o=t.getAttribute("color");o&&e.color.fromHEX(o);var a=t.getAttribute("draworder");a&&(e.draworder=a),e.setProperties(ht(t));var h=t.getElementsByTagName("object");if(h){for(var l=0;l<h.length;l++){var u=h[l],g={};g.id=u.getAttribute("id")||l,g.name=u.getAttribute("name")||"",g.width=parseFloat(u.getAttribute("width"))||0,g.height=parseFloat(u.getAttribute("height"))||0,g.x=parseFloat(u.getAttribute("x"))||0,g.y=parseFloat(u.getAttribute("y"))||0,g.rotation=parseFloat(u.getAttribute("rotation"))||0,ht(u,g);var f=u.getAttribute("visible");g.visible=!(f&&0===parseInt(f));var d=u.getElementsByTagName("text");if(d&&d.length>0){var _=d[0];g.type=tt.TEXT,g.wrap="1"===_.getAttribute("wrap"),g.color=at(_.getAttribute("color")),g.halign=nt(_.getAttribute("halign")),g.valign=ot(_.getAttribute("valign")),g.pixelsize=parseInt(_.getAttribute("pixelsize"))||16,g.text=_.childNodes[0].nodeValue}var p=u.getAttribute("gid");p&&(g.gid=parseInt(p),g.type=tt.IMAGE);var c=u.getElementsByTagName("ellipse");c&&c.length>0&&(g.type=tt.ELLIPSE);var m=u.getElementsByTagName("polygon");if(m&&m.length>0){g.type=tt.POLYGON;var y=m[0].getAttribute("points");y&&(g.points=this._parsePointsString(y))}var v=u.getElementsByTagName("polyline");if(v&&v.length>0){g.type=tt.POLYLINE;var A=v[0].getAttribute("points");A&&(g.polylinePoints=this._parsePointsString(A))}g.type||(g.type=tt.RECT),e.objects.push(g)}"index"!==a&&e.objects.sort((function(t,e){return t.y-e.y}))}return e},e._parsePointsString=function(t){if(!t)return null;for(var e=[],i=t.split(" "),r=0;r<i.length;r++){var s=i[r].split(",");e.push({x:parseFloat(s[0]),y:parseFloat(s[1])})}return e},e.setTileAnimations=function(t){this._tileAnimations=t},e.getTileAnimations=function(){return this._tileAnimations},e.getTileProperties=function(){return this._tileProperties},e.setTileProperties=function(t){this._tileProperties=t},e.getCurrentString=function(){return this.currentString},e.setCurrentString=function(t){this.currentString=t},t.getNameWithPostfix=function(t){var e=(t=t.replace(/\\/g,"/")).lastIndexOf("/")+1,i=t.length;return t.substring(e,i)},t.getShortName=function(t){var e=(t=t.replace(/\\/g,"/")).lastIndexOf("/")+1,i=t.lastIndexOf(".");return i=i<0?t.length:i,t.substring(e,i)},h(t,[{key:"mapSize",get:function(){return this._mapSize}},{key:"tileSize",get:function(){return this._tileSize}},{key:"mapWidth",get:function(){return this._mapSize.width},set:function(t){this._mapSize.width=t}},{key:"mapHeight",get:function(){return this._mapSize.height},set:function(t){this._mapSize.height=t}},{key:"tileWidth",get:function(){return this._tileSize.width},set:function(t){this._tileSize.width=t}},{key:"tileHeight",get:function(){return this._tileSize.height},set:function(t){this._tileSize.height=t}}]),t}(),xt=t("TiledTile",(lt=l("cc.TiledTile"),ut=p(),gt=c(),ft=u(g),dt=u(g),_t=u(g),pt=u(g),ct=u(g),lt(mt=ut(mt=gt((wt=function(t){function e(){var e;return(e=t.call(this)||this)._layer=null,m(e,"_x",vt,y(e)),m(e,"_y",At,y(e)),e}f(e,t);var i=e.prototype;return i.onEnable=function(){var t=this.node.parent;this._layer=t.getComponent("cc.TiledLayer"),this._resetTile(),this.updateInfo()},i.onDisable=function(){this._resetTile()},i._resetTile=function(){this._layer&&this._layer.getTiledTileAt(this._x,this._y)===this&&this._layer.setTiledTileAt(this._x,this._y,null)},i.updateInfo=function(){if(this._layer){var t=this._x,e=this._y;if(this._layer.getTiledTileAt(t,e))d("There is already a TiledTile at [%s, %s]",t,e);else{var i=this._layer.getPositionAt(t,e);this.node.setPosition(i.x,i.y),this._layer.setTiledTileAt(t,e,this)}}},h(e,[{key:"x",get:function(){return this._x},set:function(t){t!==this._x&&(this._layer&&this._layer.isInvalidPosition(t,this._y)?d("Invalid x, the valid value is between [%s] ~ [%s]",0,this._layer.layerSize.width):(this._resetTile(),this._x=t,this.updateInfo()))}},{key:"y",get:function(){return this._y},set:function(t){t!==this._y&&(this._layer&&this._layer.isInvalidPosition(this._x,t)?d("Invalid y, the valid value is between [%s] ~ [%s]",0,this._layer.layerSize.height):(this._resetTile(),this._y=t,this.updateInfo()))}},{key:"grid",get:function(){return this._layer?this._layer.getTileGIDAt(this._x,this._y):0},set:function(t){this._layer&&this._layer.setTileGIDAt(t,this._x,this._y)}}]),e}(v),vt=_((yt=wt).prototype,"_x",[ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),At=_(yt.prototype,"_y",[dt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_(yt.prototype,"x",[_t],Object.getOwnPropertyDescriptor(yt.prototype,"x"),yt.prototype),_(yt.prototype,"y",[pt],Object.getOwnPropertyDescriptor(yt.prototype,"y"),yt.prototype),_(yt.prototype,"grid",[ct],Object.getOwnPropertyDescriptor(yt.prototype,"grid"),yt.prototype),mt=yt))||mt)||mt)||mt));function It(t,e,i){var r=i||t.sourceImage,s=r.texture,o=t.collection;if(!t.imageSize.width||!t.imageSize.height){var a=t.sourceImage;t.imageSize.width=a.width,t.imageSize.height=a.height}var h=t.imageSize.width,l=t.imageSize.height,u=t._tileSize.width,g=t._tileSize.height,f=r.width,d=r.height,_=t.spacing,p=t.margin,c=1;if(!o){var m=Math.floor((h-2*p+_)/(u+_)),y=Math.floor((l-2*p+_)/(g+_));c=Math.max(1,y*m)}for(var v=t.firstGid,A=null,w=!!e.get(v),b=t.firstGid+c,S=v;S<b&&(w&&!e.get(S)&&(w=!1),w||!e.get(S));++S){if(A={tileset:t,x:0,y:0,width:u,height:g,t:0,l:0,r:0,b:0,cx:0,cy:0,offsetX:0,offsetY:0,rotated:!1,gid:S,spriteFrame:r,texture:s},t.rectForGID(S,A),!i||c>1)if(i){A._name=i.name;var T=i.unbiasUV[0],x=i.rotated?i.unbiasUV[1]:i.unbiasUV[5];A.l=T+(A.x+.5)/f,A.t=x+(A.y+.5)/d,A.r=T+(A.x+A.width-.5)/f,A.b=x+(A.y+A.height-.5)/d,A._rect=new n(A.x,A.y,A.width,A.height)}else A.l=A.x/f,A.t=A.y/d,A.r=(A.x+A.width)/f,A.b=(A.y+A.height)/d,A._rect=new n(A.x,A.y,A.width,A.height);else i.rotated?(A._rotated=!0,A._name=i.name,A._rect=i.getRect(),A.l=i.unbiasUV[0],A.t=i.unbiasUV[1],A.r=i.unbiasUV[4],A.b=i.unbiasUV[3]):(A._name=i.name,A._rect=i.getRect(),A.l=i.unbiasUV[0],A.t=i.unbiasUV[5],A.r=i.unbiasUV[2],A.b=i.unbiasUV[1]);A.cx=(A.l+A.r)/2,A.cy=(A.t+A.b)/2,e.set(S,A)}}function Ct(t,e){var i=t.length;if(0!==i)for(var r=0,s=function(){++r>=i&&e()},n=0;n<i;n++){var o=t[n];o.loaded?s():o.once("load",(function(){s()}))}else e()}for(var Dt,Nt,Ot,Pt,Et,Gt,zt,Lt,Ft,Rt,Mt,Xt,Ut,jt,Ht,Bt,kt,Yt,Vt,Zt,Kt,Wt,qt,Jt,Qt,$t,te,ee,ie,re,se,ne,oe,ae,he,le,ue,ge,fe,de=new A,_e=new i,pe=new w,ce=new w,me={row:0,col:0},ye=t("TiledUserNodeData",l("cc.TiledUserNodeData")(bt=function(t){function e(){var e;return(e=t.call(this)||this)._index=-1,e._row=-1,e._col=-1,e._tiledLayer=null,e}return f(e,t),e}(v))||bt),ve=t("TiledLayer",l("cc.TiledLayer")(St=function(t){function e(){var e;return(e=t.call(this)||this)._userNodeGrid={},e._userNodeMap={},e._userNodeDirty=!1,e.tiledTiles=[],e._viewPort={x:-1,y:-1,width:-1,height:-1},e._cullingRect={leftDown:{row:-1,col:-1},rightTop:{row:-1,col:-1}},e._cullingDirty=!0,e._rightTop={row:-1,col:-1},e._layerInfo=null,e._mapInfo=null,e._topOffset=0,e._downOffset=0,e._leftOffset=0,e._rightOffset=0,e.tiles=[],e.vertices=[],e._verticesDirty=!0,e._layerName="",e._layerSize=void 0,e._minGID=void 0,e._maxGID=void 0,e._layerOrientation=null,e._opacity=void 0,e._tintColor=void 0,e.texGrids=null,e._textures=[],e._tilesets=[],e._leftDownToCenterX=0,e._leftDownToCenterY=0,e._hasTiledNodeGrid=!1,e._hasAniGrid=!1,e._animations=null,e._enableCulling=void 0,e.colorChanged=!1,e._properties=void 0,e.renderOrder=void 0,e._staggerAxis=void 0,e._staggerIndex=void 0,e._hexSideLength=void 0,e._mapTileSize=void 0,e._odd_even=void 0,e._diffX1=void 0,e._diffY1=void 0,e._useAutomaticVertexZ=void 0,e._vertexZvalue=void 0,e._offset=void 0,e._meshRenderDataArray=null,e._meshRenderDataArrayIdx=0,e}f(e,t);var r=e.prototype;return r.hasTiledNode=function(){return this._hasTiledNodeGrid},r.hasAnimation=function(){return this._hasAniGrid},r.addUserNode=function(t){var e=t.getComponent(ye);return e?(d("CCTiledLayer:addUserNode node has been added"),!1):(e=t.addComponent(ye),t.parent=this.node,this._userNodeMap[t.uuid]=e,e._row=-1,e._col=-1,e._tiledLayer=this,this._nodeLocalPosToLayerPos(t.getPosition(),_e),this._positionToRowCol(_e.x,_e.y,me),this._addUserNodeToGrid(e,me),this._updateCullingOffsetByUserNode(t),t.on(b.TRANSFORM_CHANGED,this._userNodePosChange,e),t.on(b.SIZE_CHANGED,this._userNodeSizeChange,e),!0)},r.removeUserNode=function(t){var e=t.getComponent(ye);return e?(t.off(b.TRANSFORM_CHANGED,this._userNodePosChange,e),t.off(b.SIZE_CHANGED,this._userNodeSizeChange,e),this._removeUserNodeFromGrid(e),delete this._userNodeMap[t.uuid],t._removeComponent(e),e.destroy(),t.removeFromParent(),!0):(d("CCTiledLayer:removeUserNode node is not exist"),!1)},r.destroyUserNode=function(t){this.removeUserNode(t),t.destroy()},r._nodeLocalPosToLayerPos=function(t,e){e.x=t.x+this._leftDownToCenterX,e.y=t.y+this._leftDownToCenterY},r.getNodesByRowCol=function(t,e){var i=this._userNodeGrid[t];return i?i[e]:null},r.getNodesCountByRow=function(t){var e=this._userNodeGrid[t];return e?e.count:0},r._updateAllUserNode=function(){for(var t in this._userNodeGrid={},this._userNodeMap){var e=this._userNodeMap[t];this._nodeLocalPosToLayerPos(e.node.getPosition(),_e),this._positionToRowCol(_e.x,_e.y,me),this._addUserNodeToGrid(e,me),this._updateCullingOffsetByUserNode(e.node)}},r._updateCullingOffsetByUserNode=function(t){var e=t._uiProps.uiTransformComp.contentSize;this._topOffset<e.height&&(this._topOffset=e.height),this._downOffset<e.height&&(this._downOffset=e.height),this._leftOffset<e.width&&(this._leftOffset=e.width),this._rightOffset<e.width&&(this._rightOffset=e.width)},r._userNodeSizeChange=function(){var t=this.node,e=this._tiledLayer;e._updateCullingOffsetByUserNode(t),e._userNodeDirty=!0,e.markForUpdateRenderData()},r._userNodePosChange=function(){var t=this,e=t.node,i=t._tiledLayer;i._nodeLocalPosToLayerPos(e.getPosition(),_e),i._positionToRowCol(_e.x,_e.y,me),i._limitInLayer(me),me.row===t._row&&me.col===t._col||(i._removeUserNodeFromGrid(t),i._addUserNodeToGrid(t,me))},r._removeUserNodeFromGrid=function(t){var e=t._row,i=t._col,r=t._index,s=this._userNodeGrid[e],n=s&&s[i];n&&(s.count--,n.count--,n.list[r]=null,n.count<=0&&(n.list.length=0,n.count=0)),t._row=-1,t._col=-1,t._index=-1,this._userNodeDirty=!0,this.markForUpdateRenderData()},r._limitInLayer=function(t){var e=t.row,i=t.col;e<0&&(t.row=0),e>this._rightTop.row&&(t.row=this._rightTop.row),i<0&&(t.col=0),i>this._rightTop.col&&(t.col=this._rightTop.col)},r._addUserNodeToGrid=function(t,e){var i=e.row,r=e.col,s=this._userNodeGrid[i]=this._userNodeGrid[i]||{count:0},n=s[r]=s[r]||{count:0,list:[]};t._row=i,t._col=r,t._index=n.list.length,s.count++,n.count++,n.list.push(t),this._userNodeDirty=!0},r.isUserNodeDirty=function(){return this._userNodeDirty},r.setUserNodeDirty=function(t){this._userNodeDirty=t},r.onEnable=function(){t.prototype.onEnable.call(this),this.node.on(b.ANCHOR_CHANGED,this._syncAnchorPoint,this),this.node.on(b.TRANSFORM_CHANGED,this.updateCulling,this),this.node.on(b.SIZE_CHANGED,this.updateCulling,this),this.node.parent.on(b.TRANSFORM_CHANGED,this.updateCulling,this),this.node.parent.on(b.SIZE_CHANGED,this.updateCulling,this),this.markForUpdateRenderData(),this.scheduleOnce(this.updateCulling.bind(this))},r.onDisable=function(){t.prototype.onDisable.call(this),this.node.parent.off(b.SIZE_CHANGED,this.updateCulling,this),this.node.parent.off(b.TRANSFORM_CHANGED,this.updateCulling,this),this.node.off(b.SIZE_CHANGED,this.updateCulling,this),this.node.off(b.TRANSFORM_CHANGED,this.updateCulling,this),this.node.off(b.ANCHOR_CHANGED,this._syncAnchorPoint,this)},r._syncAnchorPoint=function(){var t=this.node,e=t._uiProps.uiTransformComp,i=t.getScale();this._leftDownToCenterX=e.width*e.anchorX*i.x,this._leftDownToCenterY=e.height*e.anchorY*i.y,this._cullingDirty=!0,this.markForUpdateRenderData()},r.onDestroy=function(){t.prototype.onDestroy.call(this)},r.getLayerName=function(){return this._layerName},r.setLayerName=function(t){this._layerName=t},r.getProperty=function(t){return this._properties[t]},r.getPositionAt=function(t,e){var i;switch(void 0!==e?(i=Math.floor(t),e=Math.floor(e)):(i=Math.floor(t.x),e=Math.floor(t.y)),this._layerOrientation){case K.ORTHO:return this._positionForOrthoAt(i,e);case K.ISO:return this._positionForIsoAt(i,e);case K.HEX:return this._positionForHexAt(i,e)}return null},r.isInvalidPosition=function(t,e){return t>=this._layerSize.width||e>=this._layerSize.height||t<0||e<0},r._positionForIsoAt=function(t,e){var r=0,s=0,n=Math.floor(t)+Math.floor(e)*this._layerSize.width,o=this.tiles[n];if(o){var a=(o&q.FLIPPED_MASK)>>>0,h=this.texGrids.get(a).tileset.tileOffset;r=h.x,s=h.y}return new i(.5*this._mapTileSize.width*(this._layerSize.height+t-e-1)+r,.5*this._mapTileSize.height*(this._layerSize.width-t+this._layerSize.height-e-2)-s)},r._positionForOrthoAt=function(t,e){var r=0,s=0,n=Math.floor(t)+Math.floor(e)*this._layerSize.width,o=this.tiles[n];if(o){var a=(o&q.FLIPPED_MASK)>>>0,h=this.texGrids.get(a).tileset.tileOffset;r=h.x,s=h.y}return new i(t*this._mapTileSize.width+r,(this._layerSize.height-e-1)*this._mapTileSize.height-s)},r._positionForHexAt=function(t,e){var r,s=this._mapTileSize.width,n=this._mapTileSize.height,o=this._layerSize.height,a=Math.floor(t)+Math.floor(e)*this._layerSize.width,h=(this.tiles[a]&q.FLIPPED_MASK)>>>0;r=this.texGrids.get(h)?this.texGrids.get(h).tileset.tileOffset:{x:0,y:0};var l=this._staggerIndex===Q.STAGGERINDEX_ODD?1:-1,u=0,g=0,f=0,d=0;switch(this._staggerAxis){case J.STAGGERAXIS_Y:f=0,e%2==1&&(f=s/2*l),u=t*s+f+r.x,g=(o-e-1)*(n-(n-this._hexSideLength)/2)-r.y;break;case J.STAGGERAXIS_X:d=0,t%2==1&&(d=n/2*-l),u=t*(s-(s-this._hexSideLength)/2)+r.x,g=(o-e-1)*n+d-r.y}return new i(u,g)},r.setTilesGIDAt=function(t,e,i,r){if(t&&0!==t.length&&!(r<=0)){i<0&&(i=0),e<0&&(e=0);for(var s=0,n=e+r,o=i;;o++)for(var a=e;a<n;a++){if(s>=t.length)return;this._updateTileForGID(t[s],a,o),s++}}},r.setTileGIDAt=function(t,e,i,r){var s=(t&q.FLIPPED_MASK)>>>0;if(e=Math.floor(e),i=Math.floor(i),this.isInvalidPosition(e,i))throw new Error("cc.TiledLayer.setTileGIDAt(): invalid position");this.tiles&&this._tilesets&&0!==this._tilesets.length?0!==s&&s<this._tilesets[0].firstGid?o(7239,t):(r=r||0,this._updateTileForGID((s|r)>>>0,e,i)):o(7238)},r._updateTileForGID=function(t,e,i){var r=0|e+i*this._layerSize.width;if(!(r>=this.tiles.length)&&t!==this.tiles[r]){var s=(t&q.FLIPPED_MASK)>>>0;this.texGrids.get(s)?(this.tiles[r]=t,this._updateVertex(e,i)):this.tiles[r]=0,this._cullingDirty=!0}},r.getTileGIDAt=function(t,e){if(this.isInvalidPosition(t,e))throw new Error("cc.TiledLayer.getTileGIDAt(): invalid position");if(!this.tiles)return o(7237),null;var i=Math.floor(t)+Math.floor(e)*this._layerSize.width;return(this.tiles[i]&q.FLIPPED_MASK)>>>0},r.getTileFlagsAt=function(t,e){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.getTileFlagsAt: invalid position");if(!this.tiles)return o(7240),null;var i=Math.floor(t)+Math.floor(e)*this._layerSize.width;return(this.tiles[i]&q.FLIPPED_ALL)>>>0},r.setCullingDirty=function(t){this._cullingDirty=t},r.isCullingDirty=function(){return this._cullingDirty},r.updateViewPort=function(t,e,i,r){if(this._viewPort.width!==i||this._viewPort.height!==r||this._viewPort.x!==t||this._viewPort.y!==e){this._viewPort.x=t,this._viewPort.y=e,this._viewPort.width=i,this._viewPort.height=r;var s=1;this._layerOrientation===K.ISO&&(s=2);var n=this._viewPort.x-this._offset.x+this._leftDownToCenterX,o=this._viewPort.y-this._offset.y+this._leftDownToCenterY,a=n-this._leftOffset,h=o-this._downOffset,l=n+i+this._rightOffset,u=o+r+this._topOffset,g=this._cullingRect.leftDown,f=this._cullingRect.rightTop;a<0&&(a=0),h<0&&(h=0),this._positionToRowCol(a,h,me),me.row-=s,me.col-=s,me.row=me.row>0?me.row:0,me.col=me.col>0?me.col:0,me.row===g.row&&me.col===g.col||(g.row=me.row,g.col=me.col,this._cullingDirty=!0),l<0||u<0?(me.row=-1,me.col=-1):(this._positionToRowCol(l,u,me),me.row++,me.col++),me.row>this._rightTop.row&&(me.row=this._rightTop.row),me.col>this._rightTop.col&&(me.col=this._rightTop.col),me.row===f.row&&me.col===f.col||(f.row=me.row,f.col=me.col,this._cullingDirty=!0,this.markForUpdateRenderData())}},r._positionToRowCol=function(t,e,i){var r=this._mapTileSize.width,s=this._mapTileSize.height,n=.5*r,o=.5*s,a=0,h=0,l=0,u=0,g=this._staggerAxis;switch(this._layerOrientation){case K.ORTHO:h=Math.floor(t/r),a=Math.floor(e/s);break;case K.ISO:h=Math.floor(t/n),a=Math.floor(e/o);break;case K.HEX:g===J.STAGGERAXIS_Y?(l=(a=Math.floor(e/(s-this._diffY1)))%2==1?n*this._odd_even:0,h=Math.floor((t-l)/r)):(u=(h=Math.floor(t/(r-this._diffX1)))%2==1?o*-this._odd_even:0,a=Math.floor((e-u)/s))}return i.row=a,i.col=h,i},r.updateCulling=function(){if(this._enableCulling){this.node.updateWorldTransform(),A.invert(de,this.node.getWorldMatrix());var t=R.root.batcher2D.getFirstRenderCamera(this.node);t&&(pe.x=0,pe.y=0,pe.z=0,ce.x=t.width,ce.y=t.height,ce.z=0,t.screenToWorld(pe,pe),t.screenToWorld(ce,ce),w.transformMat4(pe,pe,de),w.transformMat4(ce,ce,de),this.updateViewPort(pe.x,pe.y,ce.x-pe.x,ce.y-pe.y))}},r.getLayerOrientation=function(){return this._layerOrientation},r.getProperties=function(){return this._properties},r._updateVertex=function(t,e){var i=q.FLIPPED_MASK,r=this.vertices,s=this._layerOrientation,n=this.tiles;if(n){var o,a,h,l,u=this._rightTop,g=this._mapTileSize.width,f=this._mapTileSize.height,d=.5*g,_=.5*f,p=this._layerSize.height,c=this._layerSize.width,m=this.texGrids,y=0,v=0;s===K.HEX&&(o=this._staggerAxis,a=this._diffX1,h=this._diffY1,l=this._odd_even);var A,w,b,S=0,T=0,x=0,I=0,C=e*c+t;A=(n[C]&i)>>>0;var D=m.get(A);if(D){switch(this._animations.get(A)&&(this._hasAniGrid=this._hasAniGrid||!0),s){case K.ORTHO:y=(S=t)*g,v=(T=p-e-1)*f;break;case K.ISO:y=d*(S=p+t-e-1),v=_*(T=p+c-t-e-2);break;case K.HEX:y=t*(g-a)+(o===J.STAGGERAXIS_Y&&e%2==1?d*l:0),v=(p-e-1)*(f-h)+(o===J.STAGGERAXIS_X&&t%2==1?_*-l:0),S=t,T=p-e-1}var N=r[T]=r[T]||{minCol:0,maxCol:0},O=N[S]=N[S]||{};N.minCol>S&&(N.minCol=S),N.maxCol<S&&(N.maxCol=S),u.row<T&&(u.row=T),u.col<S&&(u.col=S);var P=D.tileset.tileOffset;y+=this._offset.x+P.x+D.offsetX,v+=this._offset.y-P.y-D.offsetY,x=(x=-P.y+D.tileset._tileSize.height-f)<0?0:x,w=P.y<0?0:P.y,b=-P.x<0?0:-P.x,I=(I=P.x+D.tileset._tileSize.width-g)<0?0:I,this._rightOffset<b&&(this._rightOffset=b),this._leftOffset<I&&(this._leftOffset=I),this._topOffset<w&&(this._topOffset=w),this._downOffset<x&&(this._downOffset=x),O.left=y,O.bottom=v,O.index=C,this._cullingDirty=!0}}},r._updateVertices=function(){if(this.vertices.length=0,this.tiles){var t=this._rightTop;t.row=-1,t.col=-1;var e=this._layerSize.height,i=this._layerSize.width;this._topOffset=0,this._downOffset=0,this._leftOffset=0,this._rightOffset=0,this._hasAniGrid=!1;for(var r=0;r<e;++r)for(var s=0;s<i;++s)this._updateVertex(s,r);this._verticesDirty=!1}},r.getTiledTileAt=function(t,e,i){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.getTiledTileAt: invalid position");if(!this.tiles)return o(7236),null;var r=Math.floor(t)+Math.floor(e)*this._layerSize.width,s=this.tiledTiles[r];if(!s&&i){var n=new S;return(s=n.addComponent(xt))._x=t,s._y=e,s._layer=this,s.updateInfo(),n.parent=this.node,s}return s},r.setTiledTileAt=function(t,e,i){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.setTiledTileAt: invalid position");if(!this.tiles)return o(7236),null;var r=Math.floor(t)+Math.floor(e)*this._layerSize.width;return this.tiledTiles[r]=i,this._cullingDirty=!0,this._hasTiledNodeGrid=!!i||this.tiledTiles.some((function(t){return!!t})),i},r.getTexture=function(t){return t=t||0,this._textures&&t>=0&&this._textures.length>t?this._textures[t]:null},r.getTextures=function(){return this._textures},r.setTexture=function(t){this.setTextures([t])},r.setTextures=function(t){this._textures=t,this.markForUpdateRenderData()},r.getLayerSize=function(){return this._layerSize},r.getMapTileSize=function(){return this._mapTileSize},r.getTileSet=function(t){return t=t||0,this._tilesets&&t>=0&&this._tilesets.length>t?this._tilesets[t]:null},r.getTileSets=function(){return this._tilesets},r.setTileSet=function(t){this.setTileSets([t])},r.setTileSets=function(t){var e=this;this._tilesets=t;var i=this._textures=[],r=this.texGrids;r.clear();for(var s=0;s<t.length;s++){var n=t[s];n&&(i[s]=n.sourceImage)}Ct(i,(function(){for(var i=0,s=t.length;i<s;++i){var n=t[i];n&&It(n,r,n.sourceImage)}e._prepareToRender()}))},r.init=function(t,e,r,s,n){this._cullingDirty=!0,this._layerInfo=t,this._mapInfo=e;var o=t.layerSize;this._layerName=t.name,this.tiles=t.tiles,this._properties=t.properties,this._layerSize=o,this._minGID=t.minGID,this._maxGID=t.maxGID,this._opacity=t.opacity,t.tintColor&&(this._tintColor=t.tintColor),this.renderOrder=e.renderOrder,this._staggerAxis=e.getStaggerAxis(),this._staggerIndex=e.getStaggerIndex(),this._hexSideLength=e.getHexSideLength(),this._animations=e.getTileAnimations(),this._tilesets=r,this._textures=s,this.texGrids=n,this._layerOrientation=e.orientation,this._mapTileSize=e.getTileSize();var a=this._mapTileSize.width,h=this._mapTileSize.height,l=this._layerSize.width,u=this._layerSize.height;if(this._layerOrientation===K.HEX){var g=0,f=0;this._odd_even=this._staggerIndex===Q.STAGGERINDEX_ODD?1:-1,this._staggerAxis===J.STAGGERAXIS_X?(this._diffX1=(a-this._hexSideLength)/2,this._diffY1=0,f=h*(u+.5),g=(a+this._hexSideLength)*Math.floor(l/2)+a*(l%2)):(this._diffX1=0,this._diffY1=(h-this._hexSideLength)/2,g=a*(l+.5),f=(h+this._hexSideLength)*Math.floor(u/2)+h*(u%2)),this.node._uiProps.uiTransformComp.setContentSize(g,f)}else if(this._layerOrientation===K.ISO){var d=l+u;this.node._uiProps.uiTransformComp.setContentSize(.5*a*d,.5*h*d)}else this.node._uiProps.uiTransformComp.setContentSize(l*a,u*h);this._offset=new i(t.offset.x,-t.offset.y),this._useAutomaticVertexZ=!1,this._vertexZvalue=0,this._syncAnchorPoint(),this._prepareToRender()},r._prepareToRender=function(){this._updateVertices(),this._updateAllUserNode()},r.requestMeshRenderData=function(){var t=this;this._meshRenderDataArray||(this._meshRenderDataArray=[]);for(var e=this._meshRenderDataArray;e.length>0&&e[e.length-1].subNodes&&0===e[e.length-1].subNodes.length;)e.pop();if(e.length>0){var i=e[e.length-1];if(i.renderData&&0===i.renderData.byteCount)return i}var r=new B,s={renderData:r,texture:null};return Object.defineProperty(r,"material",{get:function(){return t.getRenderMaterial(0)}}),this._meshRenderDataArray.push(s),s},r.requestSubNodesData=function(){this._meshRenderDataArray||(this._meshRenderDataArray=[]);for(var t=this._meshRenderDataArray;t.length>0&&t[t.length-1].renderData&&0===t[t.length-1].renderData.byteCount;)t.pop();if(t.length>0&&t[t.length-1].subNodes&&0===t[t.length-1].subNodes.length)return t[t.length-1];var e={subNodes:[]};return this._meshRenderDataArray.push(e),e},r.destroyRenderData=function(){this._meshRenderDataArray&&(this._meshRenderDataArray.forEach((function(t){t.renderData&&t.renderData.reset()})),this._meshRenderDataArray.length=0)},r._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._meshRenderDataArray||this._assembler&&this._assembler.createData&&(this._assembler.createData(this),this.markForUpdateRenderData(),this._updateColor())},r._render=function(t){if(this._meshRenderDataArray){for(var e=0;e<this._meshRenderDataArray.length;e++){this._meshRenderDataArrayIdx=e;var i=this._meshRenderDataArray[e];i.subNodes?i.subNodes.forEach((function(e){e&&t.walk(e.node)})):i.texture&&t.commitComp(this,i.texture,this._assembler,null)}this.node._static=!0}},h(e,[{key:"cullingRect",get:function(){return this._cullingRect}},{key:"rightTop",get:function(){return this._rightTop}},{key:"layerSize",get:function(){return this._layerSize}},{key:"meshRenderDataArray",get:function(){return this._meshRenderDataArray}},{key:"leftDownToCenterX",get:function(){return this._leftDownToCenterX}},{key:"leftDownToCenterY",get:function(){return this._leftDownToCenterY}},{key:"enableCulling",get:function(){return this._enableCulling},set:function(t){this._enableCulling!==t&&(this._enableCulling=t,this._cullingDirty=!0,this.markForUpdateRenderData())}}]),e}(k))||St),Ae=t("TiledObjectGroup",(Dt=l("cc.TiledObjectGroup"),Nt=p(),Ot=M(Y),Pt=u(T),Dt(Et=Nt(Et=Ot((zt=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))||this)._premultiplyAlpha=!1,e._groupName=void 0,e._positionOffset=void 0,e._mapInfo=void 0,e._properties=void 0,e._offset=void 0,e._opacity=void 0,e._tintColor=null,e._animations=void 0,e._hasAniObj=void 0,e._texGrids=void 0,e.aniObjects=void 0,e._objects=[],e}f(e,t);var s=e.prototype;return s.getPositionOffset=function(){return this._positionOffset},s.getProperties=function(){return this._properties},s.getGroupName=function(){return this._groupName},s.getProperty=function(t){return this._properties[t.toString()]},s.getObject=function(t){for(var e=0,i=this._objects.length;e<i;e++){var r=this._objects[e];if(r&&r.name===t)return r}return null},s.getObjects=function(){return this._objects},s._init=function(t,e,s){var n=q.FLIPPED_MASK,o=q.HORIZONTAL,a=q.VERTICAL;this._groupName=t.name,this._positionOffset=t.offset,this._mapInfo=e,this._properties=t.getProperties(),this._offset=new i(t.offset.x,-t.offset.y),this._opacity=t.opacity,t.tintColor&&(this._tintColor=t.tintColor),this._texGrids=s,this._animations=e.getTileAnimations(),this.aniObjects=[],this._hasAniObj=!1;var h=e.mapSize,l=e.tileSize,u=0,g=0,f=new r,d=K.ISO===e.orientation;if(e.orientation===K.HEX)e.getStaggerAxis()===J.STAGGERAXIS_X?(g=l.height*(h.height+.5),u=(l.width+e.getHexSideLength())*Math.floor(h.width/2)+l.width*(h.width%2)):(u=l.width*(h.width+.5),g=(l.height+e.getHexSideLength())*Math.floor(h.height/2)+l.height*(h.height%2));else if(d){var _=h.width+h.height;u=.5*l.width*_,g=.5*l.height*_}else u=h.width*l.width,g=h.height*l.height;var p=this.node._uiProps.uiTransformComp;p.setContentSize(u,g);for(var c=u*p.anchorX,m=g*(1-p.anchorY),y=t.objects,v={},A=0,w=y.length;A<w;A++){var b=y[A],T=b.type;b.offset=new i(b.x,b.y);var C=b.points||b.polylinePoints;if(C)for(var D=0;D<C.length;D++)C[D].y*=-1;if(d){var N=b.x/l.height,O=b.y/l.height;b.x=.5*l.width*(h.height+N-O),b.y=.5*l.height*(h.width+h.height-N-O)}else b.y=g-b.y;if(T===tt.TEXT){var P="text"+b.id;v[P]=!0;var E=this.node.getChildByName(P);E||(E=new S),E.setRotationFromEuler(0,0,-b.rotation),E.setPosition(b.x-c,b.y-m),E.name=P,E.parent=this.node,E.setSiblingIndex(A);var G=E.getComponent(j);G||(G=E.addComponent(j));var z=E._uiProps.uiTransformComp;E.active=b.visible,z.anchorX=0,z.anchorY=1,this._tintColor?(f.set(this._tintColor),f.a*=this._opacity/255,G.color.set(f)):G.color.a*=this._opacity/255,G.overflow=j.Overflow.SHRINK,G.lineHeight=b.height,G.string=b.text,G.horizontalAlign=b.halign,G.verticalAlign=b.valign,G.fontSize=b.pixelsize,z.setContentSize(b.width,b.height)}else if(T===tt.IMAGE){var L=b.gid,F=(L&n)>>>0,R=s.get(F);if(!R)continue;var M=R.tileset,X="img"+b.id;v[X]=!0;var B=this.node.getChildByName(X);b.width=b.width||R.width,b.height=b.height||R.height,B&&B._objFlags&x.Flags.HideInHierarchy&&(B.removeFromParent(),B.hideFlags|=x.Flags.DontSave,B.destroy(),B=null),B||(B=new S),this._animations.get(F)&&(this.aniObjects.push({object:b,imgNode:B,gridGID:F}),this._hasAniObj=!0);var k=M.tileOffset.x,Y=M.tileOffset.y;B.active=b.visible,B.setRotationFromEuler(0,0,-b.rotation),B.setPosition(b.x-c,b.y-m),B.name=X,B.parent=this.node,B.setSiblingIndex(A);var V=B.getComponent(H);V||(V=B.addComponent(H));var Z=B._uiProps.uiTransformComp;d?(Z.anchorX=.5+k/b.width,Z.anchorY=Y/b.height):(Z.anchorX=k/b.width,Z.anchorY=Y/b.height),this._tintColor?(f.set(this._tintColor),f.a*=this._opacity/255,V.color.set(f)):V.color.a*=this._opacity/255,V.sizeMode=H.SizeMode.CUSTOM,V._srcBlendFactor=this._premultiplyAlpha?I.ONE:I.SRC_ALPHA,V._dstBlendFactor=I.ONE_MINUS_SRC_ALPHA,V._updateBlendFunc();var W=R.spriteFrame;W=W?W.clone():new U,(L&o)>>>0&&(W.flipUVX=!W.flipUVX),(L&a)>>>0&&(W.flipUVY=!W.flipUVY),W.rotated=R._rotated,W.rect=R._rect,V.spriteFrame=W,Z.setContentSize(b.width,b.height),V.markForUpdateRenderData()}}this._objects=y;for(var Q=this.node.children,$=/^(?:img|text)\d+$/,et=0,it=Q.length;et<it;et++){var rt=Q[et],st=rt.name;$.test(st)&&!v[st]&&rt.destroy()}},s.update=function(){if(this._hasAniObj)for(var t=this.aniObjects,e=this._texGrids,i=K.ISO===this._mapInfo.orientation,r=0,s=t.length;r<s;r++){var n=t[r],o=n.gridGID,a=e.get(o);if(a){var h=a.tileset,l=n.object,u=n.imgNode,g=h.tileOffset.x,f=h.tileOffset.y,d=u._uiProps.uiTransformComp;i?(d.anchorX=.5+g/l.width,d.anchorY=f/l.height):(d.anchorX=g/l.width,d.anchorY=f/l.height);var _=u.getComponent(H),p=_.spriteFrame;p.rotated=a._rotated,p.rect=a._rect,_.spriteFrame=p,_.markForUpdateRenderData()}}},h(e,[{key:"premultiplyAlpha",get:function(){return this._premultiplyAlpha},set:function(t){this._premultiplyAlpha=t}},{key:"offset",get:function(){return this._offset}}]),e}(v),_((Gt=zt).prototype,"premultiplyAlpha",[Pt],Object.getOwnPropertyDescriptor(Gt.prototype,"premultiplyAlpha"),Gt.prototype),Et=Gt))||Et)||Et)||Et)),we=t("TiledMapAsset",(Lt=l("cc.TiledMapAsset"),Ft=u([X]),Rt=u([C]),Mt=u([U]),Xt=u([U]),Ut=u([C]),jt=u([C]),Ht=u([s]),Lt(($t=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,m(e,"tmxXmlStr",Yt,y(e)),m(e,"tsxFiles",Vt,y(e)),m(e,"tsxFileNames",Zt,y(e)),m(e,"spriteFrames",Kt,y(e)),m(e,"imageLayerSpriteFrame",Wt,y(e)),m(e,"imageLayerSpriteFrameNames",qt,y(e)),m(e,"spriteFrameNames",Jt,y(e)),m(e,"spriteFrameSizes",Qt,y(e)),e}return f(e,t),e}(D),Yt=_((kt=$t).prototype,"tmxXmlStr",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Vt=_(kt.prototype,"tsxFiles",[N,Ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Zt=_(kt.prototype,"tsxFileNames",[N,Rt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Kt=_(kt.prototype,"spriteFrames",[N,Mt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Wt=_(kt.prototype,"imageLayerSpriteFrame",[N,Xt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qt=_(kt.prototype,"imageLayerSpriteFrameNames",[N,Ut],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Jt=_(kt.prototype,"spriteFrameNames",[N,jt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Qt=_(kt.prototype,"spriteFrameSizes",[N,Ht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Bt=kt))||Bt)),be=(t("TiledMap",(te=l("cc.TiledMap"),ee=p(),ie=c(),re=M(Y),se=u(we),ne=z(),te(oe=ee(oe=ie(oe=re(oe=O((fe=ge=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._texGrids=new Map,e._textures=[],e._tilesets=[],e._animations=new Map,e._imageLayers=[],e._layers=[],e._groups=[],e._images=[],e._properties={},e._tileProperties=new Map,e._mapInfo=null,e._mapSize=new s(0,0),e._tileSize=new s(0,0),e._preloaded=!1,e._mapOrientation=K.ORTHO,m(e,"_tmxFile",he,y(e)),m(e,"_enableCulling",le,y(e)),m(e,"cleanupImageCache",ue,y(e)),e}f(e,t);var r=e.prototype;return r.getMapSize=function(){return this._mapSize},r.getTileSize=function(){return this._tileSize},r.getMapOrientation=function(){return this._mapOrientation},r.getObjectGroups=function(){return this._groups},r.getObjectGroup=function(t){for(var e=this._groups,i=0,r=e.length;i<r;i++){var s=e[i];if(s&&s.getGroupName()===t)return s}return null},r.getProperties=function(){return this._properties},r.getLayers=function(){return this._layers},r.getLayer=function(t){for(var e=this._layers,i=0,r=e.length;i<r;i++){var s=e[i];if(s&&s.getLayerName()===t)return s}return null},r._changeLayer=function(t,e){for(var i=this._layers,r=0,s=i.length;r<s;r++){var n=i[r];if(n&&n.getLayerName()===t)return void(i[r]=e)}},r.getProperty=function(t){return this._properties[t.toString()]},r.getPropertiesForGID=function(t){return this._tileProperties.get(t)},r.__preload=function(){this._preloaded=!0,this._tmxFile&&this._applyFile()},r.onEnable=function(){this.node.on(b.ANCHOR_CHANGED,this._syncAnchorPoint,this)},r.onDisable=function(){this.node.off(b.ANCHOR_CHANGED,this._syncAnchorPoint,this)},r._applyFile=function(){var t=[],e={},i=this._tmxFile;if(i){for(var r=i.spriteFrameNames,s=i.spriteFrameSizes,n=i.spriteFrames,a={},h={},l=0;l<r.length;++l){var u=r[l];h[u]=s[l],t[l]=n[l];var g=t[l];g&&(e[g.name]=g,a[u]=g)}var f={},d=i.imageLayerSpriteFrame;r=i.imageLayerSpriteFrameNames;for(var _=0;_<d.length;++_)f[r[_]]=d[_];for(var p=i.tsxFileNames,c=i.tsxFiles,m={},y=0;y<p.length;++y)p[y].length>0&&(m[p[y]]=c[y].text);var v=new Tt(i.tmxXmlStr,m,a,h,f),A=v.getTilesets();A&&0!==A.length||o(7241),this._buildWithMapInfo(v)}else this._releaseMapInfo()},r._releaseMapInfo=function(){for(var t=this._layers,e=0,i=t.length;e<i;e++)t[e].node.removeFromParent(),t[e].node.destroy();t.length=0;for(var r=this._groups,s=0,n=r.length;s<n;s++)r[s].node.removeFromParent(),r[s].node.destroy();r.length=0;for(var o=this._images,a=0,h=o.length;a<h;a++)o[a].removeFromParent(),o[a].destroy();o.length=0},r._syncAnchorPoint=function(){var t,e,i=this.node._uiProps.uiTransformComp.anchorPoint,r=this.node._uiProps.uiTransformComp.width*i.x,s=this.node._uiProps.uiTransformComp.height*(1-i.y);for(t=0,e=this._layers.length;t<e;t++)this._layers[t].node._uiProps.uiTransformComp.setAnchorPoint(i);for(t=0,e=this._groups.length;t<e;t++){var n=this._groups[t],o=n.node._uiProps.uiTransformComp;o.anchorX=.5,o.anchorY=.5;var a=n.offset.x-r+o.width*o.anchorX,h=n.offset.y+s-o.height*o.anchorY;n.node.setPosition(a,h)}for(t=0,e=this._images.length;t<e;t++){var l=this._images[t]._uiProps.uiTransformComp;l.anchorX=.5,l.anchorY=.5;var u=this._images[t]._offset.x-r+l.width*l.anchorX,g=this._images[t]._offset.y+s-l.height*l.anchorY;this._images[t].setPosition(u,g)}},r._fillAniGrids=function(t,e){for(var i,r=P(e.keys());!(i=r()).done;){var s=i.value,n=e.get(s);if(n)for(var o=n.frames,a=0;a<o.length;a++){var h=o[a];h.grid=t.get(h.tileid)}}},r._buildLayerAndGroup=function(){var t=this._tilesets,e=this._texGrids,r=this._animations;e.clear();for(var s=0,n=t.length;s<n;++s){var o=t[s];o&&(o.sourceImage?It(o,e,o.sourceImage):console.warn("Can't find the spriteFrame of tilesets "+s))}this._fillAniGrids(e,r);for(var a=this._layers,h=this._groups,l=this._images,u={},g=0,f=a.length;g<f;g++)u[a[g].node.name]=!0;for(var d=0,_=h.length;d<_;d++)u[h[d].node.name]=!0;for(var p=0,c=l.length;p<c;p++)u[l[p].name]=!0;a=this._layers=[],h=this._groups=[],l=this._images=[];var m=this._mapInfo,y=this.node,v=m.getAllChildren(),A=this._textures,w=0,b=0;if(v&&v.length>0)for(var T=0,x=v.length;T<x;T++){var I=v[T],C=I.name,D=this.node.getChildByName(C);if(u[C]=!1,D||((D=new S).name=C,D.layer=y.layer,y.addChild(D)),D.setSiblingIndex(T),D.active=I.visible,I instanceof rt){var N=D.getComponent(ve);N||(N=D.addComponent(ve)),N.init(I,m,t,A,e),N.enableCulling=this._enableCulling,I.ownTiles=!1,a.push(N)}else if(I instanceof it){var O=D.getComponent(Ae);O||(O=D.addComponent(Ae)),O._init(I,m,e),h.push(O)}else if(I instanceof st){var P=I.sourceImage;D.layerInfo=I,D._offset=new i(I.offset.x,-I.offset.y);var E=D.getComponent(H);E||(E=D.addComponent(H)),E.color.a*=I.opacity,E.spriteFrame=P,D._uiProps.uiTransformComp.setContentSize(P.width,P.height),l.push(D)}w=Math.max(w,D._uiProps.uiTransformComp.width),b=Math.max(b,D._uiProps.uiTransformComp.height)}for(var G=y.children,z=0,L=G.length;z<L;z++){var F=G[z];u[F.name]&&F.destroy()}this.node._uiProps.uiTransformComp.setContentSize(w,b),this._syncAnchorPoint()},r._buildWithMapInfo=function(t){var e=this;this._mapInfo=t,this._mapSize=t.getMapSize(),this._tileSize=t.getTileSize(),this._mapOrientation=t.orientation,this._properties=t.properties,this._tileProperties=t.getTileProperties(),this._imageLayers=t.getImageLayers(),this._animations=t.getTileAnimations(),this._tilesets=t.getTilesets();var i=this._tilesets;this._textures.length=0;for(var r=[],s=0,n=i.length;s<n;++s){var o=i[s];o&&o.sourceImage&&(this._textures[s]=o.sourceImage,r.push(o.sourceImage))}for(var a=0;a<this._imageLayers.length;a++){var h=this._imageLayers[a];h&&h.sourceImage&&r.push(h.sourceImage)}Ct(r,(function(){e._buildLayerAndGroup(),e.cleanupImageCache&&e._textures.forEach((function(t){e.doCleanupImageCache(t)}))}))},r.doCleanupImageCache=function(t){t._image instanceof HTMLImageElement?t._image.src="":E.capabilities.imageBitmap&&t._image instanceof ImageBitmap&&t._image.close&&t._image.close(),t._image=null},r.update=function(t){for(var e,i=this._animations,r=this._texGrids,s=P(i.keys());!(e=s()).done;){var n=e.value,o=i.get(n),a=o.frames,h=a[o.frameIdx];o.dt+=t,h.duration<o.dt&&(o.dt=0,o.frameIdx++,o.frameIdx>=a.length&&(o.frameIdx=0),h=a[o.frameIdx]),r.set(n,h.grid)}for(var l,u=P(this.getLayers());!(l=u()).done;){var g=l.value;g.hasAnimation()&&g.markForUpdateRenderData()}},h(e,[{key:"tmxAsset",get:function(){return this._tmxFile},set:function(t){(this._tmxFile!==t||L)&&(this._tmxFile=t,(this._preloaded||L)&&this._applyFile())}},{key:"enableCulling",get:function(){return this._enableCulling},set:function(t){this._enableCulling=t;for(var e=this._layers,i=0;i<e.length;++i)e[i].enableCulling=t}}]),e}(v),ge.Orientation=K,ge.Property=W,ge.TileFlag=q,ge.StaggerAxis=J,ge.StaggerIndex=Q,ge.TMXObjectType=tt,ge.RenderOrder=$,he=_((ae=fe).prototype,"_tmxFile",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_(ae.prototype,"tmxAsset",[se,ne],Object.getOwnPropertyDescriptor(ae.prototype,"tmxAsset"),ae.prototype),le=_(ae.prototype,"_enableCulling",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),_(ae.prototype,"enableCulling",[G],Object.getOwnPropertyDescriptor(ae.prototype,"enableCulling"),ae.prototype),ue=_(ae.prototype,"cleanupImageCache",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),oe=ae))||oe)||oe)||oe)||oe)||oe)),Math.ceil(10922.5)),Se=[],Te=0;Te<4;Te++)Se.push(new w);var xe,Ie,Ce=new A,De=new w,Ne={row:0,col:0},Oe={x:0,y:0},Pe={x:0,y:0},Ee={x:0,y:0},Ge={x:0,y:0},ze=0,Le=0,Fe=0,Re=0,Me={createData:function(t){var e=t.requestMeshRenderData();return t.rightTop.col*t.rightTop.row*4>65535&&console.error("Vertex count exceeds 65535"),e},updateRenderData:function(t){t.updateCulling();var e=t.requestMeshRenderData();if(Fe=t.leftDownToCenterX,Re=t.leftDownToCenterY,xe=e,t.colorChanged||t.isCullingDirty()||t.isUserNodeDirty()||t.hasAnimation()||t.hasTiledNode()){var i,r;if(t.colorChanged=!1,t.destroyRenderData(),t.enableCulling){var s=t.cullingRect;i=s.leftDown,r=s.rightTop}else i=Ne,r=t.rightTop;switch(t.renderOrder){case $.RightDown:je(i,r,-1,1,t);break;case $.LeftDown:je(i,r,-1,-1,t);break;case $.RightUp:je(i,r,1,1,t);break;case $.LeftUp:default:je(i,r,1,-1,t)}t.setCullingDirty(!1),t.setUserNodeDirty(!1)}xe=null},updateColor:function(t){var e=t.color,i=new Float32Array(4);i[0]=e.r/255,i[1]=e.g/255,i[2]=e.b/255,i[0]=e.a/255;var r=t.meshRenderDataArray;if(r)for(var s,n=P(r);!(s=n()).done;){var o=s.value;if(o.renderData)for(var a=o.renderData,h=a.vData,l=a.vertexStart,u=a.vertexCount;l<u;l++)h.set(i,9*l+5)}},fillBuffers:function(t,e){if(t&&t.meshRenderDataArray){var i=t.meshRenderDataArray,r=t.node,s=e.acquireBufferBatch(),n=s.byteOffset>>2,o=s.indicesOffset,a=s.vertexOffset,h=i[t._meshRenderDataArrayIdx].renderData;s.request(h.vertexCount,h.indicesCount)||(s=e.currBufferBatch,n=0,o=0,a=0);var l=s.vData,u=s.iData,g=r.worldMatrix,f=h.vData,d=h.vertexStart;l.set(f.slice(d,d+9*h.vertexCount),n);for(var _=0;_<h.vertexCount;_++){var p=n+9*_;De.set(l[p],l[p+1],l[p+2]),De.transformMat4(g),l[p]=De.x,l[p+1]=De.y,l[p+2]=De.z}for(var c=h.vertexCount/4,m=0;m<c;m+=1)u[o]=a,u[o+1]=a+1,u[o+2]=a+2,u[o+3]=a+2,u[o+4]=a+1,u[o+5]=a+3,o+=6,a+=4}}};function Xe(t,e){var i;t._rotated?(Oe.x=t.r,Oe.y=t.t,Pe.x=t.l,Pe.y=t.t,Ee.x=t.r,Ee.y=t.b,Ge.x=t.l,Ge.y=t.b):(Oe.x=t.l,Oe.y=t.t,Pe.x=t.l,Pe.y=t.b,Ee.x=t.r,Ee.y=t.t,Ge.x=t.r,Ge.y=t.b),(e&q.DIAGONAL)>>>0&&(i=Pe,Pe=Ee,Ee=i),(e&q.HORIZONTAL)>>>0&&(i=Oe,Oe=Ee,Ee=i,i=Pe,Pe=Ge,Ge=i),(e&q.VERTICAL)>>>0&&(i=Oe,Oe=Pe,Pe=i,i=Ee,Ee=Ge,Ge=i)}function Ue(t,e,i){t||(t=e.texture),xe.texture||(xe.texture=t),(xe=i.requestMeshRenderData()).texture=e.texture}function je(t,e,i,r,s){if(!(!xe||e.row<0||e.col<0)){xe.renderData||(xe=s.requestMeshRenderData());var n=xe.renderData.vData;ze=0,Le=0;var o,a,h,l,u,g,f,d,_,p=s.tiledTiles,c=s.texGrids,m=s.tiles,y=s.vertices,v=0,A=0,w=0,b=0,S=0,T=null,x=0,I=!0;Ie=Xe;var C=new Float32Array(4);for(C[0]=s.color.r/255,C[1]=s.color.g/255,C[2]=s.color.b/255,C[3]=s.color.a/255,-1===i?(l=e.row,u=t.row):(l=t.row,u=e.row);(u-l)*i>=0;l+=i)for(o=y[l],x=s.getNodesCountByRow(l),I=o&&0===x,1===r?(a=I&&t.col<o.minCol?o.minCol:t.col,h=I&&e.col>o.maxCol?o.maxCol:e.col):(a=I&&e.col>o.maxCol?o.maxCol:e.col,h=I&&t.col<o.minCol?o.minCol:t.col);(h-a)*r>=0;a+=r){if(g=o&&o[a],x>0){var D=s.requestSubNodesData(),N=s.getNodesByRowCol(l,a);N&&N.count>0&&(D.subNodes=s.getNodesByRowCol(l,a).list,T=null,xe=s.requestMeshRenderData())}g&&(v=m[g.index],(d=c.get((v&q.FLIPPED_MASK)>>>0))&&(T!==d.texture&&(Ue(T,d,s),T=d.texture),f=d.tileset._tileSize,A=g.left-Fe,w=g.bottom-Re,b=A+f.width,S=w+f.height,_=p[g.index],xe.renderData.reserve(4,0),Le=9*xe.renderData.vertexCount,n=xe.renderData.vData,_?_.node.active&&He(_.node,C,n,A,b,S,w,!1):(n[Le]=A,n[Le+1]=S,n[Le+9]=A,n[Le+9+1]=w,n[Le+18]=b,n[Le+18+1]=S,n[Le+27]=b,n[Le+27+1]=w,n.set(C,Le+5),n.set(C,Le+9+5),n.set(C,Le+18+5),n.set(C,Le+27+5)),Ie(d,v),n[Le+3]=Oe.x,n[Le+4]=Oe.y,n[Le+9+3]=Pe.x,n[Le+9+4]=Pe.y,n[Le+18+3]=Ee.x,n[Le+18+4]=Ee.y,n[Le+27+3]=Ge.x,n[Le+27+4]=Ge.y,ze++,xe.renderData.advance(4,6),ze>=be&&(Ue(T,d,s),T=d.texture)))}}}function He(t,e,i,r,s,n,o,a){var h=18,l=27;t.updateWorldTransform(),A.copy(Ce,t.matrix),w.set(De,-(r+Fe),-(o+Re),0),A.transform(Ce,Ce,De);var u=Ce,g=u.m12,f=u.m13,d=u.m00,_=u.m01,p=u.m04,c=u.m05,m=1===d&&0===_&&0===p&&1===c;if(a){var y=(r+s)/2,v=(n+o)/2;m?(i[Le]=y+g,i[Le+1]=n+f,i[Le+9]=r+g,i[Le+9+1]=v+f,i[Le+h]=s+g,i[Le+h+1]=v+f,i[Le+l]=y+g,i[Le+l+1]=o+f):(i[Le]=y*d+n*p+g,i[Le+1]=y*_+n*c+f,i[Le+9]=r*d+v*p+g,i[Le+9+1]=r*_+v*c+f,i[Le+h]=s*d+v*p+g,i[Le+h+1]=s*_+v*c+f,i[Le+l]=y*d+o*p+g,i[Le+l+1]=y*_+o*c+f)}else m?(i[Le]=r+g,i[Le+1]=n+f,i[Le+9]=r+g,i[Le+9+1]=o+f,i[Le+h]=s+g,i[Le+h+1]=n+f,i[Le+l]=s+g,i[Le+l+1]=o+f):(i[Le]=r*d+n*p+g,i[Le+1]=r*_+n*c+f,i[Le+9]=r*d+o*p+g,i[Le+9+1]=r*_+o*c+f,i[Le+h]=s*d+n*p+g,i[Le+h+1]=s*_+n*c+f,i[Le+l]=s*d+o*p+g,i[Le+l+1]=s*_+o*c+f);i.set(e,Le+5),i.set(e,Le+9+5),i.set(e,Le+h+5),i.set(e,Le+l+5)}var Be=t("tiledLayerAssembler",{getAssembler:function(){return Me}});ve.Assembler=Be}}}));
