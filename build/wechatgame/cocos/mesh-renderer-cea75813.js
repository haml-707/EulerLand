System.register(["./fog-c82f3158.js","./screen-b918b2af.js","./renderable-component-542a40ea.js","./texture-buffer-pool-b355307f.js","./mesh-dd72f482.js"],(function(e){"use strict";var t,i,n,o,s,a,r,h,l,d,c,u,p,_,m,g,f,b,M,w,S,y,v,I,O,P;return{setters:[function(e){t=e.eN,i=e.dw,n=e.eQ,o=e.gS,s=e.eM,a=e.fz,r=e.fC,h=e.eY,l=e.eS,d=e.l,c=e.g0,u=e.em,p=e.fM,_=e.gT,m=e.fA,g=e.fB,f=e.cY,b=e.eX,M=e.eT,w=e.fD,S=e.fS,y=e.f3},function(){},function(e){v=e.a,I=e.e,O=e.d},function(){},function(e){P=e.M}],execute:function(){var R,z,C,k,F,D,j,T,B,L,x,N,A,U,W,E,V,H,Y,q,Q,X,G,J,K,Z,$,ee,te,ie,ne,oe=e("a",function(e){function i(){for(var t,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this)._morphRenderingInstance=null,t._usedMaterials=new Set,t}t(i,e);var n=i.prototype;return n.getMacroPatches=function(e){return this._morphRenderingInstance?this._morphRenderingInstance.requiredPatches(e):null},n.initSubModel=function(t,i,n){return e.prototype.initSubModel.call(this,t,i,this._launderMaterial(n))},n.setSubModelMaterial=function(t,i){return e.prototype.setSubModelMaterial.call(this,t,this._launderMaterial(i))},n._updateLocalDescriptors=function(t,i){e.prototype._updateLocalDescriptors.call(this,t,i),this._morphRenderingInstance&&this._morphRenderingInstance.adaptPipelineState(t,i)},n._launderMaterial=function(e){return e},n.setMorphRendering=function(e){this._morphRenderingInstance=e},i}(v)),se=i({OFF:0,ON:1}),ae=i({OFF:0,ON:1}),re=(R=n("cc.ModelLightmapSettings"),z=o("_recieveShadow"),R((x=function(){function e(){m(this,"texture",F,this),m(this,"uvParam",D,this),m(this,"_bakeable",j,this),m(this,"_castShadow",T,this),m(this,"_receiveShadow",B,this),m(this,"_lightmapSize",L,this)}return s(e,[{key:"bakeable",get:function(){return this._bakeable},set:function(e){this._bakeable=e}},{key:"castShadow",get:function(){return this._castShadow},set:function(e){this._castShadow=e}},{key:"receiveShadow",get:function(){return this._receiveShadow},set:function(e){this._receiveShadow=e}},{key:"lightmapSize",get:function(){return this._lightmapSize},set:function(e){this._lightmapSize=e}}]),e}(),F=a((k=x).prototype,"texture",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=a(k.prototype,"uvParam",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new f}}),j=a(k.prototype,"_bakeable",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),T=a(k.prototype,"_castShadow",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),B=a(k.prototype,"_receiveShadow",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),L=a(k.prototype,"_lightmapSize",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),a(k.prototype,"bakeable",[r],Object.getOwnPropertyDescriptor(k.prototype,"bakeable"),k.prototype),a(k.prototype,"castShadow",[r],Object.getOwnPropertyDescriptor(k.prototype,"castShadow"),k.prototype),a(k.prototype,"receiveShadow",[r],Object.getOwnPropertyDescriptor(k.prototype,"receiveShadow"),k.prototype),a(k.prototype,"lightmapSize",[r],Object.getOwnPropertyDescriptor(k.prototype,"lightmapSize"),k.prototype),C=k))||C);e("M",(N=n("cc.MeshRenderer"),A=b(),U=I(100),W=M(),E=h(se),V=w(),H=h(ae),Y=w(),q=h(P),Q=w(),X=S(),N(G=A(G=U(G=W(G=l((ne=ie=function(e){function i(){var t;return t=e.call(this)||this,m(t,"lightmapSettings",K,y(t)),m(t,"_mesh",Z,y(t)),m(t,"_shadowCastingMode",$,y(t)),m(t,"_shadowReceivingMode",ee,y(t)),t._modelType=void 0,t._model=null,t._morphInstance=null,m(t,"_enableMorph",te,y(t)),t._modelType=v,t}t(i,e);var n=i.prototype;return n.onLoad=function(){this._mesh&&this._mesh.initialize(),this._watchMorphInMesh(),this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow()},n.onRestore=function(){this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow()},n.onEnable=function(){this._model||this._updateModels(),this._attachToScene()},n.onDisable=function(){this._model&&this._detachFromScene()},n.onDestroy=function(){this._model&&(d.director.root.destroyModel(this._model),this._model=null,this._models.length=0),this._morphInstance&&this._morphInstance.destroy()},n.setWeights=function(e,t){this._morphInstance&&this._morphInstance.setWeights(t,e)},n.setInstancedAttribute=function(e,t){if(this.model)for(var i=this.model.instancedAttributes,n=i.attributes,o=i.views,s=0;s<n.length;s++)if(n[s].name===e){o[s].set(t);break}},n._updateLightmap=function(e,t,i,n,o){this.lightmapSettings.texture=e,this.lightmapSettings.uvParam.x=t,this.lightmapSettings.uvParam.y=i,this.lightmapSettings.uvParam.z=n,this.lightmapSettings.uvParam.w=o,this._onUpdateLightingmap()},n._updateModels=function(){if(this.enabledInHierarchy&&this._mesh){var e=this._model;e?(e.destroy(),e.initialize(),e.node=e.transform=this.node):this._createModel(),this._model&&(this._model.createBoundingShape(this._mesh.struct.minPosition,this._mesh.struct.maxPosition),this._updateModelParams(),this._onUpdateLightingmap())}},n._createModel=function(){var e=this._morphInstance&&this._modelType===v?oe:this._modelType,t=this._model=d.director.root.createModel(e);t.visFlags=this.visibility,t.node=t.transform=this.node,this._models.length=0,this._models.push(this._model),this._morphInstance&&t instanceof oe&&t.setMorphRendering(this._morphInstance)},n._attachToScene=function(){if(this.node.scene&&this._model){var e=this._getRenderScene();null!==this._model.scene&&this._detachFromScene(),e.addModel(this._model)}},n._detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},n._updateModelParams=function(){if(this._mesh&&this._model){this.node.hasChangedFlags|=c.POSITION,this._model.transform.hasChangedFlags|=c.POSITION,this._model.isDynamicBatching=this._isBatchingEnabled();var e=this._mesh?this._mesh.renderingSubMeshes.length:0,t=this._mesh.renderingSubMeshes;if(t)for(var i=0;i<e;++i){var n=this.getRenderMaterial(i);n&&!n.isValid&&(n=null);var o=t[i];o&&this._model.initSubModel(i,o,n||this._getBuiltinMaterial())}this._model.enabled=!0}},n._onUpdateLightingmap=function(){null!==this.model&&this.model.updateLightingmap(this.lightmapSettings.texture,this.lightmapSettings.uvParam),this.setInstancedAttribute("a_lightingMapUVParam",[this.lightmapSettings.uvParam.x,this.lightmapSettings.uvParam.y,this.lightmapSettings.uvParam.z,this.lightmapSettings.uvParam.w])},n._onMaterialModified=function(e,t){this._model&&this._model.inited&&this._onRebuildPSO(e,t||this._getBuiltinMaterial())},n._onRebuildPSO=function(e,t){this._model&&this._model.inited&&(this._model.isDynamicBatching=this._isBatchingEnabled(),this._model.setSubModelMaterial(e,t),this._onUpdateLightingmap())},n._onMeshChanged=function(){},n._clearMaterials=function(){if(this._model)for(var e=this._model.subModels,t=0;t<e.length;++t)this._onMaterialModified(t,null)},n._getBuiltinMaterial=function(){return u.get("missing-material")},n._onVisibilityChange=function(e){this._model&&(this._model.visFlags=e)},n._updateCastShadow=function(){this._model&&(this._shadowCastingMode===se.OFF?this._model.castShadow=!1:(p(this._shadowCastingMode===se.ON,"ShadowCastingMode "+this._shadowCastingMode+" is not supported."),this._model.castShadow=!0))},n._updateReceiveShadow=function(){this._model&&(this._shadowReceivingMode===ae.OFF?this._model.receiveShadow=!1:this._model.receiveShadow=!0)},n._isBatchingEnabled=function(){for(var e=0;e<this._materials.length;++e){var t=this._materials[e];if(t)for(var i=0;i<t.passes.length;++i)if(t.passes[i].batchingScheme)return!0}return!1},n._watchMorphInMesh=function(){if(this._morphInstance&&(this._morphInstance.destroy(),this._morphInstance=null),this._enableMorph&&this._mesh&&this._mesh.struct.morph&&this._mesh.morphRendering){var e=this._mesh.struct.morph;this._morphInstance=this._mesh.morphRendering.createInstance();for(var t=this._mesh.struct.primitives.length,i=0;i<t;++i){var n=e.subMeshMorphs[i];if(n){var o=n.weights||e.weights,s=o?o.slice():new Array(n.targets.length).fill(0);this._morphInstance.setWeights(i,s)}}this._model&&this._model instanceof oe&&this._model.setMorphRendering(this._morphInstance)}},n._syncMorphWeights=function(e){if(this._morphInstance){var t=this._morphInstance[e];t&&t.renderResources&&t.renderResources.setWeights(t.weights)}},s(i,[{key:"shadowCastingMode",get:function(){return this._shadowCastingMode},set:function(e){this._shadowCastingMode=e,this._updateCastShadow()}},{key:"receiveShadow",get:function(){return this._shadowReceivingMode},set:function(e){this._shadowReceivingMode=e,this._updateReceiveShadow()}},{key:"mesh",get:function(){return this._mesh},set:function(e){var t=this._mesh;this._mesh=e,this._mesh&&this._mesh.initialize(),this._watchMorphInMesh(),this._onMeshChanged(t),this._updateModels(),this.enabledInHierarchy&&this._attachToScene(),this._updateCastShadow(),this._updateReceiveShadow()}},{key:"model",get:function(){return this._model}},{key:"enableMorph",get:function(){return this._enableMorph},set:function(e){this._enableMorph=e}}]),i}(O),ie.ShadowCastingMode=se,ie.ShadowReceivingMode=ae,K=a((J=ne).prototype,"lightmapSettings",[g,r,_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new re}}),Z=a(J.prototype,"_mesh",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=a(J.prototype,"_shadowCastingMode",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return se.OFF}}),ee=a(J.prototype,"_shadowReceivingMode",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ae.ON}}),a(J.prototype,"shadowCastingMode",[E,V,_],Object.getOwnPropertyDescriptor(J.prototype,"shadowCastingMode"),J.prototype),a(J.prototype,"receiveShadow",[H,Y,_],Object.getOwnPropertyDescriptor(J.prototype,"receiveShadow"),J.prototype),a(J.prototype,"mesh",[q,Q],Object.getOwnPropertyDescriptor(J.prototype,"mesh"),J.prototype),a(J.prototype,"enableMorph",[X,_],Object.getOwnPropertyDescriptor(J.prototype,"enableMorph"),J.prototype),te=a(J.prototype,"_enableMorph",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),G=J))||G)||G)||G)||G)||G))}}}));
