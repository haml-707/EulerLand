System.register(["./fog-c82f3158.js","./screen-b918b2af.js","./renderable-component-542a40ea.js","./transform-utils-a9e236ca.js","./json-asset-1decacc3.js","./camera-component-b0aa23d4.js"],(function(e,t){"use strict";var i,n,r,s,a,o,u,l,c,h,d,f,p,_,g,m,v,y,w,T,b,A,E,S,N,I,R,C,x,P,k,D,F,M,B,L,O,U,H,W,V,j,z,q,G,Y,X,$,J,Q,K,Z,ee,te,ie,ne,re,se,ae,oe,ue,le,ce,he,de,fe,pe,_e,ge,me,ve,ye,we,Te,be,Ae,Ee,Se,Ne,Ie,Re,Ce,xe,Pe,ke,De,Fe,Me,Be,Le,Oe,Ue,He,We,Ve,je,ze,qe,Ge,Ye,Xe,$e,Je,Qe,Ke,Ze,et,tt,it,nt,rt,st,at,ot,ut,lt,ct,ht,dt,ft,pt,_t,gt,mt,vt,yt,wt,Tt,bt,At,Et,St,Nt,It,Rt,Ct,xt,Pt,kt,Dt,Ft,Mt,Bt,Lt,Ot,Ut,Ht,Wt,Vt,jt,zt,qt,Gt,Yt,Xt,$t,Jt,Qt,Kt,Zt,ei,ti,ii,ni,ri,si,ai,oi,ui,li,ci,hi,di,fi,pi,_i,gi,mi,vi,yi,wi,Ti,bi,Ai,Ei,Si,Ni,Ii,Ri,Ci,xi,Pi,ki,Di,Fi,Mi,Bi,Li,Oi,Ui,Hi,Wi,Vi,ji,zi,qi,Gi,Yi,Xi,$i,Ji,Qi,Ki,Zi,en,tn,nn;return{setters:[function(e){i=e.cT,n=e.cU,r=e.cV,s=e.cW,a=e.cX,o=e.cY,u=e.cZ,l=e.c_,c=e.c$,h=e.d0,d=e.d1,f=e.d2,p=e.d3,_=e.d4,g=e.d5,m=e.d6,v=e.d7,y=e.d8,w=e.d9,T=e.da,b=e.db,A=e.dc,E=e.dd,S=e.de,N=e.df,I=e.dg,R=e.dh,C=e.di,x=e.dj,P=e.dk,k=e.dl,D=e.dm,F=e.dn,M=e.dp,B=e.dq,L=e.dr,O=e.ds,U=e.dt,H=e.du,W=e.en,V=e.eo,j=e.ep,z=e.eq,q=e.er,G=e.es,Y=e.et,X=e.eu,$=e.ev,J=e.ew,Q=e.ex,K=e.ey,Z=e.ez,ee=e.eA,te=e.eB,ie=e.eC,ne=e.eD,re=e.eE,se=e.eF,ae=e.eG,oe=e.eH,ue=e.eI,le=e.eJ,ce=e.eK,he=e.e,de=e.an,fe=e.l,pe=e.af,_e=e.ap,ge=e.z,me=e.G,ve=e.aG,ye=e.x,we=e.aI,Te=e.e1,be=e.aw,Ae=e.N,Ee=e.au,Se=e.H,Ne=e.I,Ie=e.bU,Re=e.bV,Ce=e.c7,xe=e.c6,Pe=e.eL,ke=e.eM,De=e.v,Fe=e.al,Me=e.eN,Be=e.g,Le=e.f,Oe=e.d,Ue=e.c,He=e.eO,We=e.eP,Ve=e.cp,je=e.co,ze=e.bY,qe=e.aP,Ge=e.bT,Ye=e.t,Xe=e.cn,$e=e.aJ,Je=e.aK,Qe=e.$,Ke=e.aM,Ze=e.em,et=e.cm,tt=e.P,it=e.dE,nt=e.dF,rt=e.eQ,st=e.eR,at=e.eS,ot=e.eT,ut=e.eU,lt=e.eV,ct=e.eW,ht=e.eX,dt=e.eY,ft=e.eZ,pt=e.e_,_t=e.e$,gt=e.f0,mt=e.dM,vt=e.e8,yt=e.f1,wt=e.dy,Tt=e.ec,bt=e.f2,At=e.eh,Et=e.f3,St=e.dV,Nt=e.f4,It=e.f5,Rt=e.f6,Ct=e.f7,xt=e.f8,Pt=e.dX,kt=e.f9,Dt=e.dN,Ft=e.fa,Mt=e.fb,Bt=e.fc,Lt=e.fd,Ot=e.fe,Ut=e.ff,Ht=e.fg,Wt=e.ea,Vt=e.k,jt=e.dZ,zt=e.fh,qt=e.fi,Gt=e.d_,Yt=e.fj,Xt=e.fk,$t=e.fl,Jt=e.fm,Qt=e.fn,Kt=e.fo,Zt=e.fp,ei=e.fq,ti=e.fr,ii=e.fs,ni=e.ft,ri=e.fu,si=e.i,ai=e.fv,oi=e.fw,ui=e.fx,li=e.o,ci=e.eb,hi=e.fy,di=e.n,fi=e.fz,pi=e.fA,_i=e.fB,gi=e.fC,mi=e.fD,vi=e.bJ,yi=e.bw,wi=e.T,Ti=e.bG,bi=e.w,Ai=e.fE,Ei=e.bP,Si=e.fF,Ni=e.fG},function(e){Ii=e.F,Ri=e.J,Ci=e.D,xi=e.L,Pi=e.e,ki=e.k,Di=e.G,Fi=e.o},function(e){Mi=e.R,Bi=e.c,Li=e.r,Oi=e.e,Ui=e.f},function(e){Hi=e.n,Wi=e.d,Vi=e.o,ji=e.p,zi=e.B,qi=e.q,Gi=e.c,Yi=e.H,Xi=e.C},function(e){$i=e.S,Ji=e.a,Qi=e.C,Ki=e.N,Zi=e.J,en=e.T,tn=e.B},function(e){nn=e.C}],execute:function(){e({h:an,i:An,t:Ls,v:Os,w:Us});var rn=Object.freeze({__proto__:null,bits:i,Vec2:n,v2:r,Vec3:s,v3:a,Vec4:o,v4:u,Quat:l,quat:c,Mat3:h,Mat4:d,mat4:f,AffineTransform:p,Size:_,size:g,Rect:m,rect:v,Color:y,color:w,EPSILON:T,equals:b,approx:A,clamp:E,clamp01:S,lerp:N,toRadian:I,toDegree:R,random:C,randomRange:x,randomRangeInt:P,pseudoRandom:k,pseudoRandomRange:D,pseudoRandomRangeInt:F,nextPow2:M,repeat:B,pingPong:L,inverseLerp:O,absMaxComponent:U,absMax:H});e("m",rn);var sn=Object.freeze({__proto__:null,distance:W,enums:V,intersect:j,Line:z,Plane:q,Ray:G,Triangle:Y,Sphere:X,AABB:$,OBB:J,Capsule:Q,Frustum:K,Keyframe:Z,AnimationCurve:ee,get ERaycastMode(){return te},line:ie,plane:ne,ray:re,triangle:se,sphere:ae,aabb:oe,obb:ue,capsule:le,frustum:ce});function an(){var e=new Ii;return e.initialize({flows:[]}),e}e("g",sn);var on=new n,un=function(){var e=t.prototype;function t(){this.handle=0,this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this._splashFinish=!1,this._loadFinish=!1,this._directCall=!1}return e.main=function(e){if(null!=e){if(window._CCSettings&&window._CCSettings.splashScreen){var t=this.settings=window._CCSettings.splashScreen;t.totalTime=null!=this.settings.totalTime?this.settings.totalTime:3e3,t.base64src=this.settings.base64src||"",t.effect=this.settings.effect||"FADE-INOUT",t.clearColor=this.settings.clearColor||new de(.88,.88,.88,1),t.displayRatio=null!=this.settings.displayRatio?this.settings.displayRatio:.4,t.displayWatermark=null==this.settings.displayWatermark||this.settings.displayWatermark}else this.settings={totalTime:3e3,base64src:"",effect:"FADE-INOUT",clearColor:new de(.88,.88,.88,1),displayRatio:.4,displayWatermark:!0};if(""===this.settings.base64src||this.settings.totalTime<=0)this.callBack&&this.callBack(),this.callBack=null,this.settings=null,this._directCall=!0;else{fe.view.enableRetina(!0),fe.view.resizeWithBrowserSize(!0);var i=window._CCSettings.designResolution;i?fe.view.setDesignResolutionSize(i.width,i.height,i.policy):fe.view.setDesignResolutionSize(960,640,4),this.root=e,this.device=e.device,fe.game.once(fe.Game.EVENT_GAME_INITED,(function(){fe.director._lateUpdate=performance.now()}),fe.director),this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this.preInit(),this.logoImage=new Image,this.logoImage.onload=this.init.bind(this),this.logoImage.src=this.settings.base64src}}else he("RENDER ROOT IS NULL.")},e.setOnFinish=function(e){if(this._directCall&&e)return t._ins=void 0,void e();this.callBack=e},e._tryToStart=function(){this._splashFinish&&this._loadFinish&&this.callBack&&(this.callBack(),this.hide(),fe.game.resume())},e.preInit=function(){var e=this.settings.clearColor;this.clearColors=[new de(e.x,e.y,e.z,e.w)];var t=this.device;this.renderArea=new pe(0,0,t.width,t.height),this.framebuffer=this.root.mainWindow.framebuffer,this.cmdBuff=t.commandBuffer;var i=new Float32Array([.5,.5,1,0,-.5,.5,0,0,.5,-.5,1,1,-.5,-.5,0,1]),n=4*Float32Array.BYTES_PER_ELEMENT,r=4*n;this.vertexBuffers=t.createBuffer(new _e(ge.VERTEX|ge.TRANSFER_DST,me.HOST|me.DEVICE,r,n)),this.vertexBuffers.update(i);var s=new Uint16Array([0,1,2,1,3,2]),a=Uint16Array.BYTES_PER_ELEMENT,o=6*a;this.indicesBuffers=t.createBuffer(new _e(ge.INDEX|ge.TRANSFER_DST,me.HOST|me.DEVICE,o,a)),this.indicesBuffers.update(s);var u=[new ve("a_position",ye.RG32F),new ve("a_texCoord",ye.RG32F)],l=new we(u,[this.vertexBuffers],this.indicesBuffers);this.quadAssmebler=t.createInputAssembler(l),this.projection=new d,d.ortho(this.projection,-1,1,-1,1,-1,1,t.capabilities.clipSpaceMinZ,t.capabilities.clipSpaceSignY,t.surfaceTransform)},e.init=function(){var e=this;this.initLogo(),this.settings.displayWatermark&&this.initWarterMark(),fe.game.pause(),this.handle=requestAnimationFrame((function t(i){if(!e.cancelAnimate){var n=e.settings,r=e.device;d.ortho(e.projection,-1,1,-1,1,-1,1,r.capabilities.clipSpaceMinZ,r.capabilities.clipSpaceSignY,r.surfaceTransform);var s=r.width,a=r.height,o=s<a?s:a;e.startTime<0&&(e.startTime=i);var u=i-e.startTime,l=S(u/n.totalTime),c=Hi(l);"NONE"===n.effect&&(c=1);var h=e.logoTexture.width,f=e.logoTexture.height,p=o*n.displayRatio,_=p*h/f,g=p;if(r.surfaceTransform!==De.ROTATE_90&&r.surfaceTransform!==De.ROTATE_270||(_=p*s/a,g=p*f/h*a/s),e.logoMat.setProperty("resolution",on.set(s,a),0),e.logoMat.setProperty("scale",on.set(_,g),0),e.logoMat.setProperty("translate",on.set(.5*s,.5*a),0),e.logoMat.setProperty("precent",c),e.logoMat.setProperty("u_projection",e.projection),e.logoMat.passes[0].update(),n.displayWatermark&&e.watermarkMat){var m=.5*o,v=e.watermarkTexture.width,y=m,w=m*e.watermarkTexture.height/v;r.surfaceTransform!==De.ROTATE_90&&r.surfaceTransform!==De.ROTATE_270||(y=.5*m,w=m*s/a*.5),e.watermarkMat.setProperty("resolution",on.set(s,a),0),e.watermarkMat.setProperty("scale",on.set(y,w),0),e.watermarkMat.setProperty("translate",on.set(.5*s,.1*a),0),e.watermarkMat.setProperty("precent",c),e.watermarkMat.setProperty("u_projection",e.projection),e.watermarkMat.passes[0].update()}e.frame(),u>n.totalTime&&(e.splashFinish=!0),requestAnimationFrame(t)}}))},e.hide=function(){cancelAnimationFrame(this.handle),this.cancelAnimate=!0,setTimeout(this.destroy.bind(this))},e.initLogo=function(){var e=this.device;this.logoMat=new Te,this.logoMat.initialize({effectName:"splash-screen"});var t=new be;t.addressU=Ae.CLAMP,t.addressV=Ae.CLAMP,t.addressW=Ae.CLAMP,this.sampler=e.createSampler(t),this.logoTexture=e.createTexture(new Ee(Se.TEX2D,Ne.SAMPLED|Ne.TRANSFER_DST,ye.RGBA8,this.logoImage.width,this.logoImage.height));var i=this.logoMat.passes[0],n=i.getBinding("mainTexture");i.bindTexture(n,this.logoTexture),this.shader=Ie.get(i.getShaderVariant());var r=Re.get(Ce.get(i.handle,xe.DESCRIPTOR_SET));r.bindSampler(n,this.sampler),r.update();var s=new Fe;s.texExtent.width=this.logoImage.width,s.texExtent.height=this.logoImage.height,s.texExtent.depth=1,e.copyTexImagesToTexture([this.logoImage],this.logoTexture,[s])},e.initWarterMark=function(){var e=document.createElement("canvas");e.width=330,e.height=30,e.style.width=""+e.width,e.style.height=""+e.height;var t=e.getContext("2d");t.font="18px Arial",t.textBaseline="top",t.textAlign="left",t.fillStyle="`#424242`";var i="Powered by Cocos Creator",n=t.measureText(i);t.fillText(i,(330-n.width)/2,6);var r=new Fe;r.texExtent.width=e.width,r.texExtent.height=e.height,r.texExtent.depth=1,this.watermarkTexture=this.device.createTexture(new Ee(Se.TEX2D,Ne.SAMPLED|Ne.TRANSFER_DST,ye.RGBA8,e.width,e.height)),this.device.copyTexImagesToTexture([e],this.watermarkTexture,[r]),this.watermarkMat=new Te,this.watermarkMat.initialize({effectName:"splash-screen"});var s=this.watermarkMat.passes[0],a=s.getBinding("mainTexture");s.bindTexture(a,this.watermarkTexture),Re.get(Ce.get(s.handle,xe.DESCRIPTOR_SET)).update()},e.frame=function(){var e=this.device;e.acquire();var t=this.cmdBuff,i=this.framebuffer,n=this.renderArea;n.width=e.width,n.height=e.height,t.begin(),t.beginRenderPass(i.renderPass,i,n,this.clearColors,1,0);var r=this.logoMat.passes[0],s=Ri.getOrCreatePipelineState(e,r,this.shader,i.renderPass,this.quadAssmebler);if(t.bindPipelineState(s),t.bindDescriptorSet(Pe.MATERIAL,r.descriptorSet),t.bindInputAssembler(this.quadAssmebler),t.draw(this.quadAssmebler),this.settings.displayWatermark&&this.watermarkMat){var a=this.watermarkMat.passes[0],o=Ri.getOrCreatePipelineState(e,a,this.shader,i.renderPass,this.quadAssmebler);t.bindPipelineState(o),t.bindDescriptorSet(Pe.MATERIAL,a.descriptorSet),t.bindInputAssembler(this.quadAssmebler),t.draw(this.quadAssmebler)}t.endRenderPass(),t.end(),e.flushCommands([t]),e.queue.submit([t]),e.present()},e.destroy=function(){this.callBack=null,this.root=null,this.device=null,this.clearColors=null,this.logoImage.destroy&&this.logoImage.destroy(),this.logoImage=null,this.framebuffer=null,this.renderArea=null,this.cmdBuff=null,this.shader=null,this.logoMat.destroy(),this.logoMat=null,this.logoTexture.destroy(),this.logoTexture=null,this.quadAssmebler.destroy(),this.quadAssmebler=null,this.vertexBuffers.destroy(),this.vertexBuffers=null,this.indicesBuffers.destroy(),this.indicesBuffers=null,this.sampler.destroy(),this.sampler=null,this.watermarkTexture&&(this.watermarkMat.destroy(),this.watermarkMat=null,this.watermarkTexture.destroy(),this.watermarkTexture=null),this.settings=null,t._ins=void 0},ke(t,[{key:"splashFinish",set:function(e){this._splashFinish=e,this._tryToStart()}},{key:"loadFinish",set:function(e){this._loadFinish=e,this._tryToStart()}}],[{key:"instance",get:function(){return t._ins||(t._ins=new t),t._ins}}]),t}();un._ins=void 0,fe.internal.SplashScreen=un;var ln=e("o",function(){function e(){this._id="",this._priority=0,this._executeInEditMode=!1}e.sortByPriority=function(e,t){return e._priority<t._priority?1:e._priority>t.priority?-1:0};var t=e.prototype;return t.init=function(){},t.update=function(){},t.postUpdate=function(){},ke(e,[{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e}},{key:"id",get:function(){return this._id},set:function(e){this._id=e}}]),e}()),cn=new We("Scheduler"),hn=function(e,t,i,n){this.target=void 0,this.priority=void 0,this.paused=void 0,this.markedForDeletion=void 0,this.target=e,this.priority=t,this.paused=i,this.markedForDeletion=n};hn.get=function(e,t,i,n){var r=hn._listEntries.pop();return r?(r.target=e,r.priority=t,r.paused=i,r.markedForDeletion=n):r=new hn(e,t,i,n),r},hn.put=function(e){hn._listEntries.length<20&&(e.target=null,hn._listEntries.push(e))},hn._listEntries=[];var dn=function(e,t,i,n){this.list=void 0,this.entry=void 0,this.target=void 0,this.callback=void 0,this.list=e,this.entry=t,this.target=i,this.callback=n};dn.get=function(e,t,i,n){var r=dn._hashUpdateEntries.pop();return r?(r.list=e,r.entry=t,r.target=i,r.callback=n):r=new dn(e,t,i,n),r},dn.put=function(e){dn._hashUpdateEntries.length<20&&(e.list=e.entry=e.target=e.callback=null,dn._hashUpdateEntries.push(e))},dn._hashUpdateEntries=[];var fn=function(e,t,i,n,r,s){this.timers=void 0,this.target=void 0,this.timerIndex=void 0,this.currentTimer=void 0,this.currentTimerSalvaged=void 0,this.paused=void 0,this.timers=e,this.target=t,this.timerIndex=i,this.currentTimer=n,this.currentTimerSalvaged=r,this.paused=s};fn.get=function(e,t,i,n,r,s){var a=fn._hashTimerEntries.pop();return a?(a.timers=e,a.target=t,a.timerIndex=i,a.currentTimer=n,a.currentTimerSalvaged=r,a.paused=s):a=new fn(e,t,i,n,r,s),a},fn.put=function(e){fn._hashTimerEntries.length<20&&(e.timers=e.target=e.currentTimer=null,fn._hashTimerEntries.push(e))},fn._hashTimerEntries=[];var pn=function(){function e(){this._lock=void 0,this._scheduler=void 0,this._elapsed=void 0,this._runForever=void 0,this._useDelay=void 0,this._timesExecuted=void 0,this._repeat=void 0,this._delay=void 0,this._interval=void 0,this._target=void 0,this._callback=void 0,this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}var t=e.prototype;return t.initWithCallback=function(e,t,i,n,r,s){return this._lock=!1,this._scheduler=e,this._target=i,this._callback=t,this._elapsed=-1,this._interval=n,this._delay=s,this._useDelay=this._delay>0,this._repeat=r,this._runForever=this._repeat===fe.macro.REPEAT_FOREVER,!0},t.getInterval=function(){return this._interval},t.setInterval=function(e){this._interval=e},t.update=function(e){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=e,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},t.getCallback=function(){return this._callback},t.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},t.cancel=function(){this._scheduler.unschedule(this._callback,this._target)},e}();pn._timers=[],pn.get=function(){return pn._timers.pop()||new pn},pn.put=function(e){pn._timers.length<20&&!e._lock&&(e._scheduler=e._target=e._callback=null,pn._timers.push(e))};var _n=e("S",function(e){function t(){var t;return(t=e.call(this)||this)._timeScale=void 0,t._updatesNegList=void 0,t._updates0List=void 0,t._updatesPosList=void 0,t._hashForUpdates=void 0,t._hashForTimers=void 0,t._currentTarget=void 0,t._currentTargetSalvaged=void 0,t._updateHashLocked=void 0,t._arrayForTimers=void 0,t._timeScale=1,t._updatesNegList=[],t._updates0List=[],t._updatesPosList=[],t._hashForUpdates=He(!0),t._hashForTimers=He(!0),t._currentTarget=null,t._currentTargetSalvaged=!1,t._updateHashLocked=!1,t._arrayForTimers=[],t}Me(t,e),t.enableForTarget=function(e){var t=!1;(e.uuid||e.id)&&(t=!0),t||(e.__instanceId?Oe(1513):e.id=cn.getNewId())};var i=t.prototype;return i.setTimeScale=function(e){this._timeScale=e},i.getTimeScale=function(){return this._timeScale},i.update=function(e){var t,i,n,r,s;for(this._updateHashLocked=!0,1!==this._timeScale&&(e*=this._timeScale),t=0,n=(i=this._updatesNegList).length;t<n;t++)(r=i[t]).paused||r.markedForDeletion||r.target.update(e);for(t=0,n=(i=this._updates0List).length;t<n;t++)(r=i[t]).paused||r.markedForDeletion||r.target.update(e);for(t=0,n=(i=this._updatesPosList).length;t<n;t++)(r=i[t]).paused||r.markedForDeletion||r.target.update(e);var a=this._arrayForTimers;for(t=0;t<a.length;t++){if(s=a[t],this._currentTarget=s,this._currentTargetSalvaged=!1,!s.paused)for(s.timerIndex=0;s.timerIndex<s.timers.length;++s.timerIndex)s.currentTimer=s.timers[s.timerIndex],s.currentTimerSalvaged=!1,s.currentTimer.update(e),s.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--t)}for(t=0,i=this._updatesNegList;t<i.length;)(r=i[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;for(t=0,i=this._updates0List;t<i.length;)(r=i[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;for(t=0,i=this._updatesPosList;t<i.length;)(r=i[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;this._updateHashLocked=!1,this._currentTarget=null},i.schedule=function(e,t,i,n,r,s){if("function"!=typeof e){var a=e;e=t,t=a}3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(s=!!n,n=fe.macro.REPEAT_FOREVER,r=0),Be(t,1502);var o=t.uuid||t.id;if(o){var u,l,c=this._hashForTimers[o];if(c?c.paused!==s&&Oe(1511):(c=fn.get(null,t,0,null,null,s),this._arrayForTimers.push(c),this._hashForTimers[o]=c),null==c.timers)c.timers=[];else for(l=0;l<c.timers.length;++l)if((u=c.timers[l])&&e===u._callback)return Ue(1507,u.getInterval(),i),void(u._interval=i);(u=pn.get()).initWithCallback(this,e,t,i,n,r),c.timers.push(u),this._currentTarget===c&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)}else Le(1510)},i.scheduleUpdate=function(e,t,i){var n=e.uuid||e.id;if(n){var r=this._hashForUpdates[n];if(r&&r.entry){if(r.entry.priority===t)return r.entry.markedForDeletion=!1,void(r.entry.paused=i);if(this._updateHashLocked)return Ue(1506),r.entry.markedForDeletion=!1,void(r.entry.paused=i);this.unscheduleUpdate(e)}var s,a=hn.get(e,t,i,!1);0===t?(s=this._updates0List,this._appendIn(s,a)):(s=t<0?this._updatesNegList:this._updatesPosList,this._priorityIn(s,a,t)),this._hashForUpdates[n]=dn.get(s,a,e,null)}else Le(1510)},i.unschedule=function(e,t){if(t&&e){var i=t.uuid||t.id;if(i){var n=this,r=n._hashForTimers[i];if(r)for(var s=r.timers,a=0,o=s.length;a<o;a++){var u=s[a];if(e===u._callback)return u!==r.currentTimer||r.currentTimerSalvaged||(r.currentTimerSalvaged=!0),s.splice(a,1),pn.put(u),r.timerIndex>=a&&r.timerIndex--,void(0===s.length&&(n._currentTarget===r?n._currentTargetSalvaged=!0:n._removeHashElement(r)))}}else Le(1510)}},i.unscheduleUpdate=function(e){if(e){var t=e.uuid||e.id;if(t){var i=this._hashForUpdates[t];i&&(this._updateHashLocked?i.entry.markedForDeletion=!0:this._removeUpdateFromHash(i.entry))}else Le(1510)}},i.unscheduleAllForTarget=function(e){if(e){var t=e.uuid||e.id;if(t){var i=this._hashForTimers[t];if(i){var n=i.timers;n.indexOf(i.currentTimer)>-1&&!i.currentTimerSalvaged&&(i.currentTimerSalvaged=!0);for(var r=0,s=n.length;r<s;r++)pn.put(n[r]);n.length=0,this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)}this.unscheduleUpdate(e)}else Le(1510)}},i.unscheduleAll=function(){this.unscheduleAllWithMinPriority(fe.Scheduler.PRIORITY_SYSTEM)},i.unscheduleAllWithMinPriority=function(e){var t,i,n,r=this._arrayForTimers;for(t=r.length-1;t>=0;t--)i=r[t],this.unscheduleAllForTarget(i.target);var s=0;if(e<0)for(t=0;t<this._updatesNegList.length;)s=this._updatesNegList.length,(n=this._updatesNegList[t])&&n.priority>=e&&this.unscheduleUpdate(n.target),s===this._updatesNegList.length&&t++;if(e<=0)for(t=0;t<this._updates0List.length;)s=this._updates0List.length,(n=this._updates0List[t])&&this.unscheduleUpdate(n.target),s===this._updates0List.length&&t++;for(t=0;t<this._updatesPosList.length;)s=this._updatesPosList.length,(n=this._updatesPosList[t])&&n.priority>=e&&this.unscheduleUpdate(n.target),s===this._updatesPosList.length&&t++},i.isScheduled=function(e,t){Be(e,1508),Be(t,1509);var i=t.uuid||t.id;if(i){var n=this._hashForTimers[i];if(!n)return!1;if(null==n.timers)return!1;for(var r=n.timers,s=0;s<r.length;++s)if(e===r[s]._callback)return!0;return!1}Le(1510)},i.pauseAllTargets=function(){return this.pauseAllTargetsWithMinPriority(fe.Scheduler.PRIORITY_SYSTEM)},i.pauseAllTargetsWithMinPriority=function(e){var t,i,n,r,s=[],a=this._arrayForTimers;for(i=0,n=a.length;i<n;i++)(t=a[i])&&(t.paused=!0,s.push(t.target));if(e<0)for(i=0;i<this._updatesNegList.length;i++)(r=this._updatesNegList[i])&&r.priority>=e&&(r.paused=!0,s.push(r.target));if(e<=0)for(i=0;i<this._updates0List.length;i++)(r=this._updates0List[i])&&(r.paused=!0,s.push(r.target));for(i=0;i<this._updatesPosList.length;i++)(r=this._updatesPosList[i])&&r.priority>=e&&(r.paused=!0,s.push(r.target));return s},i.resumeTargets=function(e){if(e)for(var t=0;t<e.length;t++)this.resumeTarget(e[t])},i.pauseTarget=function(e){Be(e,1503);var t=e.uuid||e.id;if(t){var i=this._hashForTimers[t];i&&(i.paused=!0);var n=this._hashForUpdates[t];n&&(n.entry.paused=!0)}else Le(1510)},i.resumeTarget=function(e){Be(e,1504);var t=e.uuid||e.id;if(t){var i=this._hashForTimers[t];i&&(i.paused=!1);var n=this._hashForUpdates[t];n&&(n.entry.paused=!1)}else Le(1510)},i.isTargetPaused=function(e){Be(e,1505);var t=e.uuid||e.id;if(!t)return Le(1510),!1;var i=this._hashForTimers[t];if(i)return i.paused;var n=this._hashForUpdates[t];return!!n&&n.entry.paused},i._removeHashElement=function(e){var t=e.target.uuid||e.target.id;delete this._hashForTimers[t];for(var i=this._arrayForTimers,n=0,r=i.length;n<r;n++)if(i[n]===e){i.splice(n,1);break}fn.put(e)},i._removeUpdateFromHash=function(e){var t=e.target.uuid||e.target.id,i=this._hashForUpdates[t];if(i){for(var n=i.list,r=i.entry,s=0,a=n.length;s<a;s++)if(n[s]===r){n.splice(s,1);break}delete this._hashForUpdates[t],hn.put(r),dn.put(i)}},i._priorityIn=function(e,t,i){for(var n=0;n<e.length;n++)if(i<e[n].priority)return void e.splice(n,0,t);e.push(t)},i._appendIn=function(e,t){e.push(t)},t}(ln));_n.PRIORITY_SYSTEM=1<<31,_n.PRIORITY_NON_SYSTEM=_n.PRIORITY_SYSTEM+1,_n.ID="scheduler",fe.Scheduler=_n;var gn=function(){function e(){this._title="",this._width=1,this._height=1,this._nativeWidth=1,this._nativeHeight=1,this._renderPass=null,this._colorTextures=[],this._depthStencilTexture=null,this._swapchainBufferIndices=0,this._shouldSyncSizeWithSwapchain=!1,this._poolHandle=Ge,this._cameras=[]}e.registerCreateFunc=function(t){t._createWindowFun=function(t){return new e(t)}};var t=e.prototype;return t.initialize=function(e,t){this._poolHandle=Ve.alloc(),void 0!==t.title&&(this._title=t.title),void 0!==t.swapchainBufferIndices&&(this._swapchainBufferIndices=t.swapchainBufferIndices),void 0!==t.shouldSyncSizeWithSwapchain&&(this._shouldSyncSizeWithSwapchain=t.shouldSyncSizeWithSwapchain),this._width=t.width,this._height=t.height,this._nativeWidth=this._width,this._nativeHeight=this._height;for(var i=t.renderPassInfo,n=i.colorAttachments,r=i.depthStencilAttachment,s=0;s<n.length;s++)n[s].format===ye.UNKNOWN&&(n[s].format=e.colorFormat);r&&r.format===ye.UNKNOWN&&(r.format=e.depthStencilFormat),this._renderPass=e.createRenderPass(t.renderPassInfo);for(var a=0;a<n.length;a++){var o=null;this._swapchainBufferIndices&1<<a?Ve.set(this._poolHandle,je.HAS_ON_SCREEN_ATTACHMENTS,1):(o=e.createTexture(new Ee(Se.TEX2D,Ne.COLOR_ATTACHMENT|Ne.SAMPLED,n[a].format,this._width,this._height)),Ve.set(this._poolHandle,je.HAS_OFF_SCREEN_ATTACHMENTS,1)),this._colorTextures.push(o)}r&&(this._swapchainBufferIndices>=0?(this._depthStencilTexture=e.createTexture(new Ee(Se.TEX2D,Ne.DEPTH_STENCIL_ATTACHMENT|Ne.SAMPLED,r.format,this._width,this._height)),Ve.set(this._poolHandle,je.HAS_OFF_SCREEN_ATTACHMENTS,1)):Ve.set(this._poolHandle,je.HAS_ON_SCREEN_ATTACHMENTS,1));var u=ze.alloc(e,new qe(this._renderPass,this._colorTextures,this._depthStencilTexture));return Ve.set(this._poolHandle,je.FRAMEBUFFER,u),!0},t.destroy=function(){this.clearCameras(),this._depthStencilTexture&&(this._depthStencilTexture.destroy(),this._depthStencilTexture=null);for(var e=0;e<this._colorTextures.length;e++){var t=this._colorTextures[e];t&&t.destroy()}this._colorTextures.length=0,this._poolHandle&&(ze.get(Ve.get(this._poolHandle,je.FRAMEBUFFER)).destroy(),this._poolHandle=Ge)},t.resize=function(e,t){if(this._width=e,this._height=t,e>this._nativeWidth||t>this._nativeHeight){this._nativeWidth=e,this._nativeHeight=t;var i=!1;this._depthStencilTexture&&(this._depthStencilTexture.resize(e,t),i=!0);for(var n=0;n<this._colorTextures.length;n++){var r=this._colorTextures[n];r&&(r.resize(e,t),i=!0)}var s=ze.get(Ve.get(this._poolHandle,je.FRAMEBUFFER));i&&s&&(s.destroy(),s.initialize(new qe(this._renderPass,this._colorTextures,this._depthStencilTexture)))}for(var a,o=Ye(this._cameras);!(a=o()).done;){var u=a.value;u.isWindowSize&&u.resize(e,t)}},t.extractRenderCameras=function(e){for(var t=0;t<this._cameras.length;t++){var i=this._cameras[t];i.enabled&&(i.update(),e.push(i))}},t.attachCamera=function(e){for(var t=0;t<this._cameras.length;t++)if(this._cameras[t]===e)return;this._cameras.push(e),this.sortCameras()},t.detachCamera=function(e){for(var t=0;t<this._cameras.length;++t)if(this._cameras[t]===e)return void this._cameras.splice(t,1)},t.clearCameras=function(){this._cameras.length=0},t.sortCameras=function(){this._cameras.sort((function(e,t){return e.priority-t.priority}))},ke(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"framebuffer",get:function(){return ze.get(Ve.get(this._poolHandle,je.FRAMEBUFFER))}},{key:"shouldSyncSizeWithSwapchain",get:function(){return this._shouldSyncSizeWithSwapchain}},{key:"hasOnScreenAttachments",get:function(){return 1===Ve.get(this._poolHandle,je.HAS_ON_SCREEN_ATTACHMENTS)}},{key:"hasOffScreenAttachments",get:function(){return 1===Ve.get(this._poolHandle,je.HAS_OFF_SCREEN_ATTACHMENTS)}},{key:"handle",get:function(){return this._poolHandle}},{key:"cameras",get:function(){return this._cameras}}]),e}(),mn=function(){function e(e){var t=this;this._createSceneFun=null,this._createWindowFun=null,this._device=void 0,this._windows=[],this._mainWindow=null,this._curWindow=null,this._tempWindow=null,this._pipeline=null,this._batcher=null,this._dataPoolMgr=void 0,this._scenes=[],this._modelPools=new Map,this._cameraPool=null,this._lightPools=new Map,this._fpsTime=0,this._frameCount=0,this._fps=0,this._fixedFPS=0,this._fixedFPSFrameTime=0,this._poolHandle=Ge,this._useDeferredPipeline=!1,this._device=e,this._dataPoolMgr=fe.internal.DataPoolManager&&new fe.internal.DataPoolManager(e),Mi.registerCreateFunc(this),gn.registerCreateFunc(this),this._cameraPool=new tt((function(){return new Pi(t._device)}),4)}var t=e.prototype;return t.initialize=function(){var e=this;this._poolHandle=Xe.alloc();var t=new $e,i=new Je;i.depthStoreOp=Qe.DISCARD,i.stencilStoreOp=Qe.DISCARD;var n=new Ke([t],i);return this._mainWindow=this.createWindow({title:"rootMainWindow",width:this._device.width,height:this._device.height,renderPassInfo:n,swapchainBufferIndices:-1}),this._curWindow=this._mainWindow,Promise.resolve(Ze.initBuiltinRes(this._device)).then((function(){fe.view.on("design-resolution-changed",(function(){var t=fe.game.canvas.width,i=fe.game.canvas.height;e.resize(t,i)}),e)}))},t.destroy=function(){this.destroyScenes(),this._pipeline&&(this._pipeline.destroy(),this._pipeline=null),this._batcher&&(this._batcher.destroy(),this._batcher=null),this._curWindow=null,this._mainWindow=null,this.dataPoolManager.clear(),this._poolHandle&&(Xe.free(this._poolHandle),this._poolHandle=Ge)},t.resize=function(e,t){this._device.resize(e,t),this._mainWindow.resize(e,t);for(var i,n=Ye(this._windows);!(i=n()).done;){var r=i.value;r.shouldSyncSizeWithSwapchain&&r.resize(e,t)}this._pipeline&&this._pipeline.resize(e,t)},t.setRenderPipeline=function(e){if(e instanceof Ci&&(this._useDeferredPipeline=!0),e||(e=an()),this._pipeline=e,!this._pipeline.activate())return!1;var t=fe.director.getScene();return t&&t.globals.activate(),this.onGlobalPipelineStateChanged(),!(!this._batcher&&fe.internal.Batcher2D&&(this._batcher=new fe.internal.Batcher2D(this),!this._batcher.initialize())&&(this.destroy(),1))},t.onGlobalPipelineStateChanged=function(){for(var e=0;e<this._scenes.length;e++)this._scenes[e].onGlobalPipelineStateChanged();this._pipeline.pipelineSceneData.initDeferredPassInfo()},t.activeWindow=function(e){this._curWindow=e},t.resetCumulativeTime=function(){Xe.set(this._poolHandle,et.CUMULATIVE_TIME,0)},t.frameMove=function(e){Xe.set(this._poolHandle,et.FRAME_TIME,e),++this._frameCount,Xe.set(this._poolHandle,et.CUMULATIVE_TIME,Xe.get(this._poolHandle,et.CUMULATIVE_TIME)+e),this._fpsTime+=e,this._fpsTime>1&&(this._fps=this._frameCount,this._frameCount=0,this._fpsTime=0);for(var t=0;t<this._scenes.length;++t)this._scenes[t].removeBatches();this._batcher&&this._batcher.update();for(var i=this._windows,n=[],r=0;r<i.length;r++)i[r].extractRenderCameras(n);if(this._pipeline&&n.length>0){this._device.acquire();var s=this._scenes,a=fe.director.getTotalFrames();this._batcher&&this._batcher.uploadBuffers();for(var o=0;o<s.length;o++)s[o].update(a);fe.director.emit(fe.Director.EVENT_BEFORE_COMMIT),n.sort((function(e,t){return e.priority-t.priority})),this._pipeline.render(n),this._device.present()}this._batcher&&this._batcher.reset()},t.createWindow=function(e){var t=this._createWindowFun(this);return t.initialize(this.device,e),this._windows.push(t),t},t.destroyWindow=function(e){for(var t=0;t<this._windows.length;++t)if(this._windows[t]===e)return e.destroy(),void this._windows.splice(t,1)},t.destroyWindows=function(){for(var e,t=Ye(this._windows);!(e=t()).done;)e.value.destroy();this._windows=[]},t.createScene=function(e){var t=this._createSceneFun(this);return t.initialize(e),this._scenes.push(t),t},t.destroyScene=function(e){for(var t=0;t<this._scenes.length;++t)if(this._scenes[t]===e)return e.destroy(),void this._scenes.splice(t,1)},t.destroyScenes=function(){for(var e,t=Ye(this._scenes);!(e=t()).done;)e.value.destroy();this._scenes=[]},t.createModel=function(e){var t=this._modelPools.get(e);t||(this._modelPools.set(e,new tt((function(){return new e}),10)),t=this._modelPools.get(e));var i=t.alloc();return i.initialize(),i},t.destroyModel=function(e){var t=this._modelPools.get(e.constructor);t?(t.free(e),e.destroy(),e.scene&&e.scene.removeModel(e)):Oe(1300,e.constructor.name)},t.createCamera=function(){return this._cameraPool.alloc()},t.createLight=function(e){var t=this._lightPools.get(e);t||(this._lightPools.set(e,new tt((function(){return new e}),4)),t=this._lightPools.get(e));var i=t.alloc();return i.initialize(),i},t.destroyLight=function(e){var t=this._lightPools.get(e.constructor);if(e.destroy(),t&&(t.free(e),e.scene))switch(e.type){case xi.SPHERE:e.scene.removeSphereLight(e);break;case xi.SPOT:e.scene.removeSpotLight(e)}},ke(e,[{key:"device",get:function(){return this._device}},{key:"mainWindow",get:function(){return this._mainWindow}},{key:"curWindow",get:function(){return this._curWindow},set:function(e){this._curWindow=e}},{key:"tempWindow",get:function(){return this._tempWindow},set:function(e){this._tempWindow=e}},{key:"windows",get:function(){return this._windows}},{key:"pipeline",get:function(){return this._pipeline}},{key:"batcher2D",get:function(){return this._batcher}},{key:"scenes",get:function(){return this._scenes}},{key:"cumulativeTime",get:function(){return Xe.get(this._poolHandle,et.CUMULATIVE_TIME)}},{key:"frameTime",get:function(){return Xe.get(this._poolHandle,et.FRAME_TIME)}},{key:"frameCount",get:function(){return this._frameCount}},{key:"fps",get:function(){return this._fps}},{key:"fixedFPS",get:function(){return this._fixedFPS},set:function(e){e>0?(this._fixedFPS=e,this._fixedFPSFrameTime=1e3/e):this._fixedFPSFrameTime=0}},{key:"dataPoolManager",get:function(){return this._dataPoolMgr}},{key:"handle",get:function(){return this._poolHandle}},{key:"useDeferredPipeline",get:function(){return this._useDeferredPipeline}}]),e}();fe.Root=mn;var vn={};it(vn,"vmath",[{name:"vec2",newName:"Vec2",target:rn,targetName:"math"},{name:"vec3",newName:"Vec3",target:rn,targetName:"math"},{name:"vec4",newName:"Vec4",target:rn,targetName:"math"},{name:"quat",newName:"Quat",target:rn,targetName:"math"},{name:"mat3",newName:"Mat3",target:rn,targetName:"math"},{name:"mat4",newName:"Mat4",target:rn,targetName:"math"},{name:"color4",newName:"Color",target:rn,targetName:"math"},{name:"rect",newName:"Rect",target:rn,targetName:"math"},{name:"approx",newName:"approx",target:rn,targetName:"math"},{name:"EPSILON",newName:"EPSILON",target:rn,targetName:"math"},{name:"equals",newName:"equals",target:rn,targetName:"math"},{name:"clamp",newName:"clamp",target:rn,targetName:"math"},{name:"clamp01",newName:"clamp01",target:rn,targetName:"math"},{name:"lerp",newName:"lerp",target:rn,targetName:"math"},{name:"toRadian",newName:"toRadian",target:rn,targetName:"math"},{name:"toDegree",newName:"toDegree",target:rn,targetName:"math"},{name:"random",newName:"random",target:rn,targetName:"math"},{name:"randomRange",newName:"randomRange",target:rn,targetName:"math"},{name:"randomRangeInt",newName:"randomRangeInt",target:rn,targetName:"math"},{name:"pseudoRandom",newName:"pseudoRandom",target:rn,targetName:"math"},{name:"pseudoRandomRangeInt",newName:"pseudoRandomRangeInt",target:rn,targetName:"math"},{name:"nextPow2",newName:"nextPow2",target:rn,targetName:"math"},{name:"repeat",newName:"repeat",target:rn,targetName:"math"},{name:"pingPong",newName:"pingPong",target:rn,targetName:"math"},{name:"inverseLerp",newName:"inverseLerp",target:rn,targetName:"math"}]),fe.vmath=vn,it(_n.prototype,"Scheduler.prototype",[{name:"enableForTarget",newName:"enableForTarget",target:_n,targetName:"Scheduler"}]),it(ki.prototype,"EventTouch.prototype",[{name:"getUILocationInView",newName:"getLocationInView",target:ki,targetName:"EventTouch"}]),it(Bi.prototype,"SubModel.prototype",[{name:"subMeshData",newName:"subMesh"}]),nt(Bi.prototype,"SubModel.prototype",[{name:"getSubModel",suggest:"Use `subModels[i]` instead"},{name:"subModelNum",suggest:"Use `subModels.length` instead"}]),it(mn.prototype,"Root.prototype",[{name:"ui",newName:"batcher2D"}]);var yn=Object.freeze({__proto__:null,ccclass:rt,property:st,requireComponent:Li,executionOrder:Oi,disallowMultiple:Ui,executeInEditMode:at,menu:ot,playOnFocus:ut,inspector:lt,icon:ct,help:ht,type:dt,integer:ft,float:pt,boolean:_t,string:gt});e("_",yn);var wn=mt.Flags.Destroyed,Tn=mt.Flags.PersistentMask,bn=[];function An(e){var t;if(e instanceof mt){if(e._instantiate)return fe.game._isCloning=!0,t=e._instantiate(null,!0),fe.game._isCloning=!1,t;if(e instanceof fe.Asset)throw new TypeError(vt(6903))}return fe.game._isCloning=!0,t=En(e),fe.game._isCloning=!1,t}function En(e,t){var i;Sn(e,i=e._iN$t?e._iN$t:e.constructor?new(0,e.constructor):Object.create(null),t);for(var n=0,r=bn.length;n<r;++n)bn[n]._iN$t=null;return bn.length=0,i}function Sn(e,t,i){yt.value(e,"_iN$t",t,!0),bn.push(e);var n=e.constructor;if(fe.Class._isCCClass(n))!function(e,t,i,n){for(var r=e.__values__,s=0;s<r.length;s++){var a=r[s],o=t[a];if("object"==typeof o&&o){var u=i[a];u instanceof wt&&u.constructor===o.constructor?u.set(o):i[a]=o._iN$t||Nn(o,n)}else i[a]=o}}(n,e,t,i);else for(var r in e)if(e.hasOwnProperty(r)&&(95!==r.charCodeAt(0)||95!==r.charCodeAt(1)||"__type__"===r)){var s=e[r];if("object"==typeof s&&s){if(s===t)continue;t[r]=s._iN$t||Nn(s,i)}else t[r]=s}e instanceof mt&&(t._objFlags&=Tn)}function Nn(e,t){if(e instanceof wt)return e.clone();if(e instanceof fe.Asset)return e;var i;if(ArrayBuffer.isView(e)){var n=e.length;i=new e.constructor(n),e._iN$t=i,bn.push(e);for(var r=0;r<n;++r)i[r]=e[r];return i}if(Array.isArray(e)){var s=e.length;i=new Array(s),e._iN$t=i,bn.push(e);for(var a=0;a<s;++a){var o=e[a];i[a]="object"==typeof o&&o?o._iN$t||Nn(o,t):o}return i}if(e._objFlags&wn)return null;var u=e.constructor;if(fe.Class._isCCClass(u)){if(t)if(t instanceof fe.Component){if(e instanceof fe._BaseNode||e instanceof fe.Component)return e}else if(t instanceof fe._BaseNode)if(e instanceof fe._BaseNode){if(!e.isChildOf(t))return e}else if(e instanceof fe.Component&&e.node&&!e.node.isChildOf(t))return e;i=new u}else if(u===Object)i={};else{if(u)return e;i=Object.create(null)}return Sn(e,i,t),i}An._clone=En,fe.instantiate=An,fe._decorator=yn;var In=e("D",function(e){function t(){var t;return(t=e.call(this)||this)._compScheduler=void 0,t._nodeActivator=void 0,t._invalid=void 0,t._paused=void 0,t._purgeDirectorInNextLoop=void 0,t._root=void 0,t._loadingScene=void 0,t._scene=void 0,t._totalFrames=void 0,t._lastUpdate=void 0,t._deltaTime=void 0,t._startTime=void 0,t._scheduler=void 0,t._systems=void 0,t._invalid=!1,t._paused=!1,t._purgeDirectorInNextLoop=!1,t._root=null,t._loadingScene="",t._scene=null,t._totalFrames=0,t._lastUpdate=0,t._deltaTime=0,t._startTime=0,t._scheduler=new _n,t._compScheduler=new Qi,t._nodeActivator=new Ki,t._systems=[],fe.game.once(Di.EVENT_RENDERER_INITED,t._initOnRendererInitialized,Et(t)),t}Me(t,e);var i=t.prototype;return i.calculateDeltaTime=function(e){e||(e=performance.now()),this._deltaTime=e>this._lastUpdate?(e-this._lastUpdate)/1e3:0,this._lastUpdate=e},i.convertToGL=function(e){var t=fe.game.container,i=fe.view,n=t.getBoundingClientRect(),s=n.left+window.pageXOffset-t.clientLeft,a=n.top+window.pageYOffset-t.clientTop,o=i._devicePixelRatio*(e.x-s),u=i._devicePixelRatio*(a+n.height-e.y);return i._isRotated?r(i._viewportRect.width-u,o):r(o,u)},i.convertToUI=function(e){var t=fe.game.container,i=fe.view,n=t.getBoundingClientRect(),s=n.left+window.pageXOffset-t.clientLeft,a=n.top+window.pageYOffset-t.clientTop,o=r(0,0);return i._isRotated?(o.x=s+e.y/i._devicePixelRatio,o.y=a+n.height-(i._viewportRect.width-e.x)/i._devicePixelRatio):(o.x=s+e.x*i._devicePixelRatio,o.y=a+n.height-e.y*i._devicePixelRatio),o},i.end=function(){this._purgeDirectorInNextLoop=!0},i.getWinSize=function(){return g(fe.winSize)},i.getWinSizeInPixels=function(){return g(fe.winSize)},i.pause=function(){this._paused||(this._paused=!0)},i.purgeCachedData=function(){fe.assetManager.releaseAll()},i.purgeDirector=function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),Tt&&Tt.setEnabled(!1),fe.isValid(this._scene)&&this._scene.destroy(),this._scene=null,this.stopAnimation(),fe.assetManager.releaseAll()},i.reset=function(){this.purgeDirector(),this.emit(t.EVENT_RESET),Tt&&Tt.setEnabled(!0),this.startAnimation()},i.runSceneImmediate=function(e,t,i){e instanceof $i&&(e=e.scene),Be(e instanceof Ji,1216),e._load();for(var n=Object.keys(fe.game._persistRootNodes).map((function(e){return fe.game._persistRootNodes[e]})),r=0;r<n.length;r++){var s=n[r];s.emit(fe.Node.SCENE_CHANGED_FOR_PERSISTS,e.renderScene);var a=e.uuid===s._originalSceneId&&e.getChildByUuid(s.uuid);if(a){var o=a.getSiblingIndex();a._destroyImmediate(),e.insertChild(s,o)}else s.parent=e}var u=this._scene;fe.isValid(u)&&u.destroy(),fe.assetManager._releaseManager._autoRelease(u,e,fe.game._persistRootNodes),this._scene=null,mt._deferredDestroy(),t&&t(),this.emit(fe.Director.EVENT_BEFORE_SCENE_LAUNCH,e),this._scene=e,e._activate(),this._root&&this._root.resetCumulativeTime(),this.startAnimation(),i&&i(null,e),this.emit(fe.Director.EVENT_AFTER_SCENE_LAUNCH,e)},i.runScene=function(e,t,i){var n=this;e instanceof $i&&(e=e.scene),Be(e,1205),Be(e instanceof Ji,1216),e._load(),this.once(fe.Director.EVENT_AFTER_DRAW,(function(){n.runSceneImmediate(e,t,i)}))},i.loadScene=function(e,t,i){var n=this;if(this._loadingScene)return Oe(1208,e,this._loadingScene),!1;var r=fe.assetManager.bundles.find((function(t){return!!t.getSceneInfo(e)}));return r?(this.emit(fe.Director.EVENT_BEFORE_SCENE_LOADING,e),this._loadingScene=e,console.time("LoadScene "+e),r.loadScene(e,(function(r,s){console.timeEnd("LoadScene "+e),n._loadingScene="",r?(he(r),t&&t(r)):n.runSceneImmediate(s,i,t)})),!0):(Le(1209,e),!1)},i.preloadScene=function(e,t,i){var n=fe.assetManager.bundles.find((function(t){return!!t.getSceneInfo(e)}));if(n)n.preloadScene(e,null,t,i);else{var r='Can not preload the scene "'+e+'" because it is not in the build settings.';i&&i(new Error(r)),he("preloadScene: "+r)}},i.resume=function(){this._paused&&(this._lastUpdate=performance.now(),this._lastUpdate||Ue(1200),this._paused=!1,this._deltaTime=0)},i.setDepthTest=function(e){fe.Camera.main&&(fe.Camera.main.depth=!!e)},i.setClearColor=function(e){fe.Camera.main&&(fe.Camera.main.backgroundColor=e)},i.getRunningScene=function(){return this._scene},i.getScene=function(){return this._scene},i.getAnimationInterval=function(){return 1e3/fe.game.getFrameRate()},i.setAnimationInterval=function(e){fe.game.setFrameRate(Math.round(1e3/e))},i.getDeltaTime=function(){return this._deltaTime},i.getTotalTime=function(){return performance.now()-this._startTime},i.getCurrentTime=function(){return this._lastUpdate},i.getTotalFrames=function(){return this._totalFrames},i.isPaused=function(){return this._paused},i.getScheduler=function(){return this._scheduler},i.setScheduler=function(e){this._scheduler!==e&&(this.unregisterSystem(this._scheduler),this._scheduler=e,this.registerSystem(_n.ID,e,200))},i.registerSystem=function(e,t,i){t.id=e,t.priority=i,t.init(),this._systems.push(t),this._systems.sort(ln.sortByPriority)},i.unregisterSystem=function(e){bt.fastRemove(this._systems,e),this._systems.sort(ln.sortByPriority)},i.getSystem=function(e){return this._systems.find((function(t){return t.id===e}))},i.getAnimationManager=function(){return this.getSystem(fe.AnimationManager.ID)},i.startAnimation=function(){this._invalid=!1,this._lastUpdate=performance.now()},i.stopAnimation=function(){this._invalid=!0},i.mainLoop=function(e){if(this._purgeDirectorInNextLoop)this._purgeDirectorInNextLoop=!1,this.purgeDirector();else if(!this._invalid){this.calculateDeltaTime(e);var i=this._deltaTime;if(!this._paused){this.emit(t.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(i);for(var n=0;n<this._systems.length;++n)this._systems[n].update(i);this._compScheduler.lateUpdatePhase(i),this.emit(t.EVENT_AFTER_UPDATE),mt._deferredDestroy();for(var r=0;r<this._systems.length;++r)this._systems[r].postUpdate(i)}this.emit(t.EVENT_BEFORE_DRAW),this._root.frameMove(this._deltaTime),this.emit(t.EVENT_AFTER_DRAW),Tt.frameUpdateListeners(),At.clearBooks(),this._totalFrames++}},i._initOnRendererInitialized=function(){this._totalFrames=0,this._lastUpdate=performance.now(),this._startTime=this._lastUpdate,this._paused=!1,this._purgeDirectorInNextLoop=!1,Tt&&Tt.setEnabled(!0),this.registerSystem(_n.ID,this._scheduler,200),this.emit(t.EVENT_INIT)},i._init=function(){return this._root=new mn(fe.game._gfxDevice),this._root.initialize({}).catch((function(e){return Le(1217),Promise.reject(e)}))},ke(t,[{key:"root",get:function(){return this._root}}]),t}(St));In.EVENT_INIT="director_init",In.EVENT_RESET="director_reset",In.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",In.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",In.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",In.EVENT_BEFORE_UPDATE="director_before_update",In.EVENT_AFTER_UPDATE="director_after_update",In.EVENT_BEFORE_DRAW="director_before_draw",In.EVENT_AFTER_DRAW="director_after_draw",In.EVENT_BEFORE_COMMIT="director_before_commit",In.EVENT_BEFORE_PHYSICS="director_before_physics",In.EVENT_AFTER_PHYSICS="director_after_physics",In.instance=void 0,fe.Director=In;var Rn=e("f",In.instance=fe.director=new In),Cn=function(){function e(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new Nt,this.scenes=new Nt,this.paths=new Nt}var t=e.prototype;return t.init=function(e){!function(e){var t=e.uuids,i=e.paths,n=e.types,r=e.deps,s=e.paths=Object.create(null);if(!1===e.debug){for(var a=0,o=t.length;a<o;a++)t[a]=Rt(t[a]);for(var u in i){var l=i[u],c=l[1];l[1]=n[c]}}else{for(var h=Object.create(null),d=0,f=t.length;d<f;d++){var p=t[d];t[d]=h[p]=Rt(p)}t=h}for(var _ in i){var g=i[_];s[t[_]]=g}var m=e.scenes;for(var v in m){var y=m[v];m[v]=t[y]}var w=e.packs;for(var T in w)for(var b=w[T],A=0;A<b.length;++A)b[A]=t[b[A]];var E=e.versions;if(E)for(var S in E)for(var N=E[S],I=0;I<N.length;I+=2){var R=N[I];N[I]=t[R]||R}var C=e.redirect;if(C)for(var x=0;x<C.length;x+=2)C[x]=t[C[x]],C[x+1]=r[C[x+1]]}(e),this.importBase=e.importBase||"",this.nativeBase=e.nativeBase||"",this.base=e.base||"",this.name=e.name||"",this.deps=e.deps||[],this._initUuid(e.uuids),this._initPath(e.paths),this._initScene(e.scenes),this._initPackage(e.packs),this._initVersion(e.versions),this._initRedirect(e.redirect)},t.getInfoWithPath=function(e,t){if(!e)return null;e=It(e);var i=this.paths.get(e);if(i){if(!t)return i[0];for(var n=0,r=i.length;n<r;n++){var s=i[n];if(yt.isChildClassOf(s.ctor,t))return s}}return null},t.getDirWithPath=function(e,t,i){"/"===(e=It(e))[e.length-1]&&(e=e.slice(0,-1));var n=i||[];return this.paths.forEach((function(i,r){if(r.startsWith(e)&&function(e,t){return!(e.length>t.length)||47===e.charCodeAt(t.length)}(r,e)||!e)for(var s=0,a=i.length;s<a;s++){var o=i[s];t&&!yt.isChildClassOf(o.ctor,t)||n.push(o)}})),n},t.getAssetInfo=function(e){return this.assetInfos.get(e)||null},t.getSceneInfo=function(e){return e.endsWith(".scene")||(e+=".scene"),"/"===e[0]||e.startsWith("db://")||(e="/"+e),this.scenes.find((function(t,i){return i.endsWith(e)}))},t.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},t._initUuid=function(e){if(e){this.assetInfos.clear();for(var t=0,i=e.length;t<i;t++){var n=e[t];this.assetInfos.add(n,{uuid:n})}}},t._initPath=function(e){if(e){var t=this.paths;for(var i in t.clear(),e){var n=e[i],r=n[0],s=n[1],a=3===n.length,o=this.assetInfos.get(i);o.path=r,o.ctor=yt._getClassById(s),t.has(r)?a?t.get(r).push(o):t.get(r).splice(0,0,o):t.add(r,[o])}}},t._initScene=function(e){if(e){var t=this.scenes;t.clear();var i=this.assetInfos;for(var n in e){var r=e[n],s=i.get(r);s.url=n,t.add(n,s)}}},t._initPackage=function(e){if(e){var t=this.assetInfos;for(var i in e){var n=e[i],r={uuid:i,packedUuids:n,ext:".json"};t.add(i,r);for(var s=0,a=n.length;s<a;s++){var o=n[s],u=t.get(o),l=u.packs;l?1===a?l.splice(0,0,r):l.push(r):u.packs=[r]}}}},t._initVersion=function(e){if(e){var t=this.assetInfos,i=e.import;if(i)for(var n=0,r=i.length;n<r;n+=2){var s=i[n];t.get(s).ver=i[n+1]}if(i=e.native)for(var a=0,o=i.length;a<o;a+=2){var u=i[a];t.get(u).nativeVer=i[a+1]}}},t._initRedirect=function(e){if(e)for(var t=this.assetInfos,i=0,n=e.length;i<n;i+=2){var r=e[i];t.get(r).redirect=e[i+1]}},e}();function xn(e,t){e._uuid&&t.push(e._uuid)}function Pn(e,t){for(var i=Object.getOwnPropertyNames(e),n=0;n<i.length;n++){var r=i[n];if("node"!==r&&"__eventTargets"!==r){var s=e[r];if("object"==typeof s&&s)if(Array.isArray(s))for(var a=0;a<s.length;a++){var o=s[a];o instanceof Pt&&xn(o,t)}else if(s.constructor&&s.constructor!==Object)s instanceof Pt&&xn(s,t);else for(var u=Object.getOwnPropertyNames(s),l=0;l<u.length;l++){var c=s[u[l]];c instanceof Pt&&xn(c,t)}}}}function kn(e,t){for(var i=0;i<e._components.length;i++)Pn(e._components[i],t);for(var n=0;n<e._children.length;n++)kn(e._children[n],t)}function Dn(e,t,i,n){i.push(e._uuid);for(var r=xt.getDeps(e._uuid),s=0,a=r.length;s<a;s++){var o=Ct.get(r[s]);if(o){var u=o._uuid;u in t?t[u]+=n:t[u]=o.refCount+n,i.includes(u)||Dn(o,t,i,n)}}}var Fn=[],Mn=new(function(){function e(){this._persistNodeDeps=new Nt,this._toDelete=new Nt,this._eventListener=!1}var t=e.prototype;return t.init=function(){this._persistNodeDeps.clear(),this._toDelete.clear()},t._addPersistNodeRef=function(e){var t=[];kn(e,t);for(var i=0,n=t.length;i<n;i++){var r=Ct.get(t[i]);r&&r.addRef()}this._persistNodeDeps.add(e.uuid,t)},t._removePersistNodeRef=function(e){if(this._persistNodeDeps.has(e.uuid)){for(var t=this._persistNodeDeps.get(e.uuid),i=0,n=t.length;i<n;i++){var r=Ct.get(t[i]);r&&r.decRef()}this._persistNodeDeps.remove(e.uuid)}},t._autoRelease=function(e,t,i){if(e){for(var n=xt.getDeps(e.uuid),r=0,s=n.length;r<s;r++){var a=Ct.get(n[r]);a&&a.decRef(e.autoReleaseAssets)}var o=xt._depends.get(e.uuid);if(o&&o.persistDeps)for(var u=o.persistDeps,l=0,c=u.length;l<c;l++){var h=Ct.get(u[l]);h&&h.decRef(e.autoReleaseAssets)}e.uuid!==t.uuid&&xt.remove(e.uuid)}var d=xt._depends.get(t.uuid);for(var f in d&&(d.persistDeps=[]),i){for(var p,_,g=i[f],m=this._persistNodeDeps.get(g.uuid),v=Ye(m);!(_=v()).done;){var y=_.value,w=Ct.get(y);w&&w.addRef()}d&&(p=d.persistDeps).push.apply(p,m)}},t.tryRelease=function(e,t){void 0===t&&(t=!1),e instanceof Pt&&(t?this._free(e,t):(this._toDelete.add(e._uuid,e),this._eventListener||(this._eventListener=!0,kt(this._freeAssets.bind(this)))))},t._freeAssets=function(){var e=this;this._eventListener=!1,this._toDelete.forEach((function(t){e._free(t)})),this._toDelete.clear()},t._free=function(e,t){void 0===t&&(t=!1);var i=e._uuid;if(this._toDelete.remove(i),Dt(e,!0)&&!(!t&&e.refCount>0&&function(e){var t=Object.create(null);if(t[e._uuid]=e.refCount,Dn(e,t,Fn,-1),Fn.length=0,0!==t[e._uuid])return t[e._uuid];for(var i in t)0!==t[i]&&Dn(Ct.get(i),t,Fn,1);return Fn.length=0,t[e._uuid]}(e)>0)){Ct.remove(i);for(var n=xt.getDeps(i),r=0,s=n.length;r<s;r++){var a=Ct.get(n[r]);a&&(a.decRef(!1),this._free(a,!1))}e.destroy(),xt.remove(i)}},e}()),Bn=null;function Ln(e,t){for(var i=0,n=e.input.length;i<n;i++){var r=e.input[i];t&&!r.isNative&&r.content instanceof Pt&&r.content.decRef(!1),r.recycle()}e.input=null}function On(e,t){return t?/\?/.test(e)?e+"&_t="+Date.now():e+"?_t="+Date.now():e}function Un(e,t,i,n,r){void 0===r&&(r=0),e(r,(function(s,a){r++,!s||r>t?n&&n(s,a):setTimeout((function(){Un(e,t,i,n,r)}),i)}))}function Hn(e,t,i,n,r){try{for(var s=xt.parse(e,t),a=0,o=s.deps.length;a<o;a++){var u=s.deps[a];u in i||(i[u]=!0,n.push({uuid:u,bundle:r&&r.name}))}s.nativeDep&&(r&&(s.nativeDep.bundle=r.name),n.push(Ft({},s.nativeDep)))}catch(e){he(e.message,e.stack)}}function Wn(e,t,i){t&&(i=void 0!==i?i:fe.assetManager.cacheAsset,Mt(t)||!i||t.isDefault||Ct.add(e,t))}function Vn(e,t,i){var n=0,r=[],s=e.length;0===s&&i&&i(r);for(var a=function(e){e&&r.push(e),++n===s&&i&&i(r)},o=0;o<s;o++)t(e[o],a)}function jn(e,t,i){var n=e,r=t,s=i;if(void 0===i){var a="function"==typeof e;t?(s=t,a||(r=null)):void 0===t&&a&&(s=e,n=null,r=null),void 0!==t&&a&&(r=e,n=null)}return{options:n||Object.create(null),onProgress:r,onComplete:s}}function zn(e,t,i){var n=e,r=t,s=i;if(void 0===i){var a=yt.isChildClassOf(e,Pt);t?(s=t,a&&(r=null)):void 0!==t||a||(s=e,r=null,n=null),void 0===t||a||(r=e,n=null)}return{type:n,onProgress:r||Bn,onComplete:s}}function qn(e,t,i,n){if(void 0===n&&(n={}),!i[t]||n[t])return!1;n[t]=!0;var r=!1,s=xt.getDeps(t);if(s)for(var a=0,o=s.length;a<o;a++){var u=s[a];if(u===e||qn(e,u,i,n)){r=!0;break}}return r}function Gn(e){return function(t,i){if(e){var n=[];Array.isArray(i)?i.forEach((function(e){return e instanceof Pt&&n.push(e.addRef())})):i instanceof Pt&&n.push(i.addRef()),kt((function(){n.forEach((function(e){return e.decRef(!1)})),e(t,i)}))}}}var Yn=function(){function e(){this._config=new Cn}var t=e.prototype;return t.getInfoWithPath=function(e,t){return this._config.getInfoWithPath(e,t)},t.getDirWithPath=function(e,t,i){return this._config.getDirWithPath(e,t,i)},t.getAssetInfo=function(e){return this._config.getAssetInfo(e)},t.getSceneInfo=function(e){return this._config.getSceneInfo(e)},t.init=function(e){this._config.init(e),Bt.add(e.name,this)},t.load=function(e,t,i,n){var r=zn(t,i,n),s=r.type,a=r.onProgress,o=r.onComplete,u={__requestType__:Lt.PATH,type:s,bundle:this.name,__outputAsArray__:Array.isArray(e)};fe.assetManager.loadAny(e,u,a,o)},t.preload=function(e,t,i,n){var r=zn(t,i,n),s=r.type,a=r.onProgress,o=r.onComplete;fe.assetManager.preloadAny(e,{__requestType__:Lt.PATH,type:s,bundle:this.name},a,o)},t.loadDir=function(e,t,i,n){var r=zn(t,i,n),s=r.type,a=r.onProgress,o=r.onComplete;fe.assetManager.loadAny(e,{__requestType__:Lt.DIR,type:s,bundle:this.name,__outputAsArray__:!0},a,o)},t.preloadDir=function(e,t,i,n){var r=zn(t,i,n),s=r.type,a=r.onProgress,o=r.onComplete;fe.assetManager.preloadAny(e,{__requestType__:Lt.DIR,type:s,bundle:this.name},a,o)},t.loadScene=function(e,t,i,n){var r=jn(t,i,n),s=r.options,a=r.onProgress,o=r.onComplete;s.preset=s.preset||"scene",s.bundle=this.name,fe.assetManager.loadAny({scene:e},s,a,(function(e,t){if(e)he(e.message,e.stack);else if(t instanceof $i&&t.scene){var i=t.scene;i._id=t._uuid,i.name=t.name}else e=new Error("The asset "+t._uuid+" is not a scene");o&&o(e,t)}))},t.preloadScene=function(e,t,i,n){var r=jn(t,i,n),s=r.options,a=r.onProgress,o=r.onComplete;s.bundle=this.name,fe.assetManager.preloadAny({scene:e},s,a,(function(t){t&&Le(1210,e,t.message),o&&o(t)}))},t.get=function(e,t){var i=this.getInfoWithPath(e,t);return i&&Ct.get(i.uuid)||null},t.release=function(e,t){var i=this.get(e,t);i&&Mn.tryRelease(i,!0)},t.releaseUnusedAssets=function(){var e=this;Ct.forEach((function(t){var i=e.getAssetInfo(t._uuid);i&&!i.redirect&&Mn.tryRelease(t)}))},t.releaseAll=function(){var e=this;Ct.forEach((function(t){var i=e.getAssetInfo(t._uuid);i&&!i.redirect&&Mn.tryRelease(t,!0)}))},t._destroy=function(){this._config.destroy()},ke(e,[{key:"config",get:function(){return this._config}},{key:"name",get:function(){return this._config.name}},{key:"deps",get:function(){return this._config.deps}},{key:"base",get:function(){return this._config.base}}]),e}(),Xn=e("r",new Yn);function $n(e,t,i){var n=new Image;function r(){n.removeEventListener("load",r),n.removeEventListener("error",s),i&&i(null,n)}function s(){n.removeEventListener("load",r),n.removeEventListener("error",s),i&&i(new Error(vt(4930,e)))}return"file:"!==window.location.protocol&&(n.crossOrigin="anonymous"),n.addEventListener("load",r),n.addEventListener("error",s),n.src=e,n}function Jn(e,t,i,n){var r=new XMLHttpRequest,s="download failed: "+e+", status: ";if(r.open("GET",e,!0),void 0!==t.xhrResponseType&&(r.responseType=t.xhrResponseType),void 0!==t.xhrWithCredentials&&(r.withCredentials=t.xhrWithCredentials),void 0!==t.xhrMimeType&&r.overrideMimeType&&r.overrideMimeType(t.xhrMimeType),void 0!==t.xhrTimeout&&(r.timeout=t.xhrTimeout),t.xhrHeader)for(var a in t.xhrHeader)r.setRequestHeader(a,t.xhrHeader[a]);return r.onload=function(){200===r.status||0===r.status?n&&n(null,r.response):n&&n(new Error(""+s+r.status+"(no response)"))},i&&(r.onprogress=function(e){e.lengthComputable&&i(e.loaded,e.total)}),r.onerror=function(){n&&n(new Error(""+s+r.status+"(error)"))},r.ontimeout=function(){n&&n(new Error(""+s+r.status+"(time out)"))},r.onabort=function(){n&&n(new Error(""+s+r.status+"(abort)"))},r.send(null),r}fe.resources=Xn;var Qn={};function Kn(e,t,i){if(Qn[e])return i&&i(null),null;var n=document.createElement("script");function r(){n.parentNode.removeChild(n),n.removeEventListener("load",r,!1),n.removeEventListener("error",s,!1),Qn[e]=!0,i&&i(null)}function s(){n.parentNode.removeChild(n),n.removeEventListener("load",r,!1),n.removeEventListener("error",s,!1),i&&i(new Error(vt(4928,e)))}return"file:"!==window.location.protocol&&(n.crossOrigin="anonymous"),n.async=t.scriptAsyncLoading||!1,n.src=e,n.addEventListener("load",r,!1),n.addEventListener("error",s,!1),document.body.appendChild(n),n}var Zn=/^(?:\w+:\/\/|\.+\/).+/,er=function(e,t,i){(Wt.capabilities.imageBitmap&&fe.assetManager.allowImageBitmap?tr:$n)(e,t,i)},tr=function(e,t,i){t.xhrResponseType="blob",Jn(e,t,t.onFileProgress,i)},ir=function(e,t,i){t.xhrResponseType="json",Jn(e,t,t.onFileProgress,i)},nr=function(e,t,i){t.xhrResponseType="arraybuffer",Jn(e,t,t.onFileProgress,i)},rr=function(e,t,i){t.xhrResponseType="text",Jn(e,t,t.onFileProgress,i)},sr=function(e,t,i){var n=Vt(e),r=e;Zn.test(r)||(r=-1!==or.remoteBundles.indexOf(n)?or.remoteServerAddress+"remote/"+n:"assets/"+n);var s=t.version||or.bundleVers[n],a=0,o=null,u=null;ir(r+"/config."+(s?s+".":"")+"json",t,(function(e,t){u=e,(o=t)&&(o.base=r+"/"),2==++a&&i(u,o)})),Kn(r+"/index."+(s?s+".":"")+"js",t,(function(e){u=e,2==++a&&i(e,o)}))},ar=function(){function e(){this.maxConcurrency=6,this.maxRequestsPerFrame=6,this.maxRetryCount=3,this.appendTimeStamp=!!Ht,this.limited=!Ht,this.retryInterval=2e3,this.bundleVers=null,this.remoteBundles=[],this.downloadDomImage=$n,this.downloadDomAudio=null,this.downloadFile=Jn,this.downloadScript=Kn,this._downloaders={".png":er,".jpg":er,".bmp":er,".jpeg":er,".gif":er,".ico":er,".tiff":er,".webp":er,".image":er,".pvr":nr,".pkm":nr,".astc":nr,".txt":rr,".xml":rr,".vsh":rr,".fsh":rr,".atlas":rr,".tmx":rr,".tsx":rr,".json":ir,".ExportJson":ir,".plist":rr,".fnt":rr,".binary":nr,".bin":nr,".dbbin":nr,".skel":nr,".js":Kn,bundle:sr,default:rr},this._downloading=new Nt,this._queue=[],this._queueDirty=!1,this._totalNum=0,this._totalNumThisPeriod=0,this._lastDate=-1,this._checkNextPeriod=!1,this._remoteServerAddress="",this._maxInterval=1/30}var t=e.prototype;return t.init=function(e,t,i){void 0===e&&(e=""),void 0===t&&(t={}),void 0===i&&(i=[]),this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=e,this.bundleVers=t,this.remoteBundles=i},t.register=function(e,t){"object"==typeof e?Ot(this._downloaders,e):this._downloaders[e]=t},t.download=function(e,t,i,n,r){var s=this,a=Ut.get(e);if(a)r(null,a);else{var o=this._downloading.get(e);if(o){o.push(r);var u=this._queue.find((function(t){return t.id===e}));if(!u)return;var l=n.priority||0;u.priority<l&&(u.priority=l,this._queueDirty=!0)}else{var c=void 0!==n.maxRetryCount?n.maxRetryCount:this.maxRetryCount,h=void 0!==n.maxConcurrency?n.maxConcurrency:this.maxConcurrency,d=void 0!==n.maxRequestsPerFrame?n.maxRequestsPerFrame:this.maxRequestsPerFrame,f=this._downloaders[i]||this._downloaders.default;Un((function(i,a){if(0===i&&s._downloading.add(e,[r]),s.limited){s._updateTime();var o=function(e,t){s._totalNum--,s._handleQueueInNextFrame(h,d),a(e,t)};s._totalNum<h&&s._totalNumThisPeriod<d?(f(On(t,s.appendTimeStamp),n,o),s._totalNum++,s._totalNumThisPeriod++):(s._queue.push({id:e,priority:n.priority||0,url:t,options:n,done:o,handler:f}),s._queueDirty=!0,s._totalNum<h&&s._handleQueueInNextFrame(h,d))}else f(On(t,s.appendTimeStamp),n,a)}),c,this.retryInterval,(function(t,i){t||Ut.add(e,i);for(var n=s._downloading.remove(e),r=0,a=n.length;r<a;r++)n[r](t,i)}))}}},t.loadSubpackage=function(e,t){fe.assetManager.loadBundle(e,null,t)},t._updateTime=function(){var e=Date.now(),t=fe.director.getDeltaTime(),i=t>this._maxInterval?this._maxInterval:t;e-this._lastDate>1e3*i&&(this._totalNumThisPeriod=0,this._lastDate=e)},t._handleQueue=function(e,t){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<e&&this._totalNumThisPeriod<t;){this._queueDirty&&(this._queue.sort((function(e,t){return e.priority-t.priority})),this._queueDirty=!1);var i=this._queue.pop();if(!i)break;this._totalNum++,this._totalNumThisPeriod++,i.handler(On(i.url,this.appendTimeStamp),i.options,i.done)}this._handleQueueInNextFrame(e,t)},t._handleQueueInNextFrame=function(e,t){!this._checkNextPeriod&&this._queue.length>0&&(kt(this._handleQueue.bind(this),e,t),this._checkNextPeriod=!0)},ke(e,[{key:"remoteServerAddress",get:function(){return this._remoteServerAddress}}]),e}(),or=e("y",new ar);function ur(e,t,i,n){var r=null,s=null;try{(r=new jt)._nativeUrl=e,r._nativeAsset=t}catch(e){s=e}n(s,r)}function lr(e,t,i,n){var r=new Zi;r.json=t,n(null,r)}function cr(e,t,i,n){var r=new en;r.text=t,n(null,r)}function hr(e,t,i,n){var r=new tn;r._nativeUrl=e,r._nativeAsset=t,n(null,r)}function dr(e,t,i,n){var r=new Pt;r._nativeUrl=e,r._nativeAsset=t,n(null,r)}function fr(e,i,n,r){var s=Bt.get(i.name);s||(s=i.name===zt.RESOURCES?Xn:new Yn,i.base=i.base||e+"/",s.init(i)),t.import("virtual:///prerequisite-imports/"+s.name).then((function(){r(null,s)})).catch(r)}var pr=function(){function e(){this._creating=new Nt,this._producers={".png":ur,".jpg":ur,".bmp":ur,".jpeg":ur,".gif":ur,".ico":ur,".tiff":ur,".webp":ur,".image":ur,".pvr":ur,".pkm":ur,".txt":cr,".xml":cr,".vsh":cr,".fsh":cr,".atlas":cr,".tmx":cr,".tsx":cr,".fnt":cr,".json":lr,".ExportJson":lr,".binary":hr,".bin":hr,".dbbin":hr,".skel":hr,bundle:fr,default:dr}}var t=e.prototype;return t.register=function(e,t){"object"==typeof e?yt.mixin(this._producers,e):this._producers[e]=t},t.create=function(e,t,i,n,r){var s=this,a=this._producers[i]||this._producers.default,o=Ct.get(e);if(n.reloadAsset||!o){var u=this._creating.get(e);u?u.push(r):(this._creating.add(e,[r]),a(e,t,n,(function(t,i){!t&&i instanceof Pt&&(i._uuid=e,Wn(e,i,n.cacheAsset));for(var r=s._creating.remove(e),a=0,o=r.length;a<o;a++)r[a](t,i)})))}else r(null,o)},e}(),_r=e("z",new pr),gr=new(function(){function e(){this._loading=new Nt,this._unpackers={".json":this.unpackJson}}var t=e.prototype;return t.unpackJson=function(e,t,i,n){var r=yt.createMap(!0),s=null;if(Array.isArray(t)){(t=qt(t)).length!==e.length&&Le(4915);for(var a=0;a<e.length;a++)r[e[a]+"@import"]=t[a]}else{var o=yt._getClassId(Gt),u=yt._getClassId(jt);if(t.type===o&&t.data){var l=t.data;l.length!==e.length&&Le(4915);for(var c=0;c<e.length;c++)r[e[c]+"@import"]=Yt(o,{base:l[c][0],mipmaps:l[c][1]})}else if(t.type===u&&t.data){var h=t.data;h.length!==e.length&&Le(4915);for(var d=0;d<e.length;d++)r[e[d]+"@import"]=h[d]}else s=new Error("unmatched type pack!"),r=null}n(s,r)},t.init=function(){this._loading.clear()},t.register=function(e,t){"object"==typeof e?yt.mixin(this._unpackers,e):this._unpackers[e]=t},t.unpack=function(e,t,i,n,r){t?(0,this._unpackers[i])(e,t,n,r):r(new Error("package data is wrong!"))},t.load=function(e,t,i){var n=this;if(!e.isNative&&e.info&&e.info.packs)if(Ut.has(e.id))i(null,Ut.get(e.id));else{var r=e.info.packs,s=r.find((function(e){return n._loading.has(e.uuid)}));if(s)this._loading.get(s.uuid).push({onComplete:i,id:e.id});else{s=r[0],this._loading.add(s.uuid,[{onComplete:i,id:e.id}]);var a=Xt(s.uuid,{ext:s.ext,bundle:e.config.name});or.download(s.uuid,a,s.ext,e.options,(function(t,i){Ut.remove(s.uuid),t&&he(t.message,t.stack),n.unpack(s.packedUuids,i,s.ext,e.options,(function(e,i){if(!e)for(var r in i)Ut.add(r,i[r]);for(var a=n._loading.remove(s.uuid),o=0,u=a.length;o<u;o++){var l=a[o];if(t||e)l.onComplete(t||e);else{var c=i[l.id];c?l.onComplete(null,c):l.onComplete(new Error("can not retrieve data from package"))}}}))}))}}else or.download(e.id,e.url,e.ext,e.options,i)},e}());function mr(e,t){var i=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},i=!0);var n=e.options,r=e.progress,s=[],a=r.total,o=n.__exclude__=n.__exclude__||Object.create(null);e.output=[],Vn(e.input,(function(n,u){if(!n.isNative&&Ct.has(n.uuid)){var l=Ct.get(n.uuid);return n.content=l.addRef(),e.output.push(n),r.canInvoke&&e.dispatch("progress",++r.finish,r.total,n),void u()}gr.load(n,e.options,(function(l,c){l?e.isFinish||(!fe.assetManager.force||i?(he(l.message,l.stack),r.canInvoke=!1,t(l)):(e.output.push(n),r.canInvoke&&e.dispatch("progress",++r.finish,r.total,n))):e.isFinish||(n.file=c,e.output.push(n),n.isNative||(o[n.uuid]=!0,Hn(n.uuid,c,o,s,n.config),r.total=a+s.length),r.canInvoke&&e.dispatch("progress",++r.finish,r.total,n)),u()}))}),(function(){if(e.isFinish)return Ln(e,!0),void e.dispatch("error");if(s.length>0){var a=$t.create({input:s,progress:r,options:n,onProgress:e.onProgress,onError:$t.prototype.recycle,onComplete:function(n){var r;n||((r=e.output).push.apply(r,a.output),a.recycle()),i&&vr(e),t(n)}});Jt.async(a)}else i&&vr(e),t()}))}function vr(e){for(var t=e.output,i=0,n=t.length;i<n;i++)t[i].content&&t[i].content.decRef(!1)}var yr=new(function(e){function t(){return e.apply(this,arguments)||this}Me(t,e);var i=t.prototype;return i.parse=function(e){var t=this._parseXML(e).documentElement;if("plist"!==t.tagName)return Oe(5100),{};for(var i=null,n=0,r=t.childNodes.length;n<r&&1!==(i=t.childNodes[n]).nodeType;n++);return this._parseNode(i)},i._parseNode=function(e){var t=null,i=e.tagName;if("dict"===i)t=this._parseDict(e);else if("array"===i)t=this._parseArray(e);else if("string"===i)if(1===e.childNodes.length)t=e.firstChild.nodeValue;else{t="";for(var n=0;n<e.childNodes.length;n++)t+=e.childNodes[n].nodeValue}else"false"===i?t=!1:"true"===i?t=!0:"real"===i?t=parseFloat(e.firstChild.nodeValue):"integer"===i&&(t=parseInt(e.firstChild.nodeValue,10));return t},i._parseArray=function(e){for(var t=[],i=0,n=e.childNodes.length;i<n;i++){var r=e.childNodes[i];1===r.nodeType&&t.push(this._parseNode(r))}return t},i._parseDict=function(e){for(var t={},i="",n=0,r=e.childNodes.length;n<r;n++){var s=e.childNodes[n];1===s.nodeType&&("key"===s.tagName?i=s.firstChild.nodeValue:t[i]=this._parseNode(s))}return t},t}(e("B",function(){function e(){this._parser=null,window.DOMParser&&(this._parser=new DOMParser)}var t=e.prototype;return t.parse=function(e){return this._parseXML(e)},t._parseXML=function(e){if(this._parser)return this._parser.parseFromString(e,"text/xml");throw new Error("Dom parser is not supported in this platform!")},e}())));function wr(e,t){return e[t]<<8|e[t+1]}var Tr=new(function(){function e(){this._parsing=new Nt,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".mp3":this.parseAudio,".ogg":this.parseAudio,".wav":this.parseAudio,".m4a":this.parseAudio,".plist":this.parsePlist,import:this.parseImport}}var t=e.prototype;return t.parseImage=function(e,t,i){e instanceof HTMLImageElement?i(null,e):createImageBitmap(e,{premultiplyAlpha:"none"}).then((function(e){i(null,e)}),(function(e){i(e,null)}))},t.parseAudio=function(e,t,i){e instanceof ArrayBuffer?Wt.__audioSupport.context.decodeAudioData(e,(function(e){i(null,e)}),(function(e){i(new Error("Error with decoding audio data"+e.err),null)})):i(null,e)},t.parsePVRTex=function(e,t,i){var n=null,r=null;try{var s=e instanceof ArrayBuffer?e:e.buffer,a=new Int32Array(s,0,13);if(55727696===a[0]){var o=a[7],u=a[6],l=a[12]+52;r={_data:new Uint8Array(s,l),_compressed:!0,width:o,height:u,format:0}}else{if(559044176!==a[11])throw new Error("Invalid magic number in PVR header");var c=a[0],h=a[1],d=a[2];r={_data:new Uint8Array(s,c),_compressed:!0,width:d,height:h,format:0}}}catch(e){n=e}i(n,r)},t.parsePKMTex=function(e,t,i){var n=null,r=null;try{var s=e instanceof ArrayBuffer?e:e.buffer,a=new Uint8Array(s),o=wr(a,6);if(0!==o&&1!==o&&3!==o)throw new Error("Invalid magic number in ETC header");var u=wr(a,12),l=wr(a,14);wr(a,8),wr(a,10),r={_data:new Uint8Array(s,16),_compressed:!0,width:u,height:l,format:0}}catch(e){n=e}i(n,r)},t.parseASTCTex=function(e,t,i){var n=null,r=null;try{var s=e instanceof ArrayBuffer?e:e.buffer,a=new Uint8Array(s);if(1554098963!==a[0]+(a[1]<<8)+(a[2]<<16)+(a[3]<<24))throw new Error("Invalid magic number in ASTC header");var o=a[4],u=a[5],l=a[6];if((o<3||o>6||u<3||u>6||l<3||l>6)&&(o<4||7===o||9===o||11===o||o>12||u<4||7===u||9===u||11===u||u>12||1!==l))throw new Error("Invalid block number in ASTC header");var c=function(e,t){return 4===e?Zt.RGBA_ASTC_4x4:5===e?4===t?Zt.RGBA_ASTC_5x4:Zt.RGBA_ASTC_5x5:6===e?5===t?Zt.RGBA_ASTC_6x5:Zt.RGBA_ASTC_6x6:8===e?5===t?Zt.RGBA_ASTC_8x5:6===t?Zt.RGBA_ASTC_8x6:Zt.RGBA_ASTC_8x8:10===e?5===t?Zt.RGBA_ASTC_10x5:6===t?Zt.RGBA_ASTC_10x6:8===t?Zt.RGBA_ASTC_10x8:Zt.RGBA_ASTC_10x10:10===t?Zt.RGBA_ASTC_12x10:Zt.RGBA_ASTC_12x12}(o,u),h=a[7]+(a[8]<<8)+(a[9]<<16),d=a[10]+(a[11]<<8)+(a[12]<<16);a[13],a[14],a[15],r={_data:new Uint8Array(s,16),_compressed:!0,width:h,height:d,format:c}}catch(e){n=e}i(n,r)},t.parsePlist=function(e,t,i){var n=null,r=yr.parse(e);r||(n=new Error("parse failed")),i(n,r)},t.parseImport=function(e,t,i){if(e){var n=null,r=null;try{n=Qt(e,t)}catch(e){r=e}i(r,n)}else i(new Error("The json file of asset "+t.__uuid__+" is empty or missing"))},t.init=function(){this._parsing.clear()},t.register=function(e,t){"object"==typeof e?Ot(this._parsers,e):this._parsers[e]=t},t.parse=function(e,t,i,n,r){var s=this,a=Kt.get(e);if(a)r(null,a);else{var o=this._parsing.get(e);if(o)o.push(r);else{var u=this._parsers[i];u?(this._parsing.add(e,[r]),u(t,n,(function(t,i){t?Ut.remove(e):Mt(i)||Kt.add(e,i);for(var n=s._parsing.remove(e),r=0,a=n.length;r<a;r++)n[r](t,i)}))):r(null,t)}}},e}());function br(e,t){var i=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},i=!0);var n=e.options,r=e.progress;n.__exclude__=n.__exclude__||Object.create(null),e.output=[],Vn(e.input,(function(s,a){var o=$t.create({input:s,onProgress:e.onProgress,options:n,progress:r,onComplete:function(n,u){n&&!e.isFinish&&(!fe.assetManager.force||i?(he(n.message,n.stack),r.canInvoke=!1,t(n)):r.canInvoke&&e.dispatch("progress",++r.finish,r.total,s)),e.output.push(u),o.recycle(),a(null)}});Ar.async(o)}),(function(){if(n.__exclude__=null,e.isFinish)return Ln(e,!0),void e.dispatch("error");!function(e){var t=e.source;if(e.options.__outputAsArray__||1!==t.length)for(var i=e.output=[],n=0,r=t.length;n<r;n++)i.push(t[n].content);else e.output=t[0].content}(e),Ln(e,!0),t()}))}var Ar=new ei("loadOneAsset",[function(e,t){var i=e.output=e.input,n=i.options,r=i.isNative,s=i.uuid,a=i.file,o=n.reloadAsset;a||!o&&!r&&Ct.has(s)?t():gr.load(i,e.options,(function(e,n){i.file=n,t(e)}))},function(e,t){var i=e.output=e.input,n=e.progress,r=e.options.__exclude__,s=i.id,a=i.file,o=i.options;if(i.isNative)Tr.parse(s,a,i.ext,o,(function(r,a){r?t(r):(i.content=a,n.canInvoke&&e.dispatch("progress",++n.finish,n.total,i),Ut.remove(s),Kt.remove(s),t())}));else{var u=i.uuid;if(u in r){var l=r[u],c=l.finish,h=l.content,d=l.err,f=l.callbacks;n.canInvoke&&e.dispatch("progress",++n.finish,n.total,i),c||qn(u,u,r)?(h&&h.addRef(),i.content=h,t(d)):f.push({done:t,item:i})}else if(!o.reloadAsset&&Ct.has(u)){var p=Ct.get(u);i.content=p.addRef(),n.canInvoke&&e.dispatch("progress",++n.finish,n.total,i),t()}else o.__uuid__=u,Tr.parse(s,a,"import",o,(function(i,n){i?t(i):function(e,t,i){var n=e.input,r=e.progress,s=n,a=s.uuid,o=s.id,u=s.options,l=s.config,c=u.cacheAsset,h=[];t.addRef&&t.addRef(),Hn(a,t,Object.create(null),h,l),r.canInvoke&&e.dispatch("progress",++r.finish,r.total+=h.length,n);var d=e.options.__exclude__[a]={content:t,finish:!1,callbacks:[{done:i,item:n}]},f=$t.create({input:h,options:e.options,onProgress:e.onProgress,onError:$t.prototype.recycle,progress:r,onComplete:function(e){if(t.decRef&&t.decRef(!1),d.finish=!0,d.err=e,!e){for(var i,n=Array.isArray(f.output)?f.output:[f.output],r=Object.create(null),s=Ye(n);!(i=s()).done;){var u=i.value;u&&(r[u instanceof Pt?u._uuid+"@import":a+"@native"]=u)}!function(e,t,i){var n=t.__depends__;if(n){for(var r=0,s=n.length;r<s;r++){var a=n[r],o=i[a.uuid+"@import"];if(o)a.owner[a.prop]=o.addRef();else{if(he("The asset "+a.uuid+" is missing!"),a.type&&a.type!==Pt){var u=new a.type;u.initDefault(a.uuid),a.owner[a.prop]=u}!0}}t.__depends__=null}t.__nativeDepend__&&(i[e+"@native"]?t._nativeAsset=i[e+"@native"]:(!0,console.error("the native asset of "+e+" is missing!")),t.__nativeDepend__=!1)}(a,t,r);try{"function"!=typeof t.onLoaded||t.__onLoadedInvoked__||t.__nativeDepend__||(t.onLoaded(),t.__onLoadedInvoked__=!0)}catch(e){he("The asset "+a+" is invalid for some reason, detail message: "+e.message+", stack: "+e.stack)}Ut.remove(o),Kt.remove(o),Wn(a,t,c),f.recycle()}for(var l=d.callbacks,h=0,p=l.length;h<p;h++){var _=l[h];t.addRef&&t.addRef(),_.item.content=t,_.done(e)}l.length=0}});ti.async(f)}(e,n,t)}))}}]);function Er(e,t){var i=e.options,n=Object.create(null),r=Object.create(null);for(var s in i)switch(s){case Lt.PATH:case Lt.UUID:case Lt.DIR:case Lt.SCENE:case Lt.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":n[s]=i[s];break;case"__exclude__":case"__outputAsArray__":r[s]=i[s];break;default:n[s]=i[s],r[s]=i[s]}e.options=r;var a=$t.create({input:e.input,options:n}),o=null;try{e.output=e.source=ii.sync(a)}catch(e){o=e;for(var u=0,l=a.output.length;u<l;u++)a.output[u].recycle()}a.recycle(),t(o)}var Sr=function(){function e(){this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}return e.create=function(){return 0!==e._deadPool.length?e._deadPool.pop():new e},e.prototype.recycle=function(){e._deadPool.length!==e.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),e._deadPool.push(this))},ke(e,[{key:"id",get:function(){return this._id||(this._id=this.uuid+"@"+(this.isNative?"native":"import")),this._id}}]),e}();Sr.MAX_DEAD_NUM=500,Sr._deadPool=[];var Nr=[];function Ir(e){var t=e.options,i=Array.isArray(e.input)?e.input:[e.input];e.output=[];for(var n=function(n){var r=i[n],s=Sr.create(),a=null,o=null;if("string"==typeof r&&((r=Object.create(null))[t.__requestType__||Lt.UUID]=i[n]),"object"==typeof r)for(var u in ni(r,t),r.preset&&ni(r,ri[r.preset]),r){switch(u){case Lt.UUID:if("break"===function(){var e=s.uuid=Rt(r.uuid);if(!r.bundle){var t=Bt.find((function(t){return!!t.getAssetInfo(e)}));r.bundle=t&&t.name}if(Bt.has(r.bundle)){if(a=Bt.get(r.bundle).config,(o=a.getAssetInfo(e))&&o.redirect){if(!Bt.has(o.redirect))throw new Error("Please load bundle "+o.redirect+" first");a=Bt.get(o.redirect).config,o=a.getAssetInfo(e)}s.config=a,s.info=o}return s.ext=r.ext||".json","break"}())break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case Lt.DIR:if(Bt.has(r.bundle)){Bt.get(r.bundle).config.getDirWithPath(r.dir,r.type,Nr);for(var l,c=Ye(Nr);!(l=c()).done;){var h=l.value;i.push({uuid:h.uuid,__isNative__:!1,ext:".json",bundle:r.bundle})}Nr.length=0}s.recycle(),s=null;break;case Lt.PATH:if(Bt.has(r.bundle)){if(a=Bt.get(r.bundle).config,(o=a.getInfoWithPath(r.path,r.type))&&o.redirect){if(!Bt.has(o.redirect))throw new Error("you need to load bundle "+o.redirect+" first");a=Bt.get(o.redirect).config,o=a.getAssetInfo(o.uuid)}if(!o)throw s.recycle(),new Error("Bundle "+r.bundle+" doesn't contain "+r.path);s.config=a,s.uuid=o.uuid,s.info=o}s.ext=r.ext||".json";break;case Lt.SCENE:if(!r.bundle){var d=Bt.find((function(e){return!!e.getSceneInfo(r.scene)}));r.bundle=d&&d.name}if(Bt.has(r.bundle)){if(a=Bt.get(r.bundle).config,(o=a.getSceneInfo(r.scene))&&o.redirect){if(!Bt.has(o.redirect))throw new Error("you need to load bundle "+o.redirect+" first");a=Bt.get(o.redirect).config,o=a.getAssetInfo(o.uuid)}if(!o)throw s.recycle(),new Error("Bundle "+a.name+" doesn't contain scene "+r.scene);s.config=a,s.uuid=o.uuid,s.info=o}break;case"__isNative__":s.isNative=r.__isNative__;break;case Lt.URL:s.url=r.url,s.uuid=r.uuid||r.url,s.ext=r.ext||si(r.url),s.isNative=void 0===r.__isNative__||r.__isNative__;break;default:s.options[u]=r[u]}if(!s)break}if(!s)return"continue";if(e.output.push(s),!s.uuid&&!s.url)throw new Error("Can not parse this input:"+JSON.stringify(r))},r=0;r<i.length;r++)n(r);return null}function Rr(e){for(var t=e.output=e.input,i=0;i<t.length;i++){var n=t[i];if(!n.url){var r,s,a=n.config;s=n.isNative?a&&a.nativeBase?a.base+a.nativeBase:fe.assetManager.generalNativeBase:a&&a.importBase?a.base+a.importBase:fe.assetManager.generalImportBase;var o=n.uuid,u="";n.info&&(u=n.isNative?n.info.nativeVer?"."+n.info.nativeVer:"":n.info.ver?"."+n.info.ver:""),r=".ttf"===n.ext?s+"/"+o.slice(0,2)+"/"+o+u+"/"+n.options.__nativeName__:s+"/"+o.slice(0,2)+"/"+o+u+n.ext,n.url=r}}return null}var Cr=e("A",function(){function e(){this.pipeline=ti.append(Er).append(br),this.fetchPipeline=Jt.append(Er).append(mr),this.transformPipeline=ii.append(Ir).append(Rr),this.bundles=Bt,this.assets=Ct,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=xt,this.force=ai,this.allowImageBitmap=!Wt.isMobile,this.utils=oi,this.downloader=or,this.parser=Tr,this.packManager=gr,this.cacheAsset=!0,this.cacheManager=null,this.presets=ri,this.factory=_r,this.preprocessPipe=Er,this.fetchPipe=mr,this.loadPipe=br,this.references=ui,this._releaseManager=Mn,this._files=Ut,this._parsed=Kt,this._parsePipeline=null}var t=e.prototype;return t.init=function(e){void 0===e&&(e={}),this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(e.server,e.bundleVers,e.remoteBundles),this.parser.init(),this.dependUtil.init();var t=e.importBase||"";t&&t.endsWith("/")&&(t=t.substr(0,t.length-1));var i=e.nativeBase||"";i&&i.endsWith("/")&&(i=i.substr(0,i.length-1)),this.generalImportBase=t,this.generalNativeBase=i},t.getBundle=function(e){return Bt.get(e)||null},t.removeBundle=function(e){e._destroy(),Bt.remove(e.name)},t.loadAny=function(e,t,i,n){var r=jn(t,i,n),s=r.options,a=r.onProgress,o=r.onComplete;s.preset=s.preset||"default",e=Array.isArray(e)?e.slice():e;var u=$t.create({input:e,onProgress:a,onComplete:Gn(o),options:s});ti.async(u)},t.preloadAny=function(e,t,i,n){var r=jn(t,i,n),s=r.options,a=r.onProgress,o=r.onComplete;s.preset=s.preset||"preload",e=Array.isArray(e)?e.slice():e;var u=$t.create({input:e,onProgress:a,onComplete:Gn(o),options:s});Jt.async(u)},t.postLoadNative=function(e,t,i){var n=jn(t,void 0,i),r=n.options,s=n.onComplete;if(e._native&&e.__nativeDepend__){var a=xt.getNativeDep(e._uuid);if(a){if(!Bt.has(a.bundle)){var o=Bt.find((function(t){return!!t.getAssetInfo(e._uuid)}));o&&(a.bundle=o.name)}this.loadAny(a,r,(function(t,i){t?he(t.message,t.stack):e.isValid&&e.__nativeDepend__&&(e._nativeAsset=i,e.__nativeDepend__=!1),s&&s(t)}))}}else Gn(s)(null)},t.loadRemote=function(e,t,i){var n=jn(t,void 0,i),r=n.options,s=n.onComplete;r.reloadAsset||!this.assets.has(e)?(r.__isNative__=!0,r.preset=r.preset||"remote",this.loadAny({url:e},r,null,(function(t,i){t?(he(t.message,t.stack),s&&s(t,i)):_r.create(e,i,r.ext||si(e),r,(function(e,t){s&&s(e,t)}))}))):Gn(s)(null,this.assets.get(e))},t.loadBundle=function(e,t,i){var n=jn(t,void 0,i),r=n.options,s=n.onComplete,a=Vt(e);this.bundles.has(a)?Gn(s)(null,this.getBundle(a)):(r.preset=r.preset||"bundle",r.ext="bundle",r.__isNative__=!0,this.loadAny({url:e},r,null,(function(t,i){t?(he(t.message,t.stack),s&&s(t,i)):_r.create(e,i,"bundle",r,(function(e,t){s&&s(e,t)}))})))},t.releaseAsset=function(e){Mn.tryRelease(e,!0)},t.releaseUnusedAssets=function(){Ct.forEach((function(e){Mn.tryRelease(e)}))},t.releaseAll=function(){Ct.forEach((function(e){Mn.tryRelease(e,!0)}))},t.loadWithJson=function(){throw new Error("Only valid in Editor")},ke(e,[{key:"main",get:function(){return Bt.get(zt.MAIN)||null}},{key:"resources",get:function(){return Bt.get(zt.RESOURCES)||null}}]),e}());Cr.Pipeline=ei,Cr.Task=$t,Cr.Cache=Nt,Cr.RequestItem=Sr,Cr.Bundle=Yn,Cr.BuiltinBundleName=zt;var xr=e("j",fe.assetManager=new Cr);fe.AssetManager=Cr;var Pr=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm",".astc"],kr=[".mp3",".ogg",".wav",".m4a"];function Dr(){return!0}var Fr={transformURL:function(e){var t=hi(e);if(!t)return e;var i=Bt.find((function(e){return!!e.getAssetInfo(t)}));if(!i)return e;var n,r=i.getAssetInfo(t);if(!(n=e.startsWith(i.base+i.config.nativeBase)?r.nativeVer||"":r.ver||"")||-1!==e.indexOf(n))return e;var s=!1;if(".ttf"===si(e)&&(s=!0),s){var a=di(e),o=Vt(e);e=a+"."+n+"/"+o}else e=e.replace(/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/,(function(e){return e+"."+n}));return e}},Mr=e("k",function(){function e(){this._autoReleaseSetting=Object.create(null),this._parseLoadResArgs=zn}var t=e.prototype;return t.load=function(e,t,i){void 0===i&&void 0!==t&&(i=t,t=null);for(var n=Array.isArray(e)?e:[e],r=0;r<n.length;r++){var s=n[r];"string"==typeof s?n[r]={url:s,__isNative__:!0}:(s.type&&(s.ext="."+s.type,s.type=void 0),s.url&&(s.__isNative__=!0))}var a=[],o=[];xr.loadAny(n,null,(function(e,i,n){n.content&&(Pr.includes(n.ext)?a.push(n.content):kr.includes(n.ext)&&o.push(n.content)),t&&t(e,i,n)}),(function(e,t){var r=null;if(!e){t=Array.isArray(t)?t:[t];for(var s=function(e){var i=t[e];if(!(i instanceof Pt)){var r=i,s=n[e].url;a.includes(r)?_r.create(s,i,".png",{},(function(i,n){r=t[e]=n})):o.includes(r)&&_r.create(s,i,".mp3",{},(function(i,n){r=t[e]=n})),Ct.add(s,r)}},u=0;u<t.length;u++)s(u);if(t.length>1){var l=Object.create(null);t.forEach((function(e){l[e._uuid]=e})),r={isCompleted:Dr,_map:l}}else r=t[0]}i&&i(e,r)}))},t.getXMLHttpRequest=function(){return new XMLHttpRequest},t.getItem=function(e){return xr.assets.has(e)?{content:xr.assets.get(e)}:null},t.loadRes=function(e,t,i,n){var r=this._parseLoadResArgs(t,i,n),s=r.type,a=r.onProgress,o=r.onComplete,u=si(e);u&&!Xn.getInfoWithPath(e,s)&&(e=e.slice(0,-u.length)),Xn.load(e,s,a,o)},t.loadResArray=function(e,t,i,n){var r=this._parseLoadResArgs(t,i,n),s=r.type,a=r.onProgress,o=r.onComplete;e.forEach((function(t,i){var n=si(t);n&&!Xn.getInfoWithPath(t,s)&&(e[i]=t.slice(0,-n.length))})),Xn.load(e,s,a,o)},t.loadResDir=function(e,t,i,n){var r=this._parseLoadResArgs(t,i,n),s=r.type,a=r.onProgress,o=r.onComplete;Xn.loadDir(e,s,a,(function(t,i){var n=[];t||(n=Xn.getDirWithPath(e,s).map((function(e){return e.path}))),o&&o(t,i,n)}))},t.getRes=function(e,t){return Ct.has(e)?Ct.get(e):Xn.get(e,t)},t.getResCount=function(){return Ct.count},t.getDependsRecursively=function(e){if(!e)return[];var t="string"==typeof e?e:e._uuid;return xt.getDepsRecursively(t).concat([t])},t.addDownloadHandlers=function(e){var t=Object.create(null),i=function(i){var n=e[i];t["."+i]=function(e,t,i){n({url:e},i)}};for(var n in e)i(n);or.register(t)},t.addLoadHandlers=function(e){var t=Object.create(null),i=function(i){var n=e[i];t["."+i]=function(e,t,i){n({content:e},i)}};for(var n in e)i(n);Tr.register(t)},t.release=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var i=e[t];"string"==typeof i&&(i=Ct.get(i)),xr.releaseAsset(i)}else e&&("string"==typeof e&&(e=Ct.get(e)),xr.releaseAsset(e))},t.releaseAsset=function(e){xr.releaseAsset(e)},t.releaseRes=function(e,t){Xn.release(e,t)},t.releaseAll=function(){xr.releaseAll(),Ct.clear()},t.removeItem=function(e){return!!Ct.remove(e)},t.setAutoRelease=function(e,t){"object"==typeof e&&(e=e._uuid),this._autoReleaseSetting[e]=!!t},t.setAutoReleaseRecursively=function(e,t){"object"==typeof e&&(e=e._uuid),t=!!t,this._autoReleaseSetting[e]=t;for(var i=xt.getDepsRecursively(e),n=0;n<i.length;n++)this._autoReleaseSetting[i[n]]=t},t.isAutoRelease=function(e){return"object"==typeof e&&(e=e._uuid),!!this._autoReleaseSetting[e]},ke(e,[{key:"onProgress",set:function(e){Bn=e}},{key:"_cache",get:function(){return Ct._map}},{key:"md5Pipe",get:function(){return Fr}},{key:"downloader",get:function(){return or}},{key:"loader",get:function(){return xr.parser}}]),e}()),Br=e("l",new Mr),Lr=e("n",{init:function(e){e.importBase=e.libraryPath,e.nativeBase=e.rawAssetsBase,xr.init(e),e.rawAssets&&Xn.init({base:"",deps:[],scenes:{},redirect:[],debug:!0,packs:{},types:[],versions:{import:[],native:[]},name:zt.RESOURCES,importBase:e.importBase,nativeBase:e.nativeBase,paths:e.rawAssets.assets,uuids:Object.keys(e.rawAssets.assets)})},loadAsset:function(e,t){xr.loadAny(e,t)}}),Or=e("u",{});it(Or,"url",[{name:"normalize",target:xr.utils,targetName:"assetManager.utils",newName:"normalize"},{name:"raw",targetName:"Asset.prototype",newName:"nativeUrl",customFunction:function(e){return e.startsWith("resources/")?Xt({path:li(e.substr(10)),bundle:zt.RESOURCES,__isNative__:!0,ext:si(e)}):""}}]),nt(Lr,"AssetLibrary",[{name:"getLibUrlNoExt",suggest:"AssetLibrary.getLibUrlNoExt was removed, if you want to transform url, please use cc.assetManager.utils.getUrlWithUuid instead"},{name:"queryAssetInfo",suggest:"AssetLibrary.queryAssetInfo was removed"}]),nt(Br,"loader",[{name:"releaseResDir",suggest:"loader.releaseResDir was removed, please use assetManager.releaseAsset instead"},{name:"flowInDeps",suggest:"loader.flowInDeps was removed"},{name:"assetLoader",suggest:"cc.loader.assetLoader was removed, assetLoader and md5Pipe were merged into cc.assetManager.transformPipeline"}]),it(fe,"cc",[{name:"loader",newName:"assetManager",logTimes:1,customGetter:function(){return Br}},{name:"AssetLibrary",newName:"assetManager",logTimes:1,customGetter:function(){return Lr}},{name:"Pipeline",target:Cr,targetName:"AssetManager",newName:"Pipeline",logTimes:1},{name:"url",targetName:"assetManager",newName:"utils",logTimes:1,customGetter:function(){return Or}}]),nt(fe,"cc",[{name:"LoadingItems",suggest:vt(1400,"cc.LoadingItems","cc.AssetManager.Task")}]),it(ci,"macro",[{name:"DOWNLOAD_MAX_CONCURRENT",target:or,targetName:"assetManager.downloader",newName:"maxConcurrency"}]),it(Rn,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:function(e){var t;return xr.main?null===(t=xr.main.getSceneInfo(e))||void 0===t?void 0:t.uuid:""}}]),it(Fi,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:function(){var e=[];return xr.main&&xr.main.config.scenes.forEach((function(t){e.push(t)})),e}}]);var Ur,Hr,Wr,Vr,jr,zr,qr,Gr,Yr,Xr,$r,Jr,Qr,Kr,Zr=Mn._autoRelease;Mn._autoRelease=function(e,t,i){Zr.call(Mn,e,t,i);for(var n=Br._autoReleaseSetting,r=Object.keys(n),s=0;s<r.length;s++){var a=r[s];if(!0===n[a]){var o=Ct.get(a);o&&Mn.tryRelease(o)}}};var es,ts,is,ns,rs,ss,as=e("E",(Ur=rt("cc.ClickEvent"),Hr=dt(fe.Node),Wr=mi(),Vr=mi(),jr=mi(),zr=mi(),Ur((Kr=function(){function e(){pi(this,"target",Yr,this),pi(this,"component",Xr,this),pi(this,"_componentId",$r,this),pi(this,"handler",Jr,this),pi(this,"customEventData",Qr,this)}e.emitEvents=function(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];for(var s=0,a=t.length;s<a;s++){var o=t[s];o instanceof e&&o.emit(n)}};var t=e.prototype;return t.emit=function(e){var t=this.target;if(fe.isValid(t)){this._genCompIdIfNeeded();var i=fe.js._getClassById(this._componentId),n=t.getComponent(i);if(fe.isValid(n)){var r=n[this.handler];"function"==typeof r&&(null!=this.customEventData&&""!==this.customEventData&&(e=e.slice()).push(this.customEventData),r.apply(n,e))}}},t._compName2Id=function(e){var t=fe.js.getClassByName(e);return fe.js._getClassId(t)},t._compId2Name=function(e){var t=fe.js._getClassById(e);return fe.js.getClassName(t)},t._genCompIdIfNeeded=function(){this._componentId||(this._componentName=this.component,this.component="")},ke(e,[{key:"_componentName",get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(e){this._componentId=this._compName2Id(e)}}]),e}(),Yr=fi((Gr=Kr).prototype,"target",[_i,Hr,Wr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xr=fi(Gr.prototype,"component",[_i,gi,Vr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),$r=fi(Gr.prototype,"_componentId",[_i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Jr=fi(Gr.prototype,"handler",[_i,gi,jr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Qr=fi(Gr.prototype,"customEventData",[_i,gi,zr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),qr=Gr))||qr));fe.Component.EventHandler=as,it(nn,"Camera",[{name:"CameraClearFlag",newName:"ClearFlag"}]),it(nn.prototype,"Camera.prototype",[{name:"color",newName:"clearColor"},{name:"depth",newName:"clearDepth"},{name:"stencil",newName:"clearStencil"}]),fe.CameraComponent=nn,yt.setClassAlias(nn,"cc.CameraComponent");var os,us,ls,cs,hs,ds,fs,ps,_s,gs,ms,vs=e("U",rt("cc.animation.UniformProxyFactory")((ss=function(){function e(e,t){pi(this,"passIndex",is,this),pi(this,"uniformName",ns,this),pi(this,"channelIndex",rs,this),this.passIndex=t||0,this.uniformName=e||""}return e.prototype.forTarget=function(e){var t=e.passes[this.passIndex],i=t.getHandle(this.uniformName);if(!i)throw new Error('Material "'+e.name+'" has no uniform "'+this.uniformName+'"');var n=vi.getPropertyTypeFromHandle(i);if(n===yi.BUFFER){var r=void 0===this.channelIndex?i:t.getHandle(this.uniformName,this.channelIndex,wi.FLOAT);if(!r)throw new Error('Uniform "'+this.uniformName+" (in material "+e.name+") has no channel "+this.channelIndex+'"');return function(e,t){for(var i,n=Ye(e.shaderInfo.blocks);!(i=n()).done;)for(var r,s=i.value,a=Ye(s.members);!(r=a()).done;){var o=r.value;if(o.name===t)return o.count>1}return!1}(t,this.uniformName)?{set:function(e){t.setUniformArray(r,e)}}:{set:function(e){t.setUniform(r,e)}}}if(n===yi.TEXTURE){var s=vi.getBindingFromHandle(i),a=t.properties[this.uniformName],o=a&&a.value?a.value+"-texture":Ti(a.type),u=Ze.get(o);return u||(bi("Illegal texture default value: "+o+"."),u=Ze.get("default-texture")),{set:function(e){e||(e=u);var i=e.getGFXTexture();i&&i.width&&i.height&&(t.bindTexture(s,i),e instanceof Ai&&t.bindSampler(s,Ei.getSampler(fe.game._gfxDevice,e.getSamplerHash())))}}}throw new Error("Animations are not available for uniforms with property type "+n+".")},e}(),is=fi((ts=ss).prototype,"passIndex",[_i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ns=fi(ts.prototype,"uniformName",[_i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),rs=fi(ts.prototype,"channelIndex",[pt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),es=ts))||es);function ys(e,t,i,n){var r,s,a,o,u,c,h=new t,d=new t,f=new t,p=rt(e)((c=function(){function e(e,i,n){pi(this,"dataPoint",a,this),pi(this,"inTangent",o,this),pi(this,"outTangent",u,this),this.dataPoint=e||new t,this.inTangent=i||new t,this.outTangent=n||new t}var r=e.prototype;return r.lerp=function(e,t,r){var s=this.dataPoint,a=e.dataPoint;d=i(d,this.inTangent,r),f=i(f,e.outTangent,r);var o=t*t*t,u=t*t,l=o-2*u+t,c=-2*o+3*u,p=o-u;return h=i(h,s,2*o-3*u+1),h=n(h,h,d,l),h=n(h,h,a,c),h=n(h,h,f,p)},r.getNoLerp=function(){return this.dataPoint},e}(),a=fi((s=c).prototype,"dataPoint",[_i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),o=fi(s.prototype,"inTangent",[_i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),u=fi(s.prototype,"outTangent",[_i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),r=s))||r;if(t===l){var _=p.prototype.lerp;p.prototype.lerp=function(e,t,i){var n=_.call(this,e,t,i);return l.normalize(n,n),n}}return p}e("M",rt("cc.animation.MorphWeightsValueProxy")((cs=function(){function e(){pi(this,"subMeshIndex",ls,this)}return e.prototype.forTarget=function(e){var t=this;return{set:function(i){e.setWeights(i,t.subMeshIndex)}}},e}(),ls=fi((us=cs).prototype,"subMeshIndex",[_i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),os=us))||os),e("a",rt("cc.animation.MorphWeightsAllValueProxy")(hs=function(){function e(){}return e.prototype.forTarget=function(e){return{set:function(t){for(var i,n,r=null!==(i=null===(n=e.mesh)||void 0===n?void 0:n.struct.primitives.length)&&void 0!==i?i:0,s=0;s<r;++s)e.setWeights(t,s)}}},e}())||hs);var ws=e("C",ys("cc.CubicSplineVec2Value",n,n.multiplyScalar,n.scaleAndAdd));fe.CubicSplineVec2Value=ws;var Ts=e("b",ys("cc.CubicSplineVec3Value",s,s.multiplyScalar,s.scaleAndAdd));fe.CubicSplineVec3Value=Ts;var bs=e("c",ys("cc.CubicSplineVec4Value",o,o.multiplyScalar,o.scaleAndAdd));fe.CubicSplineVec4Value=bs;var As=e("d",ys("cc.CubicSplineQuatValue",l,l.multiplyScalar,l.scaleAndAdd));fe.CubicSplineQuatValue=As;var Es,Ss,Ns,Is=e("e",rt("cc.CubicSplineNumberValue")((ms=function(){function e(e,t,i){pi(this,"dataPoint",ps,this),pi(this,"inTangent",_s,this),pi(this,"outTangent",gs,this),this.dataPoint=e,this.inTangent=t,this.outTangent=i}var t=e.prototype;return t.lerp=function(e,t,i){var n=this.dataPoint,r=e.dataPoint,s=t*t*t,a=t*t;return n*(2*s-3*a+1)+this.outTangent*i*(s-2*a+t)+r*(-2*s+3*a)+e.inTangent*i*(s-a)},t.getNoLerp=function(){return this.dataPoint},e}(),ps=fi((fs=ms).prototype,"dataPoint",[_i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_s=fi(fs.prototype,"inTangent",[_i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),gs=fi(fs.prototype,"outTangent",[_i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ds=fs))||ds);fe.CubicSplineNumberValue=Is,it(Wi.prototype,"Animation",[{name:"getAnimationState",newName:"getState"},{name:"addClip",newName:"createState"},{name:"removeClip",newName:"removeState",customFunction:function(){var e=arguments.length<=0?void 0:arguments[0];return Wi.prototype.removeState.call(this,e.name)}}]),fe.AnimationComponent=Wi,yt.setClassAlias(Wi,"cc.AnimationComponent");var Rs,Cs,xs,Ps,ks=e("x",rt((Ns=Ss=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this)._anims=new Ni([]),t._delayEvents=[],t._blendStateBuffer=new zi,t._crossFades=[],t._sockets=[],t}Me(t,e);var i=t.prototype;return i.addCrossFade=function(e){this._crossFades.push(e)},i.removeCrossFade=function(e){Si(this._crossFades,e)},i.update=function(e){for(var t=this._delayEvents,i=this._crossFades,n=this._sockets,r=0,s=i.length;r<s;r++)i[r].update(e);var a=this._anims,o=a.array;for(a.i=0;a.i<o.length;++a.i){var u=o[a.i];u.isMotionless||u.update(e)}this._blendStateBuffer.apply();for(var l=fe.director.getTotalFrames(),c=0,h=n.length;c<h;c++){var d=n[c],f=d.target,p=d.transform;f.matrix=Vi(p,l)}for(var _=0,g=t.length;_<g;_++){var m=t[_];m.fn.apply(m.thisArg,m.args)}t.length=0},i.destruct=function(){},i.addAnimation=function(e){-1===this._anims.array.indexOf(e)&&this._anims.push(e)},i.removeAnimation=function(e){var t=this._anims.array.indexOf(e);t>=0?this._anims.fastRemoveAt(t):Le(3907)},i.pushDelayEvent=function(e,t,i){this._delayEvents.push({fn:e,thisArg:t,args:i})},i.addSockets=function(e,t){for(var i=this,n=function(n){var r=t[n];if(i._sockets.find((function(e){return e.target===r.target})))return"continue";var s=e.getChildByPath(r.path),a=r.target&&s&&qi(s,e);a&&i._sockets.push({target:r.target,transform:a})},r=0;r<t.length;++r)n(r)},i.removeSockets=function(e,t){for(var i=0;i<t.length;++i)for(var n=t[i],r=0;r<this._sockets.length;++r){var s=this._sockets[r];if(s.target===n.target){ji(s.transform.node),this._sockets[r]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}},ke(t,[{key:"blendState",get:function(){return this._blendStateBuffer}}]),t}(ln),Ss.ID="animation",Es=Ns))||Es);Rn.on(In.EVENT_INIT,(function(){var e=new ks;Rn.registerSystem(ks.ID,e,_n.PRIORITY_SYSTEM)})),fe.AnimationManager=ks,fe.easing=Gi;var Ds=e("H",rt("cc.HierachyModifier")(Rs=function(e){function t(){return e.apply(this,arguments)||this}return Me(t,e),t}(Yi))||Rs);fe.HierachyModifier=Ds;var Fs=e("p",rt("cc.ComponentModifier")(Cs=function(e){function t(){return e.apply(this,arguments)||this}return Me(t,e),t}(Xi))||Cs);fe.ComponentModifier=Fs;var Ms=e("q",rt("cc.CurveValueAdapter")(xs=function(){function e(){}return e.prototype.forTarget=function(){return{set:function(){}}},e}())||xs);fe.CurveValueAdapter=Ms;var Bs=e("s",rt("cc.UniformCurveValueAdapter")(Ps=function(e){function t(){return e.apply(this,arguments)||this}return Me(t,e),t}(vs))||Ps);function Ls(e){return"string"==typeof e}function Os(e){return"number"==typeof e}function Us(e,t){return e instanceof t}fe.UniformCurveValueAdapter=Bs,fe.isPropertyModifier=Ls,fe.isElementModifier=Os,fe.isCustomTargetModifier=Us,fe.math=rn,fe.geometry=sn}}}));
